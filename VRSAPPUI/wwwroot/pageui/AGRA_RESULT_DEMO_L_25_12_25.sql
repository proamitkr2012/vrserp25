USE [master]
GO
/****** Object:  Database [AGRA_RESULT_DEMO]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE DATABASE [AGRA_RESULT_DEMO]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'Agra_result_2025', FILENAME = N'F:\DATABASES\Agra_result_DEMO_2025.mdf' , SIZE = 20127744KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB )
 LOG ON 
( NAME = N'Agra_result_2025_log', FILENAME = N'F:\DATABASE_LOG_FILES\Agra_result_DEMO_2025_log.ldf' , SIZE = 35753856KB , MAXSIZE = 2048GB , FILEGROWTH = 65536KB )
 WITH CATALOG_COLLATION = DATABASE_DEFAULT
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET COMPATIBILITY_LEVEL = 150
GO
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [AGRA_RESULT_DEMO].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET ANSI_NULL_DEFAULT OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET ANSI_NULLS OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET ANSI_PADDING OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET ANSI_WARNINGS OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET ARITHABORT OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET CURSOR_DEFAULT  GLOBAL 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET CONCAT_NULL_YIELDS_NULL OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET QUOTED_IDENTIFIER OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET RECURSIVE_TRIGGERS OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET  DISABLE_BROKER 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET TRUSTWORTHY OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET READ_COMMITTED_SNAPSHOT OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET HONOR_BROKER_PRIORITY OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET RECOVERY FULL 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET  MULTI_USER 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET PAGE_VERIFY CHECKSUM  
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET DB_CHAINING OFF 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET TARGET_RECOVERY_TIME = 60 SECONDS 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET DELAYED_DURABILITY = DISABLED 
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET ACCELERATED_DATABASE_RECOVERY = OFF  
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET QUERY_STORE = OFF
GO
USE [AGRA_RESULT_DEMO]
GO
/****** Object:  User [vivek]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE USER [vivek] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [mridul]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE USER [mridul] FOR LOGIN [mridul] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [amit]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE USER [amit] FOR LOGIN [amit] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [akshat]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE USER [akshat] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[dbo]
GO
ALTER ROLE [db_owner] ADD MEMBER [vivek]
GO
ALTER ROLE [db_datareader] ADD MEMBER [vivek]
GO
ALTER ROLE [db_datawriter] ADD MEMBER [vivek]
GO
ALTER ROLE [db_owner] ADD MEMBER [mridul]
GO
ALTER ROLE [db_owner] ADD MEMBER [amit]
GO
ALTER ROLE [db_datareader] ADD MEMBER [amit]
GO
ALTER ROLE [db_datawriter] ADD MEMBER [amit]
GO
ALTER ROLE [db_owner] ADD MEMBER [akshat]
GO
ALTER ROLE [db_datareader] ADD MEMBER [akshat]
GO
/****** Object:  UserDefinedTableType [dbo].[RESULT_USERS_TBLTYPE]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE TYPE [dbo].[RESULT_USERS_TBLTYPE] AS TABLE(
	[RESULT_ID] [varchar](20) NOT NULL,
	[MASTER_ID] [varchar](20) NULL,
	[ROLL_NO] [varchar](20) NOT NULL,
	[COURSE_ID] [int] NULL,
	[SEM_NO] [int] NULL,
	[ORDINANCE_ID] [int] NULL,
	[RESULT_TYPE] [varchar](30) NULL,
	INDEX [CIX] CLUSTERED 
(
	[RESULT_ID] ASC,
	[COURSE_ID] ASC
),
	PRIMARY KEY NONCLUSTERED 
(
	[RESULT_ID] ASC,
	[ROLL_NO] ASC
)WITH (IGNORE_DUP_KEY = OFF)
)
GO
/****** Object:  UserDefinedFunction [dbo].[AppName]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[AppName]()
RETURNS VARCHAR(50)
AS
BEGIN    
	RETURN 'DBRAU WIN APP'
END
GO
/****** Object:  UserDefinedFunction [dbo].[GET_GRADE_POINT]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION  [dbo].[GET_GRADE_POINT]
(@RESULT_TYPE VARCHAR(500),
 @VAL INT  
 
)
RETURNS  VARCHAR(150)
AS
BEGIN
	-- Declare the return variable here
	DECLARE   @ResultVar VARCHAR(150)

	-- Add the T-SQL statements to compute the return value here
	 SELECT @ResultVar= CAST( [GradePoint] AS VARCHAR(100)) +','+ CAST([Grade] AS VARCHAR(50)) 
	 FROM [COURSE_GRADE_POINT] WHERE  RANGEFROM <=@VAL AND @VAL <=RANGETO AND RESULT_TYPE=@RESULT_TYPE 
	 
   
     
	-- Return the result of the function
	RETURN @ResultVar

END
GO
/****** Object:  Table [dbo].[AdminMasterRoles]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AdminMasterRoles](
	[AdminId] [int] NOT NULL,
	[RoleId] [int] NOT NULL,
 CONSTRAINT [PK_AdminMasterRoles] PRIMARY KEY CLUSTERED 
(
	[AdminId] ASC,
	[RoleId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AdminMasters]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AdminMasters](
	[AdminId] [int] IDENTITY(1,1) NOT NULL,
	[Password] [varchar](50) NOT NULL,
	[Name] [varchar](100) NOT NULL,
	[Email] [varchar](50) NULL,
	[MobileNo] [varchar](20) NULL,
	[ProfilePic] [nvarchar](50) NULL,
	[CreatedDate] [datetime] NULL,
	[UpdatedDate] [datetime] NULL,
	[IsVerified] [bit] NULL,
	[VerificationDate] [datetime] NULL,
	[IsActive] [bit] NULL,
	[VerificationUrl] [nvarchar](500) NULL,
	[MailSentCounter] [int] NULL,
	[EncriptedKey] [nvarchar](500) NULL,
	[Islive] [bit] NOT NULL,
	[BranchID] [int] NOT NULL,
	[UserName] [varchar](200) NULL,
 CONSTRAINT [PK_AdminMaster] PRIMARY KEY CLUSTERED 
(
	[AdminId] ASC,
	[Name] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[COURSE_APPLY_RULE_TEMP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[COURSE_APPLY_RULE_TEMP](
	[COURSE_RULE_ID] [int] IDENTITY(1,1) NOT NULL,
	[COURSE_RULE_NAME] [nvarchar](500) NOT NULL,
	[COURSE_ID] [int] NOT NULL,
	[SESSIONID] [int] NOT NULL,
	[ISRW] [int] NOT NULL,
	[RULEGROUP_ID] [int] NOT NULL,
	[ISACTIVE] [bit] NOT NULL,
	[CREATEON] [smalldatetime] NOT NULL,
	[UPDATEON] [smalldatetime] NULL,
 CONSTRAINT [PK_COURSE_APPLY_RULE] PRIMARY KEY CLUSTERED 
(
	[COURSE_RULE_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[COURSE_GRADE_POINT]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[COURSE_GRADE_POINT](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[RESULT_TYPE] [nvarchar](80) NULL,
	[RangeFrom] [int] NULL,
	[RangeTo] [int] NULL,
	[GradePoint] [int] NULL,
	[GradeName] [varchar](40) NULL,
	[Grade] [varchar](10) NULL,
 CONSTRAINT [PK_COURSE_GRADE_POINT] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EXAM_IN_SESSION]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EXAM_IN_SESSION](
	[EXAM_IN_SESS_ID] [int] IDENTITY(1,1) NOT NULL,
	[SESSION_ID_FK] [int] NOT NULL,
	[COURSE_ID_FK] [int] NOT NULL,
	[HELD_IN] [varchar](20) NOT NULL,
	[EXAM_FREQUENCY] [tinyint] NOT NULL,
 CONSTRAINT [PK_EXAM_IN_SESSION] PRIMARY KEY CLUSTERED 
(
	[EXAM_IN_SESS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Masterid_RollNo_Mapping]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Masterid_RollNo_Mapping](
	[MasterId] [int] NOT NULL,
	[RollNo] [varchar](15) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PAPER_MASTER]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PAPER_MASTER](
	[PAPER_CODE] [varchar](25) NOT NULL,
	[SUBJECT_NAME] [nvarchar](200) NULL,
	[PAPER_NAME] [nvarchar](500) NULL,
	[PAPER_TYPE] [varchar](5) NULL,
	[PAPER_TYPE_CAT] [varchar](5) NULL,
	[CREDIT] [tinyint] NULL,
	[IS_QUALIFIYING] [int] NOT NULL,
	[THEORY_MAX] [smallint] NULL,
	[THEORY_MIN] [smallint] NULL,
	[INTERNAL_MAX] [smallint] NULL,
	[INTERNAL_MIN] [smallint] NULL,
	[SESSIONAL_MAX] [smallint] NULL,
	[SESSIONAL_MIN] [smallint] NULL,
	[TOTAL_MAX] [smallint] NULL,
	[TOTAL_MIN] [smallint] NULL,
	[SUBJECT_PAPER_CODE] [nvarchar](50) NULL,
	[ISRW] [int] NOT NULL,
	[SESSIONID] [int] NULL,
	[PAPER_SERIAL_NO] [int] NOT NULL,
	[PAPER_TYPE_NAME] [nvarchar](80) NULL,
	[PRACTICAL_MAX] [smallint] NULL,
	[PRACTICAL_MIN] [smallint] NULL,
	[SESSION] [varchar](25) NULL,
 CONSTRAINT [PK_PAPER_MASTER] PRIMARY KEY CLUSTERED 
(
	[PAPER_CODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PAPER_RULE_DETAILS]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PAPER_RULE_DETAILS](
	[RULE_DETAILS_ID] [int] IDENTITY(1,1) NOT NULL,
	[PTYPE_RULE] [varchar](5) NOT NULL,
	[THEORY_MAX] [int] NOT NULL,
	[THEORY_MIN] [int] NOT NULL,
	[INTERNAL_MAX] [int] NULL,
	[INTERNAL_MIN] [int] NULL,
	[SESSIONAL_MAX] [int] NULL,
	[SESSIONAL_MIN] [int] NULL,
	[TOTAL_MAX] [int] NOT NULL,
	[TOTAL_MIN] [int] NULL,
	[RULE_GROUP_ID] [int] NOT NULL,
 CONSTRAINT [PK_RULE_DETAILS] PRIMARY KEY CLUSTERED 
(
	[RULE_DETAILS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Roles]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Roles](
	[RoleId] [int] IDENTITY(1,1) NOT NULL,
	[RoleName] [varchar](50) NOT NULL,
	[Description] [varchar](250) NULL,
	[IsActive] [bit] NULL,
 CONSTRAINT [PK_Roles] PRIMARY KEY CLUSTERED 
(
	[RoleId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_MARKS]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_MARKS](
	[RESULT_ID] [int] NOT NULL,
	[MARKS_ID] [int] NOT NULL,
	[RESULT_ID_OLD] [varchar](50) NULL,
	[SUBJECT_SERIAL] [tinyint] NULL,
	[PAPER_SERIAL] [tinyint] NULL,
	[MASTER_ID] [int] NULL,
	[EXTERNAL_ID] [varchar](10) NULL,
	[COURSE_ID] [smallint] NULL,
	[EXAM_TYPE] [varchar](25) NULL,
	[SESSION] [varchar](25) NULL,
	[YEAR_SEM] [tinyint] NULL,
	[COLLEGE_CODE] [varchar](5) NULL,
	[ROLL_NO] [varchar](15) NULL,
	[PAPER_CODE] [varchar](25) NULL,
	[CATCH_CODE] [varchar](50) NULL,
	[SUBJECT_NAME] [nvarchar](200) NULL,
	[PAPER_NAME] [nvarchar](1000) NULL,
	[THEORY_OBT] [int] NULL,
	[INTERNAL_OBT] [int] NULL,
	[SESSIONAL_OBT] [int] NULL,
	[TOTAL_OBT] [int] NULL,
	[PAPER_STATUS] [varchar](50) NULL,
	[SUBJECT_CODE] [varchar](25) NULL,
	[SUBJECT_TYPE] [varchar](20) NULL,
	[SUBJECT_TYPE_SERIAL] [varchar](20) NULL,
	[CREDIT] [tinyint] NULL,
	[EARNED_CREDIT] [tinyint] NULL,
	[POINT] [decimal](7, 1) NULL,
	[GRADE_POINT] [decimal](7, 1) NULL,
	[GRADE] [varchar](10) NULL,
	[THEORY_MAX] [int] NULL,
	[THEORY_MIN] [int] NULL,
	[THEORY_GRACE] [varchar](10) NULL,
	[THEORY_PRACT_ABSENT] [bit] NULL,
	[PRACTICAL_MAX] [int] NULL,
	[PRACTICAL_MIN] [int] NULL,
	[PRACTICAL_OBT] [int] NULL,
	[PRACTICAL_ABSENT] [bit] NULL,
	[INTERNAL_MAX] [int] NULL,
	[INTERNAL_MIN] [int] NULL,
	[INTERNAL_ABSENT] [bit] NULL,
	[SESSIONAL_MAX] [int] NULL,
	[SESSIONAL_MIN] [int] NULL,
	[SESSIONAL_ABSENT] [bit] NULL,
	[TOTAL_MAX] [int] NULL,
	[TOTAL_MIN] [int] NULL,
	[SUBJECT_GRACE] [varchar](10) NULL,
	[SUBJECT_STATUS] [varchar](50) NULL,
	[RE_EX] [bit] NULL,
	[OLD_MARKS] [int] NULL,
	[BACK_POST_ID] [int] NULL,
	[BARCODE] [varchar](15) NULL,
	[OMR_FEE_PAID] [bit] NULL,
	[SCAN_IMAGE_PATH] [varchar](200) NULL,
	[OMR_SERIES] [char](1) NULL,
	[ANSWER_KEY_PATH] [varchar](200) NULL,
	[CREATED_AT] [datetime] NULL,
	[CREATED_BY] [int] NULL,
	[LAST_UPDATED_AT] [datetime] NULL,
	[LAST_UPDATED_BY] [int] NULL,
	[IS_ACTIVE] [bit] NULL,
	[THEORY_PRACT_MW] [bit] NOT NULL,
	[INTERNAL_MW] [bit] NOT NULL,
	[SESSIONAL_MW] [bit] NOT NULL,
	[UFM] [bit] NOT NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[CREDIT_POINT] [varchar](10) NULL,
	[REMARKS] [varchar](1500) NULL,
	[BACK_POSTED] [bit] NULL,
	[IS_INTERNAL_RECEIVED] [bit] NULL,
	[MW] [bit] NULL,
	[THEORY_ABSENT] [bit] NULL,
	[THEORY_MW] [bit] NULL,
	[ADD_PAPER_CREDIT] [bit] NOT NULL,
 CONSTRAINT [PK_STUDENT_MARKS] PRIMARY KEY CLUSTERED 
(
	[RESULT_ID] ASC,
	[MARKS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_MARKS_LOAL_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_MARKS_LOAL_LOG](
	[RESULT_ID] [varchar](50) NOT NULL,
	[MARKS_ID] [int] NOT NULL,
	[SUBJECT_SERIAL] [tinyint] NULL,
	[PAPER_SERIAL] [tinyint] NULL,
	[MASTER_ID] [int] NULL,
	[EXTERNAL_ID] [varchar](10) NULL,
	[COURSE_ID] [smallint] NULL,
	[EXAM_TYPE] [varchar](25) NULL,
	[SESSION] [varchar](25) NULL,
	[YEAR_SEM] [tinyint] NULL,
	[COLLEGE_CODE] [varchar](5) NULL,
	[ROLL_NO] [varchar](15) NULL,
	[PAPER_CODE] [varchar](25) NULL,
	[CATCH_CODE] [varchar](50) NULL,
	[SUBJECT_NAME] [nvarchar](200) NULL,
	[PAPER_NAME] [nvarchar](1000) NULL,
	[THEORY_OBT] [int] NULL,
	[INTERNAL_OBT] [int] NULL,
	[SESSIONAL_OBT] [int] NULL,
	[TOTAL_OBT] [int] NULL,
	[PAPER_STATUS] [varchar](50) NULL,
	[SUBJECT_CODE] [varchar](25) NULL,
	[SUBJECT_TYPE] [varchar](20) NULL,
	[SUBJECT_TYPE_SERIAL] [varchar](20) NULL,
	[CREDIT] [tinyint] NULL,
	[EARNED_CREDIT] [tinyint] NULL,
	[POINT] [decimal](7, 1) NULL,
	[GRADE_POINT] [decimal](7, 1) NULL,
	[GRADE] [varchar](10) NULL,
	[THEORY_MAX] [int] NULL,
	[THEORY_MIN] [int] NULL,
	[THEORY_GRACE] [varchar](10) NULL,
	[THEORY_PRACT_ABSENT] [bit] NULL,
	[PRACTICAL_MAX] [int] NULL,
	[PRACTICAL_MIN] [int] NULL,
	[PRACTICAL_OBT] [int] NULL,
	[PRACTICAL_ABSENT] [bit] NULL,
	[INTERNAL_MAX] [int] NULL,
	[INTERNAL_MIN] [int] NULL,
	[INTERNAL_ABSENT] [bit] NULL,
	[SESSIONAL_MAX] [int] NULL,
	[SESSIONAL_MIN] [int] NULL,
	[SESSIONAL_ABSENT] [bit] NULL,
	[TOTAL_MAX] [int] NULL,
	[TOTAL_MIN] [int] NULL,
	[SUBJECT_GRACE] [varchar](10) NULL,
	[SUBJECT_STATUS] [varchar](50) NULL,
	[RE_EX] [bit] NULL,
	[OLD_MARKS] [int] NULL,
	[BACK_POST_ID] [int] NULL,
	[BARCODE] [varchar](15) NULL,
	[OMR_FEE_PAID] [bit] NULL,
	[SCAN_IMAGE_PATH] [varchar](200) NULL,
	[OMR_SERIES] [char](1) NULL,
	[ANSWER_KEY_PATH] [varchar](200) NULL,
	[CREATED_AT] [datetime] NULL,
	[CREATED_BY] [int] NULL,
	[LAST_UPDATED_AT] [datetime] NULL,
	[LAST_UPDATED_BY] [int] NULL,
	[IS_ACTIVE] [bit] NULL,
	[THEORY_PRACT_MW] [bit] NOT NULL,
	[INTERNAL_MW] [bit] NOT NULL,
	[SESSIONAL_MW] [bit] NOT NULL,
	[UFM] [bit] NOT NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[CREDIT_POINT] [varchar](10) NULL,
	[REMARKS] [varchar](1500) NULL,
	[BACK_POSTED] [bit] NULL,
	[IS_INTERNAL_RECEIVED] [bit] NULL,
 CONSTRAINT [PK_STUDENT_MARKS_LOG] PRIMARY KEY CLUSTERED 
(
	[RESULT_ID] ASC,
	[MARKS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_MASTER]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_MASTER](
	[MASTER_ID] [int] NOT NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[ENROLLMENT_NO] [varchar](20) NULL,
	[AADHAAR_NO] [varchar](12) NULL,
	[ABC_ACCOUNT_ID] [varchar](25) NULL,
	[STUDENT_NAME] [nvarchar](100) NULL,
	[FATHER_NAME] [nvarchar](100) NULL,
	[MOTHER_NAME] [nvarchar](100) NULL,
	[GENDER] [varchar](15) NOT NULL,
	[CATEGORY] [varchar](10) NULL,
	[SUB_CATEGORY] [varchar](50) NULL,
	[DOB] [date] NULL,
	[NATIONALITY_CODE] [char](1) NULL,
	[COUNTRY_CODE] [varchar](2) NULL,
	[MOBILE] [varchar](10) NULL,
	[FOREIGN_MOBILE_NO] [varchar](25) NULL,
	[EMAIL] [varchar](50) NULL,
	[ALTERNATE_MOBILE] [varchar](10) NULL,
	[GUARDIAN_MOBILE] [varchar](10) NULL,
	[PHOTO_PATH] [varchar](50) NULL,
	[SIGNATURE_PATH] [varchar](50) NULL,
	[MOBILE_VERIFIED] [bit] NULL,
	[EMAIL_VERIFIED] [bit] NULL,
	[LOGIN_PASSWORD] [varchar](50) NULL,
	[REMARKS] [varchar](100) NULL,
	[CREATED_AT] [datetime] NULL,
	[CREATED_BY] [int] NULL,
	[LAST_UPDATED_AT] [datetime] NULL,
	[LAST_UPDATED_BY] [int] NULL,
	[IS_ACTIVE] [bit] NULL,
	[RU_NUMBER] [varchar](25) NULL,
	[LAST_APPROVED_BY] [int] NULL,
	[LAST_APPROVED_AT] [datetime] NULL,
	[LAST_EDIT_REMARKS] [varchar](500) NULL,
	[APPLICATION_DOCUMENT] [varchar](150) NULL,
	[IS_DOWNLOAD_PHOTO] [bit] NULL,
	[IS_VRS] [bit] NOT NULL,
	[STUDENT_NAME_APS] [nvarchar](200) NULL,
	[STUDENT_NAME_KRUTI_DEV] [nvarchar](200) NULL,
	[STUDENT_NAME_UNICODE] [nvarchar](200) NULL,
	[PHOTO_PATH_OLD] [varchar](50) NULL,
 CONSTRAINT [PK_STUDENT_MASTER] PRIMARY KEY CLUSTERED 
(
	[MASTER_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_MASTER_DETAIL]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_MASTER_DETAIL](
	[MASTER_ID] [int] NOT NULL,
	[COURSE_ID_MAIN] [smallint] NOT NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[ENROLLMENT_NO] [varchar](20) NULL,
	[IS_NEP] [bit] NULL,
	[COLLEGE_CODE] [varchar](5) NULL,
	[WING_TYPE_CODE] [varchar](2) NULL,
	[REGISTRATION_NO] [varchar](25) NULL,
	[COURSE_TYPE] [varchar](5) NULL,
	[LAST_YEAR_SEM_NO] [tinyint] NULL,
	[ROLL_NO] [varchar](15) NULL,
	[ADMISSION_SESSION] [varchar](10) NULL,
	[LAST_SESSION] [varchar](10) NULL,
	[FINAL_RESULT] [varchar](50) NULL,
	[FINAL_DIVISION] [varchar](50) NULL,
	[FINAL_RESULT_PRACTICAL] [varchar](50) NULL,
	[FINAL_DIVISION_PRACTICAL] [varchar](50) NULL,
	[MARKSHEET_FORMAT_CODE] [varchar](10) NULL,
	[THEORY_MAX_MARKS] [int] NULL,
	[THEORY_MIN_MARKS] [int] NULL,
	[THEORY_OBT_MARKS] [int] NULL,
	[PRACTICAL_MAX_MARKS] [int] NULL,
	[PRACTICAL_MIN_MARKS] [int] NULL,
	[PRACTICAL_OBT_MARKS] [int] NULL,
	[INTERNAL_MAX_MARKS] [int] NULL,
	[INTERNAL_MIN_MARKS] [int] NULL,
	[INTERNAL_OBT_MARKS] [int] NULL,
	[SESSIONAL_MAX_MARKS] [int] NULL,
	[SESSIONAL_MIN_MARKS] [int] NULL,
	[SESSIONAL_OBT_MARKS] [int] NULL,
	[TOTAL_MAX_MARKS] [int] NULL,
	[TOTAL_MIN_MARKS] [int] NULL,
	[TOTAL_OBT_MARKS] [int] NULL,
	[IS_DUPLICATE_MARKSHEET] [bit] NULL,
	[DUPLICATE_MARKSHEET_DATE] [date] NULL,
	[WEBLINK] [nvarchar](200) NULL,
	[IS_VRS] [bit] NOT NULL,
	[BATCH] [varchar](10) NULL,
	[MAJOR_1_SUBJECT] [nvarchar](200) NULL,
	[MAJOR_2_SUBJECT] [nvarchar](200) NULL,
	[MAJOR_ELECTIVE_SUBJECT] [nvarchar](200) NULL,
 CONSTRAINT [PK_STUDENT_MASTER_DETAIL] PRIMARY KEY CLUSTERED 
(
	[MASTER_ID] ASC,
	[COURSE_ID_MAIN] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_MASTER_old]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_MASTER_old](
	[MASTER_ID] [int] NOT NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[ENROLLMENT_NO] [varchar](20) NULL,
	[AADHAAR_NO] [varchar](12) NULL,
	[ABC_ACCOUNT_ID] [varchar](25) NULL,
	[STUDENT_NAME] [nvarchar](100) NULL,
	[FATHER_NAME] [nvarchar](100) NULL,
	[MOTHER_NAME] [nvarchar](100) NULL,
	[GENDER] [varchar](15) NULL,
	[CATEGORY] [varchar](10) NULL,
	[SUB_CATEGORY] [varchar](50) NULL,
	[DOB] [date] NULL,
	[NATIONALITY_CODE] [char](1) NULL,
	[COUNTRY_CODE] [varchar](2) NULL,
	[MOBILE] [varchar](15) NULL,
	[FOREIGN_MOBILE_NO] [varchar](25) NULL,
	[EMAIL] [varchar](50) NULL,
	[ALTERNATE_MOBILE] [varchar](10) NULL,
	[GUARDIAN_MOBILE] [varchar](10) NULL,
	[PHOTO_PATH] [varchar](50) NULL,
	[SIGNATURE_PATH] [varchar](50) NULL,
	[MOBILE_VERIFIED] [bit] NULL,
	[EMAIL_VERIFIED] [bit] NULL,
	[LOGIN_PASSWORD] [varchar](50) NULL,
	[REMARKS] [varchar](100) NULL,
	[CREATED_AT] [datetime] NULL,
	[CREATED_BY] [int] NULL,
	[LAST_UPDATED_AT] [datetime] NULL,
	[LAST_UPDATED_BY] [int] NULL,
	[IS_ACTIVE] [bit] NULL,
	[RU_NUMBER] [varchar](25) NULL,
	[LAST_APPROVED_BY] [int] NULL,
	[LAST_APPROVED_AT] [datetime] NULL,
	[LAST_EDIT_REMARKS] [varchar](500) NULL,
	[APPLICATION_DOCUMENT] [varchar](150) NULL,
	[IS_DOWNLOAD_PHOTO] [bit] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_RESULT]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_RESULT](
	[RESULT_ID] [int] NOT NULL,
	[RESULT_ID_OLD] [varchar](20) NULL,
	[MASTER_ID] [int] NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[ROLL_NO] [varchar](15) NULL,
	[COURSE_ID] [smallint] NULL,
	[RESULT_TYPE] [varchar](25) NULL,
	[EXAM_TYPE] [varchar](25) NULL,
	[SESSION] [varchar](25) NULL,
	[YEAR_SEM] [tinyint] NULL,
	[COLLEGE_CODE] [varchar](5) NULL,
	[IS_HISTORY] [bit] NULL,
	[SEMESTER_RESULT] [varchar](50) NULL,
	[FINAL_RESULT] [varchar](50) NULL,
	[WING_TYPE_CODE] [varchar](2) NULL,
	[THEORY_MAX_MARKS] [int] NULL,
	[THEORY_MIN_MARKS] [int] NULL,
	[THEORY_OBT_MARKS] [int] NULL,
	[TOTAL_MAJOR_CREDIT] [decimal](5, 2) NULL,
	[TOTAL_MAJOR_EARN_CREDIT] [decimal](5, 2) NULL,
	[TOTAL_CREDIT] [decimal](5, 2) NULL,
	[EARNED_CREDIT] [decimal](5, 2) NULL,
	[TOTAL_POINT] [decimal](5, 2) NULL,
	[TOTAL_GRADE_POINT] [decimal](5, 2) NULL,
	[SGPA] [decimal](10, 3) NULL,
	[PRACTICAL_MAX_MARKS] [int] NULL,
	[PRACTICAL_MIN_MARKS] [int] NULL,
	[PRACTICAL_OBT_MARKS] [int] NULL,
	[PRACTICAL_RESULT] [varchar](50) NULL,
	[PRACTICAL_DIVISION] [varchar](50) NULL,
	[INTERNAL_MAX_MARKS] [int] NULL,
	[INTERNAL_MIN_MARKS] [int] NULL,
	[INTERNAL_OBT_MARKS] [int] NULL,
	[SESSIONAL_MAX_MARKS] [int] NULL,
	[SESSIONAL_MIN_MARKS] [int] NULL,
	[SESSIONAL_OBT_MARKS] [int] NULL,
	[TOTAL_MAX_MARKS] [int] NULL,
	[TOTAL_MIN_MARKS] [int] NULL,
	[TOTAL_OBT_MARKS] [int] NULL,
	[GRAND_MAX_MARKS] [int] NULL,
	[GRAND_MIN_MARKS] [int] NULL,
	[GRAND_OBT_MARKS] [int] NULL,
	[RG_CODE] [int] NULL,
	[RG_MAX_MARKS] [int] NULL,
	[RG_MIN_MARKS] [int] NULL,
	[RG_OBT_MARKS] [int] NULL,
	[RG_RESULT] [int] NULL,
	[ES_CODE] [int] NULL,
	[ES_MAX_MARKS] [int] NULL,
	[ES_MIN_MARKS] [int] NULL,
	[ES_OBT_MARKS] [int] NULL,
	[ES_RESULT] [int] NULL,
	[CO_CURRICULAR_RESULT] [varchar](10) NULL,
	[FINAL_DIVISION] [varchar](150) NULL,
	[PROMOTED] [varchar](15) NULL,
	[CUM_TOTAL_MAX] [int] NULL,
	[CUM_TOTAL_MIN] [int] NULL,
	[CUM_TOTAL_OBT] [int] NULL,
	[CUM_TOTAL_CREDIT] [varchar](10) NULL,
	[CUM_TOTAL_EARNED_CREDIT] [varchar](10) NULL,
	[CUM_TOTAL_POINT] [numeric](10, 2) NULL,
	[CUM_TOTAL_GRADE_POINT] [decimal](18, 2) NULL,
	[CGPA] [numeric](10, 2) NULL,
	[EXAM_NAME] [varchar](200) NULL,
	[HELD_IN] [varchar](25) NULL,
	[PRINT_LOT_NO] [smallint] NULL,
	[RESULT_DATE] [date] NULL,
	[IS_PUBLISHED] [tinyint] NULL,
	[PUBLISH_DATE] [date] NULL,
	[LAST_ORDINANCE_RUN_AT] [datetime] NULL,
	[CREATED_AT] [datetime] NULL,
	[CREATED_BY] [int] NULL,
	[LAST_UPDATED_AT] [datetime] NULL,
	[LAST_UPDATED_BY] [int] NULL,
	[IS_ACTIVE] [bit] NULL,
	[THEORY_DIVISION] [varchar](50) NULL,
	[MARKSHEET_NO] [decimal](15, 0) NULL,
	[IS_PENDING_SYNC] [bit] NULL,
	[SYNC_DATE] [smalldatetime] NULL,
	[ERROR_DETAILS] [varchar](1500) NULL,
	[IS_LIVE] [bit] NOT NULL,
	[IS_UFM] [bit] NOT NULL,
	[GROUPID] [tinyint] NOT NULL,
	[ORDINANCE_ID] [int] NOT NULL,
	[RESULT_PATTERN] [varchar](25) NULL,
 CONSTRAINT [PK_STUDENT_RESULT] PRIMARY KEY CLUSTERED 
(
	[RESULT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_RESULT_LOCAL_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_RESULT_LOCAL_LOG](
	[RESULT_ID] [varchar](20) NOT NULL,
	[MASTER_ID] [int] NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[ROLL_NO] [varchar](15) NULL,
	[COURSE_ID] [smallint] NULL,
	[RESULT_TYPE] [varchar](25) NULL,
	[EXAM_TYPE] [varchar](25) NULL,
	[SESSION] [varchar](25) NULL,
	[YEAR_SEM] [tinyint] NULL,
	[COLLEGE_CODE] [varchar](5) NULL,
	[IS_HISTORY] [bit] NULL,
	[SEMESTER_RESULT] [varchar](50) NULL,
	[FINAL_RESULT] [varchar](50) NULL,
	[WING_TYPE_CODE] [varchar](2) NULL,
	[THEORY_MAX_MARKS] [int] NULL,
	[THEORY_MIN_MARKS] [int] NULL,
	[THEORY_OBT_MARKS] [int] NULL,
	[TOTAL_MAJOR_CREDIT] [decimal](5, 2) NULL,
	[TOTAL_MAJOR_EARN_CREDIT] [decimal](5, 2) NULL,
	[TOTAL_CREDIT] [decimal](5, 2) NULL,
	[EARNED_CREDIT] [decimal](5, 2) NULL,
	[TOTAL_POINT] [decimal](5, 2) NULL,
	[TOTAL_GRADE_POINT] [decimal](5, 2) NULL,
	[SGPA] [decimal](10, 3) NULL,
	[PRACTICAL_MAX_MARKS] [int] NULL,
	[PRACTICAL_MIN_MARKS] [int] NULL,
	[PRACTICAL_OBT_MARKS] [int] NULL,
	[PRACTICAL_RESULT] [varchar](50) NULL,
	[PRACTICAL_DIVISION] [varchar](50) NULL,
	[INTERNAL_MAX_MARKS] [int] NULL,
	[INTERNAL_MIN_MARKS] [int] NULL,
	[INTERNAL_OBT_MARKS] [int] NULL,
	[SESSIONAL_MAX_MARKS] [int] NULL,
	[SESSIONAL_MIN_MARKS] [int] NULL,
	[SESSIONAL_OBT_MARKS] [int] NULL,
	[TOTAL_MAX_MARKS] [int] NULL,
	[TOTAL_MIN_MARKS] [int] NULL,
	[TOTAL_OBT_MARKS] [int] NULL,
	[GRAND_MAX_MARKS] [int] NULL,
	[GRAND_MIN_MARKS] [int] NULL,
	[GRAND_OBT_MARKS] [int] NULL,
	[RG_CODE] [int] NULL,
	[RG_MAX_MARKS] [int] NULL,
	[RG_MIN_MARKS] [int] NULL,
	[RG_OBT_MARKS] [int] NULL,
	[RG_RESULT] [int] NULL,
	[ES_CODE] [int] NULL,
	[ES_MAX_MARKS] [int] NULL,
	[ES_MIN_MARKS] [int] NULL,
	[ES_OBT_MARKS] [int] NULL,
	[ES_RESULT] [int] NULL,
	[CO_CURRICULAR_RESULT] [varchar](10) NULL,
	[FINAL_DIVISION] [varchar](150) NULL,
	[PROMOTED] [varchar](15) NULL,
	[CUM_TOTAL_MAX] [int] NULL,
	[CUM_TOTAL_MIN] [int] NULL,
	[CUM_TOTAL_OBT] [int] NULL,
	[CUM_TOTAL_CREDIT] [varchar](10) NULL,
	[CUM_TOTAL_EARNED_CREDIT] [varchar](10) NULL,
	[CUM_TOTAL_POINT] [numeric](10, 2) NULL,
	[CUM_TOTAL_GRADE_POINT] [decimal](18, 2) NULL,
	[CGPA] [numeric](10, 2) NULL,
	[EXAM_NAME] [varchar](200) NULL,
	[HELD_IN] [varchar](25) NULL,
	[PRINT_LOT_NO] [smallint] NULL,
	[RESULT_DATE] [date] NULL,
	[IS_PUBLISHED] [tinyint] NULL,
	[PUBLISH_DATE] [date] NULL,
	[LAST_ORDINANCE_RUN_AT] [datetime] NULL,
	[CREATED_AT] [datetime] NULL,
	[CREATED_BY] [int] NULL,
	[LAST_UPDATED_AT] [datetime] NULL,
	[LAST_UPDATED_BY] [int] NULL,
	[IS_ACTIVE] [bit] NULL,
	[THEORY_DIVISION] [varchar](50) NULL,
	[MARKSHEET_NO] [decimal](15, 0) NULL,
	[IS_PENDING_SYNC] [bit] NULL,
	[SYNC_DATE] [smalldatetime] NULL,
	[ERROR_DETAILS] [varchar](1500) NULL,
	[IS_LIVE] [bit] NOT NULL,
	[IS_UFM] [bit] NOT NULL,
	[ORDINANCE_ID] [int] NOT NULL,
	[GROUPID] [tinyint] NOT NULL,
 CONSTRAINT [PK_STUDENT_RESULT_LOG] PRIMARY KEY CLUSTERED 
(
	[RESULT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_SEMESTER_WISE_RECORD_NEP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_SEMESTER_WISE_RECORD_NEP](
	[RESULT_ID] [int] NOT NULL,
	[YEAR_SEM] [tinyint] NOT NULL,
	[MASTER_ID] [int] NULL,
	[EXAM_TYPE] [varchar](25) NULL,
	[TOTAL_CREDIT] [varchar](10) NULL,
	[TOTAL_EARNED_CREDIT] [varchar](10) NULL,
	[SGPA] [varchar](10) NULL,
	[STATUS] [varchar](10) NULL,
	[QUALIFIED] [varchar](10) NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[IS_CALCULATED] [bit] NOT NULL,
	[GRACE_DISPLAY] [varchar](25) NULL,
 CONSTRAINT [PK_STUDENT_SEMESTER_WISE_RECORD_NEP] PRIMARY KEY CLUSTERED 
(
	[RESULT_ID] ASC,
	[YEAR_SEM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[STUDENT_SEMESTER_WISE_RECORD_NON_NEP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[STUDENT_SEMESTER_WISE_RECORD_NON_NEP](
	[RESULT_ID] [int] NOT NULL,
	[YEAR_SEM] [tinyint] NOT NULL,
	[MASTER_ID] [int] NULL,
	[EXAM_TYPE] [varchar](25) NULL,
	[TOTAL_MAX] [varchar](10) NULL,
	[TOTAL_MIN] [varchar](10) NULL,
	[TOTAL_OBT] [varchar](10) NULL,
	[STATUS] [varchar](10) NULL,
	[SOURCE_TYPE] [varchar](25) NULL,
	[IS_CALCULATED] [bit] NOT NULL,
	[EARN_CREDIT] [int] NULL,
	[GPA] [decimal](10, 3) NULL,
	[TOTAL_CGPA] [decimal](18, 2) NULL,
	[CREDIT_POINT] [decimal](18, 2) NULL,
	[TOTAL_CREDIT] [varchar](10) NULL,
	[THEORY_MAX] [varchar](10) NULL,
	[THEORY_OBT] [varchar](10) NULL,
	[PRACTICAL_MAX] [varchar](10) NULL,
	[PRACTICAL_OBT] [varchar](10) NULL,
	[TOTAL_GRACE] [tinyint] NOT NULL,
	[IS_PROMOTED] [bit] NOT NULL,
	[GRACE_DISPLAY] [varchar](25) NULL,
 CONSTRAINT [PK_STUDENT_SEMESTER_WISE_RECORD_NON_NEP] PRIMARY KEY CLUSTERED 
(
	[RESULT_ID] ASC,
	[YEAR_SEM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SUBJECT_TYPE_MASTER]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SUBJECT_TYPE_MASTER](
	[SUBJECT_TYPE] [varchar](20) NOT NULL,
	[SERIAL] [tinyint] NOT NULL,
 CONSTRAINT [PK_SUBJECT_TYPE_MASTER] PRIMARY KEY CLUSTERED 
(
	[SUBJECT_TYPE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TblStudentMaster]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TblStudentMaster](
	[MasterId] [int] NOT NULL,
	[ExternalId] [int] NOT NULL,
	[StudentName] [varchar](200) NOT NULL,
	[FatherName] [varchar](200) NOT NULL,
	[MotherName] [varchar](200) NOT NULL,
	[GenderCode] [char](1) NOT NULL,
	[Dob] [date] NULL,
	[CategoryCode] [varchar](3) NOT NULL,
	[AdmittedCollegeCode] [varchar](5) NOT NULL,
	[CollegeCode] [varchar](5) NOT NULL,
	[CourseId] [smallint] NOT NULL,
	[CourseCategoryCode] [char](1) NOT NULL,
	[WingTypeCode] [char](1) NOT NULL,
	[AdmissionSession] [varchar](10) NULL,
	[EnrollmentNo] [varchar](20) NULL,
	[RollNo1] [varchar](20) NULL,
	[RollNo2] [varchar](20) NULL,
	[RollNo3] [varchar](20) NULL,
	[Mobile] [varchar](10) NULL,
	[Email] [varchar](50) NULL,
	[PhotoUrl] [varchar](100) NULL,
	[SignatureUrl] [varchar](100) NULL,
	[Subject1] [varchar](100) NOT NULL,
	[Subject2] [varchar](100) NOT NULL,
	[Subject3] [varchar](100) NOT NULL,
	[RollNo4] [varchar](20) NULL,
	[RollNo5] [varchar](20) NULL,
	[SourceType] [varchar](10) NULL,
	[MarkSheetNumber] [varchar](15) NULL,
	[AllYearAvailable] [bit] NOT NULL,
	[MaxMarks] [varchar](10) NULL,
	[MinMarks] [varchar](10) NULL,
	[ObtMarks] [varchar](10) NULL,
	[FinalResult] [varchar](50) NULL,
	[FinalDivision] [varchar](50) NULL,
	[MarksheetYear] [varchar](25) NULL,
	[ResultDate] [varchar](25) NULL,
	[IsPhotoExist] [bit] NOT NULL,
	[mpath] [varchar](500) NULL,
	[MinorSubject] [varchar](100) NULL,
	[VocationalSubject] [varchar](100) NULL,
	[CoCurricularSubject] [varchar](100) NULL,
	[IsPhoto] [bit] NULL,
	[updated_by] [varchar](500) NULL,
	[updated_on] [datetime] NULL,
	[updated_ip] [varchar](500) NULL,
	[created_by] [varchar](500) NULL,
	[created_on] [datetime] NULL,
	[created_ip] [varchar](500) NULL,
	[CorrectEnrollmentNo] [varchar](20) NULL,
	[IsEnrollmentNo] [bit] NOT NULL,
	[HeldIn] [varchar](25) NULL,
	[IsNep] [bit] NOT NULL,
	[CoCurricularResult] [varchar](3) NULL,
	[Dup_MP_Date] [date] NULL,
	[IsDuplicateM] [bit] NOT NULL,
	[ApplicationNo] [varchar](25) NULL,
	[OptionalPaperMarks] [varchar](10) NULL,
	[OptionalPaperStatus] [varchar](15) NULL,
	[OptionalPaperRemarks] [varchar](25) NULL,
	[AadhaarNo] [varchar](15) NULL,
	[ApplicationNumber] [varchar](50) NULL,
	[Uidaierrdesc] [varchar](max) NULL,
	[UidaiResponse] [varchar](max) NULL,
	[IsValidUidai] [bit] NULL,
	[PrintLot] [int] NULL,
	[WebLink] [nvarchar](1000) NULL,
	[LastSession] [varchar](10) NULL,
	[HasSeparatePracticalRow] [bit] NOT NULL,
	[UserUpdateRemarks] [varchar](50) NULL,
	[FileId] [int] NULL,
	[AllowToShow] [bit] NOT NULL,
	[MarksFormatCode] [char](1) NULL,
	[IsOtpVerification] [bit] NOT NULL,
	[OtpVerification] [varchar](10) NULL,
	[BackUpEnrolmentNo] [varchar](100) NULL,
	[IsEnrolFee] [bit] NOT NULL,
	[AbcAccountId] [varchar](25) NULL,
	[GROUPID] [int] NULL,
	[AllowServiceApply] [bit] NOT NULL,
	[IsRwStudent] [bit] NOT NULL,
	[IsCBCS] [bit] NOT NULL,
	[Batch] [varchar](20) NULL,
	[OldCourseId] [int] NULL,
	[LastExamType] [varchar](25) NULL,
	[LastSemNo] [int] NULL,
	[Nationality] [nvarchar](50) NULL,
	[NADLOTNO] [int] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[YEAR_SEM_MASTER]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[YEAR_SEM_MASTER](
	[YEAR_SEM] [tinyint] NOT NULL,
	[SEMESTER] [varchar](10) NULL,
	[SEMESTER_NAME] [varchar](15) NULL,
	[SEMESTER_NAME_PROPER] [varchar](15) NULL,
 CONSTRAINT [PK_YEAR_SEM_MASTER] PRIMARY KEY CLUSTERED 
(
	[YEAR_SEM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY],
 CONSTRAINT [UC_YEAR_SEM_MASTER_SEMESTER] UNIQUE NONCLUSTERED 
(
	[SEMESTER] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY],
 CONSTRAINT [UC_YEAR_SEM_MASTER_SEMESTER_NAME] UNIQUE NONCLUSTERED 
(
	[SEMESTER_NAME] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY],
 CONSTRAINT [UC_YEAR_SEM_MASTER_SEMESTER_NAME_PROPER] UNIQUE NONCLUSTERED 
(
	[SEMESTER_NAME_PROPER] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IDX_STUDENT_MASTER_ENROLLMENT_NO]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE NONCLUSTERED INDEX [IDX_STUDENT_MASTER_ENROLLMENT_NO] ON [dbo].[STUDENT_MASTER]
(
	[ENROLLMENT_NO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IDX_STUDENT_MASTER_DETAIL_ROLL_NO]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE NONCLUSTERED INDEX [IDX_STUDENT_MASTER_DETAIL_ROLL_NO] ON [dbo].[STUDENT_MASTER_DETAIL]
(
	[ROLL_NO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_STUDENT_MASTER_DETAIL_COURSE_ID_MAIN]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE NONCLUSTERED INDEX [IX_STUDENT_MASTER_DETAIL_COURSE_ID_MAIN] ON [dbo].[STUDENT_MASTER_DETAIL]
(
	[COURSE_ID_MAIN] ASC
)
INCLUDE([COLLEGE_CODE],[ROLL_NO]) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IDX_STUDENT_RESULT_ROLL_NO]    Script Date: 12/25/2025 4:39:39 PM ******/
CREATE NONCLUSTERED INDEX [IDX_STUDENT_RESULT_ROLL_NO] ON [dbo].[STUDENT_RESULT]
(
	[ROLL_NO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
ALTER TABLE [dbo].[AdminMasters] ADD  CONSTRAINT [DF__AdminMasters__Islive]  DEFAULT ((1)) FOR [Islive]
GO
ALTER TABLE [dbo].[AdminMasters] ADD  CONSTRAINT [DF_AdminMasters_BranchID]  DEFAULT ((0)) FOR [BranchID]
GO
ALTER TABLE [dbo].[COURSE_APPLY_RULE_TEMP] ADD  CONSTRAINT [DF_COURSE_APPLY_RULE_ISRW]  DEFAULT ((0)) FOR [ISRW]
GO
ALTER TABLE [dbo].[COURSE_APPLY_RULE_TEMP] ADD  CONSTRAINT [DF_COURSE_APPLY_RULE_ISACTIVE]  DEFAULT ((0)) FOR [ISACTIVE]
GO
ALTER TABLE [dbo].[COURSE_APPLY_RULE_TEMP] ADD  CONSTRAINT [DF_COURSE_APPLY_RULE_CREATEON]  DEFAULT (getdate()) FOR [CREATEON]
GO
ALTER TABLE [dbo].[COURSE_APPLY_RULE_TEMP] ADD  CONSTRAINT [DF_COURSE_APPLY_RULE_CREATEON1]  DEFAULT (getdate()) FOR [UPDATEON]
GO
ALTER TABLE [dbo].[COURSE_GRADE_POINT] ADD  CONSTRAINT [DFCOURSE_GRADE_POINT_CREDIT_NEP_BE_RANGE_FROM]  DEFAULT ((0)) FOR [RangeFrom]
GO
ALTER TABLE [dbo].[COURSE_GRADE_POINT] ADD  CONSTRAINT [DF_COURSE_GRADE_POINT_CREDIT_NEP_BE_RANGE_TO]  DEFAULT ((0)) FOR [RangeTo]
GO
ALTER TABLE [dbo].[PAPER_MASTER] ADD  CONSTRAINT [DF_PAPER_MASTER_IS_QUALIFIYING]  DEFAULT ((0)) FOR [IS_QUALIFIYING]
GO
ALTER TABLE [dbo].[PAPER_MASTER] ADD  CONSTRAINT [DF_PAPER_MASTER_ISRW]  DEFAULT ((0)) FOR [ISRW]
GO
ALTER TABLE [dbo].[PAPER_MASTER] ADD  CONSTRAINT [DF_PAPER_MASTER_PAPER_SERIAL_NO]  DEFAULT ((0)) FOR [PAPER_SERIAL_NO]
GO
ALTER TABLE [dbo].[STUDENT_MARKS] ADD  CONSTRAINT [DF_STUDENT_MARKS_THEORY_PRACT_MW]  DEFAULT ((0)) FOR [THEORY_PRACT_MW]
GO
ALTER TABLE [dbo].[STUDENT_MARKS] ADD  CONSTRAINT [DF_STUDENT_MARKS_INTERNAL_MW]  DEFAULT ((0)) FOR [INTERNAL_MW]
GO
ALTER TABLE [dbo].[STUDENT_MARKS] ADD  CONSTRAINT [DF_STUDENT_MARKS_SESSIONAL_MW]  DEFAULT ((0)) FOR [SESSIONAL_MW]
GO
ALTER TABLE [dbo].[STUDENT_MARKS] ADD  CONSTRAINT [DF_STUDENT_MARKS_UFM]  DEFAULT ((0)) FOR [UFM]
GO
ALTER TABLE [dbo].[STUDENT_MARKS] ADD  CONSTRAINT [DF_STUDENT_MARKS_ADD_PAPER_CREDIT]  DEFAULT ((0)) FOR [ADD_PAPER_CREDIT]
GO
ALTER TABLE [dbo].[STUDENT_MARKS_LOAL_LOG] ADD  CONSTRAINT [DF_STUDENT_MARKS_LOG_INTERNAL_MW]  DEFAULT ((0)) FOR [INTERNAL_MW]
GO
ALTER TABLE [dbo].[STUDENT_MARKS_LOAL_LOG] ADD  CONSTRAINT [DF_STUDENT_MARKS_LOG_SESSIONAL_MW]  DEFAULT ((0)) FOR [SESSIONAL_MW]
GO
ALTER TABLE [dbo].[STUDENT_MARKS_LOAL_LOG] ADD  CONSTRAINT [DF_STUDENT_MARKS_LOG_UFM]  DEFAULT ((0)) FOR [UFM]
GO
ALTER TABLE [dbo].[STUDENT_MASTER] ADD  CONSTRAINT [DF_STUDENT_MASTER_IS_VRS]  DEFAULT ((0)) FOR [IS_VRS]
GO
ALTER TABLE [dbo].[STUDENT_MASTER_DETAIL] ADD  CONSTRAINT [DF_STUDENT_MASTER_DETAIL_IS_VRS]  DEFAULT ((0)) FOR [IS_VRS]
GO
ALTER TABLE [dbo].[STUDENT_RESULT] ADD  CONSTRAINT [DF_STUDENT_RESULT_IS_PENDING_SYNC]  DEFAULT ((0)) FOR [IS_PENDING_SYNC]
GO
ALTER TABLE [dbo].[STUDENT_RESULT] ADD  CONSTRAINT [DF_STUDENT_RESULT_IS_LIVE]  DEFAULT ((0)) FOR [IS_LIVE]
GO
ALTER TABLE [dbo].[STUDENT_RESULT] ADD  CONSTRAINT [DF_STUDENT_RESULT_IS_UFM]  DEFAULT ((0)) FOR [IS_UFM]
GO
ALTER TABLE [dbo].[STUDENT_RESULT] ADD  CONSTRAINT [DF_STUDENT_RESULT_GROUPID]  DEFAULT ((0)) FOR [GROUPID]
GO
ALTER TABLE [dbo].[STUDENT_RESULT] ADD  CONSTRAINT [DF_STUDENT_RESULT_ORDINANCE_ID]  DEFAULT ((0)) FOR [ORDINANCE_ID]
GO
ALTER TABLE [dbo].[STUDENT_RESULT_LOCAL_LOG] ADD  CONSTRAINT [DF_STUDENT_RESULT_LOG_IS_PENDING_SYNC]  DEFAULT ((0)) FOR [IS_PENDING_SYNC]
GO
ALTER TABLE [dbo].[STUDENT_RESULT_LOCAL_LOG] ADD  CONSTRAINT [DF__STUDENT_LOG_R__IS_LI__0F4D3C5F]  DEFAULT ((0)) FOR [IS_LIVE]
GO
ALTER TABLE [dbo].[STUDENT_RESULT_LOCAL_LOG] ADD  CONSTRAINT [DF__STUDENT_LOG_R__IS_UF__27AED5D5]  DEFAULT ((0)) FOR [IS_UFM]
GO
ALTER TABLE [dbo].[STUDENT_RESULT_LOCAL_LOG] ADD  CONSTRAINT [DF_STUDENT_RESULT_LOG_ORDINANCE_ID]  DEFAULT ((0)) FOR [ORDINANCE_ID]
GO
ALTER TABLE [dbo].[STUDENT_RESULT_LOCAL_LOG] ADD  CONSTRAINT [DF_STUDENT_RESULT_LOCAL_LOG_GROUPID]  DEFAULT ((0)) FOR [GROUPID]
GO
ALTER TABLE [dbo].[STUDENT_SEMESTER_WISE_RECORD_NEP] ADD  CONSTRAINT [DF_STUDENT_SEMESTER_WISE_RECORD_NEP_IS_CALCULATED]  DEFAULT ((0)) FOR [IS_CALCULATED]
GO
ALTER TABLE [dbo].[STUDENT_SEMESTER_WISE_RECORD_NON_NEP] ADD  CONSTRAINT [DF_STUDENT_SEMESTER_WISE_RECORD_NON_NEP_IS_CALCULATED]  DEFAULT ((0)) FOR [IS_CALCULATED]
GO
ALTER TABLE [dbo].[STUDENT_SEMESTER_WISE_RECORD_NON_NEP] ADD  CONSTRAINT [DF__STUDENT_S__TOTAL__7F01C5FD]  DEFAULT ((0)) FOR [TOTAL_GRACE]
GO
ALTER TABLE [dbo].[STUDENT_SEMESTER_WISE_RECORD_NON_NEP] ADD  CONSTRAINT [DF_STUDENT_SEMESTER_WISE_RECORD_NON_NEP_IS_PROMOTED]  DEFAULT ((0)) FOR [IS_PROMOTED]
GO
ALTER TABLE [dbo].[AdminMasterRoles]  WITH CHECK ADD  CONSTRAINT [FK_AdminMasterRoles_Roles] FOREIGN KEY([RoleId])
REFERENCES [dbo].[Roles] ([RoleId])
GO
ALTER TABLE [dbo].[AdminMasterRoles] CHECK CONSTRAINT [FK_AdminMasterRoles_Roles]
GO
/****** Object:  StoredProcedure [dbo].[APP_CREATE_STUDENT_DETAIL_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_CREATE_STUDENT_DETAIL_LOG]
    @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT, @LOG_DATE_TIME DATETIME
AS
BEGIN

    INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_LOG
    (
        MASTER_ID, LOG_SERIAL, LOG_DATE_TIME, SOURCE_TYPE, ENROLLMENT_NO, AADHAAR_NO, ABC_ACCOUNT_ID, STUDENT_NAME,
        FATHER_NAME, MOTHER_NAME, GENDER, CATEGORY, SUB_CATEGORY, DOB, NATIONALITY_CODE, COUNTRY_CODE, MOBILE,
        FOREIGN_MOBILE_NO, EMAIL, ALTERNATE_MOBILE, GUARDIAN_MOBILE, PHOTO_PATH, SIGNATURE_PATH, MOBILE_VERIFIED,
        EMAIL_VERIFIED, LOGIN_PASSWORD, REMARKS, CREATED_AT, CREATED_BY, LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE,
        RU_NUMBER, LAST_APPROVED_BY, LAST_APPROVED_AT, LAST_EDIT_REMARKS, APPLICATION_DOCUMENT
    )
    SELECT  MASTER_ID, @LOG_SERIAL, @LOG_DATE_TIME, SOURCE_TYPE, ENROLLMENT_NO, AADHAAR_NO, ABC_ACCOUNT_ID,
            STUDENT_NAME, FATHER_NAME, MOTHER_NAME, GENDER, CATEGORY, SUB_CATEGORY, DOB, NATIONALITY_CODE,
            COUNTRY_CODE, MOBILE, FOREIGN_MOBILE_NO, EMAIL, ALTERNATE_MOBILE, GUARDIAN_MOBILE, PHOTO_PATH,
            SIGNATURE_PATH, MOBILE_VERIFIED, EMAIL_VERIFIED, LOGIN_PASSWORD, REMARKS, CREATED_AT, CREATED_BY,
            LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE, RU_NUMBER, LAST_APPROVED_BY, LAST_APPROVED_AT,
            LAST_EDIT_REMARKS, APPLICATION_DOCUMENT
    FROM    dbo.STUDENT_MASTER
    WHERE   MASTER_ID = @MASTER_ID
    
    IF @RESULT_ID > -1
    BEGIN

        INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_LOG
        (
            RESULT_ID, LOG_SERIAL, LOG_DATE_TIME, MASTER_ID, SOURCE_TYPE, ROLL_NO, COURSE_ID, EXAM_TYPE, SESSION,
            YEAR_SEM, COLLEGE_CODE, IS_HISTORY, WING_TYPE_CODE, THEORY_MAX_MARKS, THEORY_MIN_MARKS, THEORY_OBT_MARKS,
            PRACTICAL_MAX_MARKS, PRACTICAL_MIN_MARKS, PRACTICAL_OBT_MARKS, INTERNAL_MAX_MARKS, INTERNAL_MIN_MARKS,
            INTERNAL_OBT_MARKS, SESSIONAL_MAX_MARKS, SESSIONAL_MIN_MARKS, SESSIONAL_OBT_MARKS, TOTAL_MAX_MARKS,
            TOTAL_MIN_MARKS, TOTAL_OBT_MARKS, RG_CODE, RG_MAX_MARKS, RG_MIN_MARKS, RG_OBT_MARKS, RG_RESULT, ES_CODE,
            ES_MAX_MARKS, ES_MIN_MARKS, ES_OBT_MARKS, ES_RESULT, CO_CURRICULAR_RESULT, SEMESTER_RESULT, FINAL_RESULT,
            FINAL_DIVISION, PRACTICAL_RESULT, PRACTICAL_DIVISION, PROMOTED, TOTAL_CREDIT, EARNED_CREDIT, TOTAL_POINT,
            TOTAL_GRADE_POINT, SGPA, CUM_TOTAL_CREDIT, CUM_TOTAL_EARNED_CREDIT, CUM_TOTAL_POINT, CGPA, EXAM_NAME,
            HELD_IN, MARKSHEET_NO, PRINT_LOT_NO, RESULT_DATE, IS_PUBLISHED, PUBLISH_DATE, LAST_ORDINANCE_RUN_AT,
            CREATED_AT, CREATED_BY, LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE, THEORY_DIVISION, RESULT_PATTERN
        )
        SELECT  RESULT_ID, @LOG_SERIAL, @LOG_DATE_TIME, MASTER_ID, SOURCE_TYPE, ROLL_NO, COURSE_ID, EXAM_TYPE, SESSION,
                YEAR_SEM, COLLEGE_CODE, IS_HISTORY, WING_TYPE_CODE, THEORY_MAX_MARKS, THEORY_MIN_MARKS,
                THEORY_OBT_MARKS, PRACTICAL_MAX_MARKS, PRACTICAL_MIN_MARKS, PRACTICAL_OBT_MARKS, INTERNAL_MAX_MARKS,
                INTERNAL_MIN_MARKS, INTERNAL_OBT_MARKS, SESSIONAL_MAX_MARKS, SESSIONAL_MIN_MARKS, SESSIONAL_OBT_MARKS,
                TOTAL_MAX_MARKS, TOTAL_MIN_MARKS, TOTAL_OBT_MARKS, RG_CODE, RG_MAX_MARKS, RG_MIN_MARKS, RG_OBT_MARKS,
                RG_RESULT, ES_CODE, ES_MAX_MARKS, ES_MIN_MARKS, ES_OBT_MARKS, ES_RESULT, CO_CURRICULAR_RESULT,
                SEMESTER_RESULT, FINAL_RESULT, FINAL_DIVISION, PRACTICAL_RESULT, PRACTICAL_DIVISION, PROMOTED,
                TOTAL_CREDIT, EARNED_CREDIT, TOTAL_POINT, TOTAL_GRADE_POINT, SGPA, CUM_TOTAL_CREDIT,
                CUM_TOTAL_EARNED_CREDIT, CUM_TOTAL_POINT, CGPA, EXAM_NAME, HELD_IN, MARKSHEET_NO, PRINT_LOT_NO,
                RESULT_DATE, IS_PUBLISHED, PUBLISH_DATE, LAST_ORDINANCE_RUN_AT, CREATED_AT, CREATED_BY,
                LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE, THEORY_DIVISION, RESULT_PATTERN
        FROM    dbo.STUDENT_RESULT
        WHERE   RESULT_ID = @RESULT_ID
        
        INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MARKS_LOG
        (
            RESULT_ID, MARKS_ID, LOG_SERIAL, LOG_DATE_TIME, SUBJECT_SERIAL, PAPER_SERIAL, MASTER_ID, EXTERNAL_ID,
            ROLL_NO, COURSE_ID, EXAM_TYPE, SESSION, YEAR_SEM, COLLEGE_CODE, SUBJECT_CODE, SUBJECT_TYPE,
            SUBJECT_TYPE_SERIAL, SUBJECT_NAME, PAPER_CODE, PAPER_NAME, CREDIT, EARNED_CREDIT, POINT, GRADE_POINT,
            GRADE, THEORY_MAX, THEORY_MIN, THEORY_OBT, THEORY_GRACE, THEORY_PRACT_ABSENT, PRACTICAL_MAX, PRACTICAL_MIN,
            PRACTICAL_OBT, PRACTICAL_ABSENT, INTERNAL_MAX, INTERNAL_MIN, INTERNAL_OBT, INTERNAL_ABSENT, SESSIONAL_MAX,
            SESSIONAL_MIN, SESSIONAL_OBT, SESSIONAL_ABSENT, TOTAL_MAX, TOTAL_MIN, TOTAL_OBT, SUBJECT_GRACE,
            PAPER_STATUS, SUBJECT_STATUS, RE_EX, OLD_MARKS, BACK_POST_ID, BARCODE, OMR_FEE_PAID, SCAN_IMAGE_PATH,
            OMR_SERIES, ANSWER_KEY_PATH, CREATED_AT, CREATED_BY, LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE, MW,
            SOURCE_TYPE, CREDIT_POINT, CATCH_CODE
        )
        SELECT  RESULT_ID, MARKS_ID, @LOG_SERIAL, @LOG_DATE_TIME, SUBJECT_SERIAL, PAPER_SERIAL, MASTER_ID, EXTERNAL_ID,
                ROLL_NO, COURSE_ID, EXAM_TYPE, SESSION, YEAR_SEM, COLLEGE_CODE, SUBJECT_CODE, SUBJECT_TYPE,
                SUBJECT_TYPE_SERIAL, SUBJECT_NAME, PAPER_CODE, PAPER_NAME, CREDIT, EARNED_CREDIT, POINT, GRADE_POINT,
                GRADE, THEORY_MAX, THEORY_MIN, THEORY_OBT, THEORY_GRACE, THEORY_PRACT_ABSENT, PRACTICAL_MAX,
                PRACTICAL_MIN, PRACTICAL_OBT, PRACTICAL_ABSENT, INTERNAL_MAX, INTERNAL_MIN, INTERNAL_OBT,
                INTERNAL_ABSENT, SESSIONAL_MAX, SESSIONAL_MIN, SESSIONAL_OBT, SESSIONAL_ABSENT, TOTAL_MAX, TOTAL_MIN,
                TOTAL_OBT, SUBJECT_GRACE, PAPER_STATUS, SUBJECT_STATUS, RE_EX, OLD_MARKS, BACK_POST_ID, BARCODE,
                OMR_FEE_PAID, SCAN_IMAGE_PATH, OMR_SERIES, ANSWER_KEY_PATH, CREATED_AT, CREATED_BY, LAST_UPDATED_AT,
                LAST_UPDATED_BY, IS_ACTIVE, MW, SOURCE_TYPE, CREDIT_POINT, CATCH_CODE
        FROM    dbo.STUDENT_MARKS
        WHERE   RESULT_ID = @RESULT_ID

        INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_SEMESTER_WISE_RECORD_NEP
        (
            RESULT_ID, YEAR_SEM, LOG_SERIAL, LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_CREDIT, TOTAL_EARNED_CREDIT,
            SGPA, STATUS, QUALIFIED, SOURCE_TYPE
        )
        SELECT  RESULT_ID, YEAR_SEM, @LOG_SERIAL, @LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_CREDIT,
                TOTAL_EARNED_CREDIT, SGPA, STATUS, QUALIFIED, SOURCE_TYPE
        FROM    dbo.STUDENT_SEMESTER_WISE_RECORD_NEP
        WHERE   RESULT_ID = @RESULT_ID

        INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP
        (
            RESULT_ID, YEAR_SEM, LOG_SERIAL, LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_MAX, TOTAL_MIN, TOTAL_OBT,
            STATUS, SOURCE_TYPE
        )
        SELECT  RESULT_ID, YEAR_SEM, @LOG_SERIAL, @LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_MAX, TOTAL_MIN,
                TOTAL_OBT, STATUS, SOURCE_TYPE
        FROM    dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP
        WHERE   RESULT_ID = @RESULT_ID

    END
END
GO
/****** Object:  StoredProcedure [dbo].[APP_CREATE_STUDENT_DETAIL_TEMP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_CREATE_STUDENT_DETAIL_TEMP]
    @RU_NUMBER VARCHAR(25), @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT, @LOG_DATE_TIME DATETIME, @USER_ID INT,
    @REMARKS VARCHAR(500)
AS
BEGIN

    --DECLARE @YEAR_SEM TINYINT
    --SELECT @YEAR_SEM = YEAR_SEM FROM dbo.STUDENT_RESULT WHERE RESULT_ID = @RESULT_ID

    UPDATE          M
    SET             M.ALLOW_TO_APPROVE = 0
    FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
        INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
            ON M.MASTER_ID = R.MASTER_ID
               AND  M.LOG_SERIAL = R.LOG_SERIAL
    WHERE           R.RESULT_ID = @RESULT_ID

    INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP
    (
        MASTER_ID, LOG_SERIAL, LOG_DATE_TIME, SOURCE_TYPE, ENROLLMENT_NO, AADHAAR_NO, ABC_ACCOUNT_ID, STUDENT_NAME,
        FATHER_NAME, MOTHER_NAME, GENDER, CATEGORY, SUB_CATEGORY, DOB, NATIONALITY_CODE, COUNTRY_CODE, MOBILE,
        FOREIGN_MOBILE_NO, EMAIL, ALTERNATE_MOBILE, GUARDIAN_MOBILE, PHOTO_PATH, SIGNATURE_PATH, MOBILE_VERIFIED,
        EMAIL_VERIFIED, LOGIN_PASSWORD, REMARKS, CREATED_AT, CREATED_BY, LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE,
        RU_NUMBER, LAST_EDIT_REMARKS, ALLOW_TO_APPROVE, APPLICATION_DOCUMENT
    )
    SELECT  MASTER_ID, @LOG_SERIAL, @LOG_DATE_TIME, SOURCE_TYPE, ENROLLMENT_NO, AADHAAR_NO, ABC_ACCOUNT_ID,
            STUDENT_NAME, FATHER_NAME, MOTHER_NAME, GENDER, CATEGORY, SUB_CATEGORY, DOB, NATIONALITY_CODE,
            COUNTRY_CODE, MOBILE, FOREIGN_MOBILE_NO, EMAIL, ALTERNATE_MOBILE, GUARDIAN_MOBILE, PHOTO_PATH,
            SIGNATURE_PATH, MOBILE_VERIFIED, EMAIL_VERIFIED, LOGIN_PASSWORD, REMARKS, CREATED_AT, CREATED_BY,
            @LOG_DATE_TIME, @USER_ID, IS_ACTIVE, @RU_NUMBER, @REMARKS, 1, ''
    FROM    dbo.STUDENT_MASTER
    WHERE   MASTER_ID = @MASTER_ID

    INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP
    (
        RESULT_ID, LOG_SERIAL, LOG_DATE_TIME, MASTER_ID, SOURCE_TYPE, ROLL_NO, COURSE_ID, EXAM_TYPE, SESSION, YEAR_SEM,
        COLLEGE_CODE, IS_HISTORY, WING_TYPE_CODE, THEORY_MAX_MARKS, THEORY_MIN_MARKS, THEORY_OBT_MARKS,
        PRACTICAL_MAX_MARKS, PRACTICAL_MIN_MARKS, PRACTICAL_OBT_MARKS, INTERNAL_MAX_MARKS, INTERNAL_MIN_MARKS,
        INTERNAL_OBT_MARKS, SESSIONAL_MAX_MARKS, SESSIONAL_MIN_MARKS, SESSIONAL_OBT_MARKS, TOTAL_MAX_MARKS,
        TOTAL_MIN_MARKS, TOTAL_OBT_MARKS, RG_CODE, RG_MAX_MARKS, RG_MIN_MARKS, RG_OBT_MARKS, RG_RESULT, ES_CODE,
        ES_MAX_MARKS, ES_MIN_MARKS, ES_OBT_MARKS, ES_RESULT, CO_CURRICULAR_RESULT, SEMESTER_RESULT, FINAL_RESULT,
        FINAL_DIVISION, PRACTICAL_RESULT, PRACTICAL_DIVISION, PROMOTED, TOTAL_CREDIT, EARNED_CREDIT, TOTAL_POINT,
        TOTAL_GRADE_POINT, SGPA, CUM_TOTAL_CREDIT, CUM_TOTAL_EARNED_CREDIT, CUM_TOTAL_POINT, CGPA, EXAM_NAME, HELD_IN,
        MARKSHEET_NO, PRINT_LOT_NO, RESULT_DATE, IS_PUBLISHED, PUBLISH_DATE, LAST_ORDINANCE_RUN_AT, CREATED_AT,
        CREATED_BY, LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE, THEORY_DIVISION, RESULT_PATTERN
    )
    SELECT  RESULT_ID, @LOG_SERIAL, @LOG_DATE_TIME, MASTER_ID, SOURCE_TYPE, ROLL_NO, COURSE_ID, EXAM_TYPE, SESSION,
            YEAR_SEM, COLLEGE_CODE, IS_HISTORY, WING_TYPE_CODE, THEORY_MAX_MARKS, THEORY_MIN_MARKS, THEORY_OBT_MARKS,
            PRACTICAL_MAX_MARKS, PRACTICAL_MIN_MARKS, PRACTICAL_OBT_MARKS, INTERNAL_MAX_MARKS, INTERNAL_MIN_MARKS,
            INTERNAL_OBT_MARKS, SESSIONAL_MAX_MARKS, SESSIONAL_MIN_MARKS, SESSIONAL_OBT_MARKS, TOTAL_MAX_MARKS,
            TOTAL_MIN_MARKS, TOTAL_OBT_MARKS, RG_CODE, RG_MAX_MARKS, RG_MIN_MARKS, RG_OBT_MARKS, RG_RESULT, ES_CODE,
            ES_MAX_MARKS, ES_MIN_MARKS, ES_OBT_MARKS, ES_RESULT, CO_CURRICULAR_RESULT, SEMESTER_RESULT, FINAL_RESULT,
            FINAL_DIVISION, PRACTICAL_RESULT, PRACTICAL_DIVISION, PROMOTED, TOTAL_CREDIT, EARNED_CREDIT, TOTAL_POINT,
            TOTAL_GRADE_POINT, SGPA, CUM_TOTAL_CREDIT, CUM_TOTAL_EARNED_CREDIT, CUM_TOTAL_POINT, CGPA, EXAM_NAME,
            HELD_IN, MARKSHEET_NO, PRINT_LOT_NO, RESULT_DATE, IS_PUBLISHED, PUBLISH_DATE, LAST_ORDINANCE_RUN_AT,
            CREATED_AT, CREATED_BY, @LOG_DATE_TIME, @USER_ID, IS_ACTIVE, THEORY_DIVISION, RESULT_PATTERN
    FROM    dbo.STUDENT_RESULT
    WHERE   RESULT_ID = @RESULT_ID

    INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MARKS_TEMP
    (
        RESULT_ID, MARKS_ID, LOG_SERIAL, LOG_DATE_TIME, SUBJECT_SERIAL, PAPER_SERIAL, MASTER_ID, EXTERNAL_ID, ROLL_NO,
        COURSE_ID, EXAM_TYPE, SESSION, YEAR_SEM, COLLEGE_CODE, SUBJECT_CODE, SUBJECT_TYPE, SUBJECT_TYPE_SERIAL,
        SUBJECT_NAME, PAPER_CODE, PAPER_NAME, CREDIT, EARNED_CREDIT, POINT, GRADE_POINT, GRADE, THEORY_MAX, THEORY_MIN,
        THEORY_OBT, THEORY_GRACE, THEORY_PRACT_ABSENT, PRACTICAL_MAX, PRACTICAL_MIN, PRACTICAL_OBT, PRACTICAL_ABSENT,
        INTERNAL_MAX, INTERNAL_MIN, INTERNAL_OBT, INTERNAL_ABSENT, SESSIONAL_MAX, SESSIONAL_MIN, SESSIONAL_OBT,
        SESSIONAL_ABSENT, TOTAL_MAX, TOTAL_MIN, TOTAL_OBT, SUBJECT_GRACE, PAPER_STATUS, SUBJECT_STATUS, RE_EX,
        OLD_MARKS, BACK_POST_ID, BARCODE, OMR_FEE_PAID, SCAN_IMAGE_PATH, OMR_SERIES, ANSWER_KEY_PATH, CREATED_AT,
        CREATED_BY, LAST_UPDATED_AT, LAST_UPDATED_BY, IS_ACTIVE, MW, SOURCE_TYPE, CREDIT_POINT, CATCH_CODE
    )
    SELECT  RESULT_ID, MARKS_ID, @LOG_SERIAL, @LOG_DATE_TIME, SUBJECT_SERIAL, PAPER_SERIAL, MASTER_ID, EXTERNAL_ID,
            ROLL_NO, COURSE_ID, EXAM_TYPE, SESSION, YEAR_SEM, COLLEGE_CODE, SUBJECT_CODE, SUBJECT_TYPE,
            SUBJECT_TYPE_SERIAL, SUBJECT_NAME, PAPER_CODE, PAPER_NAME, CREDIT, EARNED_CREDIT, POINT, GRADE_POINT,
            GRADE, THEORY_MAX, THEORY_MIN, THEORY_OBT, THEORY_GRACE, THEORY_PRACT_ABSENT, PRACTICAL_MAX, PRACTICAL_MIN,
            PRACTICAL_OBT, PRACTICAL_ABSENT, INTERNAL_MAX, INTERNAL_MIN, INTERNAL_OBT, INTERNAL_ABSENT, SESSIONAL_MAX,
            SESSIONAL_MIN, SESSIONAL_OBT, SESSIONAL_ABSENT, TOTAL_MAX, TOTAL_MIN, TOTAL_OBT, SUBJECT_GRACE,
            PAPER_STATUS, SUBJECT_STATUS, RE_EX, OLD_MARKS, BACK_POST_ID, BARCODE, OMR_FEE_PAID, SCAN_IMAGE_PATH,
            OMR_SERIES, ANSWER_KEY_PATH, CREATED_AT, CREATED_BY, @LOG_DATE_TIME, @USER_ID, IS_ACTIVE, MW, SOURCE_TYPE,
            CREDIT_POINT, CATCH_CODE
    FROM    dbo.STUDENT_MARKS
    WHERE   RESULT_ID = @RESULT_ID

    INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_SEMESTER_WISE_RECORD_NEP_TEMP
    (
        RESULT_ID, YEAR_SEM, LOG_SERIAL, LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_CREDIT, TOTAL_EARNED_CREDIT, SGPA,
        STATUS, QUALIFIED, SOURCE_TYPE
    )
    SELECT  RESULT_ID, YEAR_SEM, @LOG_SERIAL, @LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_CREDIT, TOTAL_EARNED_CREDIT,
            SGPA, STATUS, QUALIFIED, SOURCE_TYPE
    FROM    dbo.STUDENT_SEMESTER_WISE_RECORD_NEP
    WHERE   RESULT_ID = @RESULT_ID

    INSERT INTO AGRA_RESULT_DEMO_LOG.dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP_TEMP
    (
        RESULT_ID, YEAR_SEM, LOG_SERIAL, LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_MAX, TOTAL_MIN, TOTAL_OBT, STATUS,
        SOURCE_TYPE
    )
    SELECT  RESULT_ID, YEAR_SEM, @LOG_SERIAL, @LOG_DATE_TIME, MASTER_ID, EXAM_TYPE, TOTAL_MAX, TOTAL_MIN, TOTAL_OBT,
            STATUS, SOURCE_TYPE
    FROM    dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP
    WHERE   RESULT_ID = @RESULT_ID

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_MARKS]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_MARKS] @RESULT_ID INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_MARKS @RESULT_ID = 103056  -- int

    SET NOCOUNT ON

    DECLARE @LOG_SERIAL INT

    SELECT          @LOG_SERIAL = ISNULL(MAX(M.LOG_SERIAL), 0)
    FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
        INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
            ON M.MASTER_ID = R.MASTER_ID
               AND  M.LOG_SERIAL = R.LOG_SERIAL
    WHERE           R.RESULT_ID = @RESULT_ID
                    AND M.ALLOW_TO_APPROVE = 1

    IF @LOG_SERIAL = 0
    BEGIN

        SELECT          M.RESULT_ID, M.MARKS_ID, M.SUBJECT_SERIAL, M.PAPER_SERIAL, M.MASTER_ID, M.EXTERNAL_ID, M.ROLL_NO,
                        M.COURSE_ID, M.EXAM_TYPE, M.SESSION, M.YEAR_SEM, M.COLLEGE_CODE, M.SUBJECT_CODE, M.SUBJECT_TYPE,
                        M.SUBJECT_TYPE_SERIAL, PM.SUBJECT_NAME, M.PAPER_CODE, PM.PAPER_NAME, M.CREDIT, M.EARNED_CREDIT,
                        M.POINT, M.GRADE_POINT, M.GRADE, PM.THEORY_MAX, PM.THEORY_MIN, M.THEORY_OBT, M.THEORY_GRACE,
                        M.THEORY_PRACT_ABSENT, PM.PRACTICAL_MAX, PM.PRACTICAL_MIN, M.PRACTICAL_OBT, M.PRACTICAL_ABSENT,
                        PM.INTERNAL_MAX, PM.INTERNAL_MIN, M.INTERNAL_OBT, M.INTERNAL_ABSENT, PM.SESSIONAL_MAX,
                        PM.SESSIONAL_MIN, M.SESSIONAL_OBT, M.SESSIONAL_ABSENT, PM.TOTAL_MAX, PM.TOTAL_MIN, M.TOTAL_OBT,
                        M.SUBJECT_GRACE, M.PAPER_STATUS, M.SUBJECT_STATUS, M.RE_EX, M.OLD_MARKS, M.BACK_POST_ID, M.BARCODE,
                        M.OMR_FEE_PAID, M.SCAN_IMAGE_PATH, M.OMR_SERIES, M.ANSWER_KEY_PATH, M.CREATED_AT, M.CREATED_BY,
                        M.LAST_UPDATED_AT, M.LAST_UPDATED_BY, M.IS_ACTIVE, M.MW, M.SOURCE_TYPE, M.CREDIT_POINT, M.CATCH_CODE,
                        PM.IS_QUALIFIYING
        FROM            dbo.STUDENT_MARKS M
            INNER JOIN  dbo.PAPER_MASTER PM
                ON M.PAPER_CODE = PM.PAPER_CODE
                   --AND  M.SESSION = PM.SESSION
        WHERE           M.RESULT_ID = @RESULT_ID
        ORDER BY        M.SUBJECT_SERIAL, M.PAPER_SERIAL

    END
    ELSE
    BEGIN
        SELECT          M.RESULT_ID, M.MARKS_ID, M.SUBJECT_SERIAL, M.PAPER_SERIAL, M.MASTER_ID, M.EXTERNAL_ID, M.ROLL_NO,
                        M.COURSE_ID, M.EXAM_TYPE, M.SESSION, M.YEAR_SEM, M.COLLEGE_CODE, M.SUBJECT_CODE, M.SUBJECT_TYPE,
                        M.SUBJECT_TYPE_SERIAL, PM.SUBJECT_NAME, M.PAPER_CODE, PM.PAPER_NAME, M.CREDIT, M.EARNED_CREDIT,
                        M.POINT, M.GRADE_POINT, M.GRADE, PM.THEORY_MAX, PM.THEORY_MIN, M.THEORY_OBT, M.THEORY_GRACE,
                        M.THEORY_PRACT_ABSENT, PM.PRACTICAL_MAX, PM.PRACTICAL_MIN, M.PRACTICAL_OBT, M.PRACTICAL_ABSENT,
                        PM.INTERNAL_MAX, PM.INTERNAL_MIN, M.INTERNAL_OBT, M.INTERNAL_ABSENT, PM.SESSIONAL_MAX,
                        PM.SESSIONAL_MIN, M.SESSIONAL_OBT, M.SESSIONAL_ABSENT, PM.TOTAL_MAX, PM.TOTAL_MIN, M.TOTAL_OBT,
                        M.SUBJECT_GRACE, M.PAPER_STATUS, M.SUBJECT_STATUS, M.RE_EX, M.OLD_MARKS, M.BACK_POST_ID, M.BARCODE,
                        M.OMR_FEE_PAID, M.SCAN_IMAGE_PATH, M.OMR_SERIES, M.ANSWER_KEY_PATH, M.CREATED_AT, M.CREATED_BY,
                        M.LAST_UPDATED_AT, M.LAST_UPDATED_BY, M.IS_ACTIVE, M.MW, M.SOURCE_TYPE, M.CREDIT_POINT, M.CATCH_CODE,
                        PM.IS_QUALIFIYING
        FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MARKS_TEMP M
            INNER JOIN  dbo.PAPER_MASTER PM
                ON M.PAPER_CODE = PM.PAPER_CODE
                   --AND  M.SESSION = PM.SESSION
        WHERE           M.RESULT_ID = @RESULT_ID
                        AND M.LOG_SERIAL = @LOG_SERIAL
        ORDER BY        M.SUBJECT_SERIAL, M.PAPER_SERIAL
    END


END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_MARKS_NON_NEP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_MARKS_NON_NEP] @RESULT_ID INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_MARKS_NON_NEP @RESULT_ID = 103056  -- int
    SET NOCOUNT ON

    DECLARE @LOG_SERIAL INT

    --SELECT  @LOG_SERIAL = ISNULL(MAX(LOG_SERIAL), 0)
    --FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP
    --WHERE   RESULT_ID = @RESULT_ID

    SELECT          @LOG_SERIAL = ISNULL(MAX(M.LOG_SERIAL), 0)
    FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
        INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
            ON M.MASTER_ID = R.MASTER_ID
               AND  M.LOG_SERIAL = R.LOG_SERIAL
    WHERE           R.RESULT_ID = @RESULT_ID
                    AND M.ALLOW_TO_APPROVE = 1

    IF @LOG_SERIAL = 0
    BEGIN

        SELECT      M.RESULT_ID, M.MARKS_ID, M.SUBJECT_SERIAL, M.PAPER_SERIAL, M.MASTER_ID, M.EXTERNAL_ID, M.ROLL_NO,
                    M.COURSE_ID, M.EXAM_TYPE, M.SESSION, M.YEAR_SEM, M.COLLEGE_CODE, M.SUBJECT_CODE, M.SUBJECT_TYPE,
                    M.SUBJECT_TYPE_SERIAL, M.SUBJECT_NAME, M.PAPER_CODE, M.PAPER_NAME, M.CREDIT, M.EARNED_CREDIT, M.POINT,
                    M.GRADE_POINT, M.GRADE, M.THEORY_MAX, M.THEORY_MIN, M.THEORY_OBT, M.THEORY_GRACE,
                    M.THEORY_PRACT_ABSENT, M.PRACTICAL_MAX, M.PRACTICAL_MIN, M.PRACTICAL_OBT, M.PRACTICAL_ABSENT,
                    M.INTERNAL_MAX, M.INTERNAL_MIN, M.INTERNAL_OBT, M.INTERNAL_ABSENT, M.SESSIONAL_MAX, M.SESSIONAL_MIN,
                    M.SESSIONAL_OBT, M.SESSIONAL_ABSENT, M.TOTAL_MAX, M.TOTAL_MIN, M.TOTAL_OBT, M.SUBJECT_GRACE,
                    M.PAPER_STATUS, M.SUBJECT_STATUS, M.RE_EX, M.OLD_MARKS, M.BACK_POST_ID, M.BARCODE, M.OMR_FEE_PAID,
                    M.SCAN_IMAGE_PATH, M.OMR_SERIES, M.ANSWER_KEY_PATH, M.CREATED_AT, M.CREATED_BY, M.LAST_UPDATED_AT,
                    M.LAST_UPDATED_BY, M.IS_ACTIVE, M.MW, M.SOURCE_TYPE, M.CREDIT_POINT, M.CATCH_CODE,
                    CONVERT(BIT, 0) AS IS_QUALIFIYING
        FROM        dbo.STUDENT_MARKS M
        --INNER JOIN  dbo.PAPER_MASTER PM
        --ON M.PAPER_CODE = M.PAPER_CODE
        WHERE       M.RESULT_ID = @RESULT_ID
        ORDER BY    M.SUBJECT_SERIAL, M.PAPER_SERIAL

    END
    ELSE
    BEGIN
        SELECT      M.RESULT_ID, M.MARKS_ID, M.SUBJECT_SERIAL, M.PAPER_SERIAL, M.MASTER_ID, M.EXTERNAL_ID, M.ROLL_NO,
                    M.COURSE_ID, M.EXAM_TYPE, M.SESSION, M.YEAR_SEM, M.COLLEGE_CODE, M.SUBJECT_CODE, M.SUBJECT_TYPE,
                    M.SUBJECT_TYPE_SERIAL, M.SUBJECT_NAME, M.PAPER_CODE, M.PAPER_NAME, M.CREDIT, M.EARNED_CREDIT, M.POINT,
                    M.GRADE_POINT, M.GRADE, M.THEORY_MAX, M.THEORY_MIN, M.THEORY_OBT, M.THEORY_GRACE,
                    M.THEORY_PRACT_ABSENT, M.PRACTICAL_MAX, M.PRACTICAL_MIN, M.PRACTICAL_OBT, M.PRACTICAL_ABSENT,
                    M.INTERNAL_MAX, M.INTERNAL_MIN, M.INTERNAL_OBT, M.INTERNAL_ABSENT, M.SESSIONAL_MAX, M.SESSIONAL_MIN,
                    M.SESSIONAL_OBT, M.SESSIONAL_ABSENT, M.TOTAL_MAX, M.TOTAL_MIN, M.TOTAL_OBT, M.SUBJECT_GRACE,
                    M.PAPER_STATUS, M.SUBJECT_STATUS, M.RE_EX, M.OLD_MARKS, M.BACK_POST_ID, M.BARCODE, M.OMR_FEE_PAID,
                    M.SCAN_IMAGE_PATH, M.OMR_SERIES, M.ANSWER_KEY_PATH, M.CREATED_AT, M.CREATED_BY, M.LAST_UPDATED_AT,
                    M.LAST_UPDATED_BY, M.IS_ACTIVE, M.MW, M.SOURCE_TYPE, M.CREDIT_POINT, M.CATCH_CODE,
                    CONVERT(BIT, 0) AS IS_QUALIFIYING
        FROM        AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MARKS_TEMP M
        --INNER JOIN  dbo.PAPER_MASTER PM
        --    ON M.PAPER_CODE = PM.PAPER_CODE
        WHERE       M.RESULT_ID = @RESULT_ID
                    AND M.LOG_SERIAL = @LOG_SERIAL
        ORDER BY    M.SUBJECT_SERIAL, M.PAPER_SERIAL

    END
END

GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_MARKS_TEMP_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_MARKS_TEMP_LOG]
    @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT
AS
BEGIN

    SET NOCOUNT ON

    SELECT          M.RESULT_ID, M.MARKS_ID, M.SUBJECT_SERIAL, M.PAPER_SERIAL, M.MASTER_ID, M.EXTERNAL_ID, M.ROLL_NO,
                    M.COURSE_ID, M.EXAM_TYPE, M.SESSION, M.YEAR_SEM, M.COLLEGE_CODE, M.SUBJECT_CODE, M.SUBJECT_TYPE,
                    M.SUBJECT_TYPE_SERIAL, PM.SUBJECT_NAME, M.PAPER_CODE, PM.PAPER_NAME, M.CREDIT, M.EARNED_CREDIT, M.POINT,
                    M.GRADE_POINT, M.GRADE, PM.THEORY_MAX, PM.THEORY_MIN, M.THEORY_OBT, M.THEORY_GRACE, M.THEORY_PRACT_ABSENT,
                    PM.PRACTICAL_MAX, PM.PRACTICAL_MIN, M.PRACTICAL_OBT, M.PRACTICAL_ABSENT, PM.INTERNAL_MAX, PM.INTERNAL_MIN,
                    M.INTERNAL_OBT, M.INTERNAL_ABSENT, PM.SESSIONAL_MAX, PM.SESSIONAL_MIN, M.SESSIONAL_OBT, M.SESSIONAL_ABSENT,
                    PM.TOTAL_MAX, PM.TOTAL_MIN, M.TOTAL_OBT, M.SUBJECT_GRACE, M.PAPER_STATUS, M.SUBJECT_STATUS, M.RE_EX,
                    M.OLD_MARKS, M.BACK_POST_ID, M.BARCODE, M.OMR_FEE_PAID, M.SCAN_IMAGE_PATH, M.OMR_SERIES, M.ANSWER_KEY_PATH,
                    M.CREATED_AT, M.CREATED_BY, M.LAST_UPDATED_AT, M.LAST_UPDATED_BY, M.IS_ACTIVE, M.MW, M.SOURCE_TYPE,
                    M.CREDIT_POINT, M.CATCH_CODE, PM.IS_QUALIFIYING
    FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MARKS_TEMP M
        INNER JOIN  dbo.PAPER_MASTER PM
            ON M.PAPER_CODE = PM.PAPER_CODE
               AND  M.SESSION = PM.SESSION
    WHERE           M.RESULT_ID = @RESULT_ID
                    AND M.LOG_SERIAL = @LOG_SERIAL
    ORDER BY        M.SUBJECT_SERIAL, M.PAPER_SERIAL

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_MARKS_TEMP_LOG_NON_NEP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_MARKS_TEMP_LOG_NON_NEP]
    @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT
AS
BEGIN

    SET NOCOUNT ON

    SELECT      M.RESULT_ID, M.MARKS_ID, M.SUBJECT_SERIAL, M.PAPER_SERIAL, M.MASTER_ID, M.EXTERNAL_ID, M.ROLL_NO,
                M.COURSE_ID, M.EXAM_TYPE, M.SESSION, M.YEAR_SEM, M.COLLEGE_CODE, M.SUBJECT_CODE, M.SUBJECT_TYPE,
                M.SUBJECT_TYPE_SERIAL, M.SUBJECT_NAME, M.PAPER_CODE, M.PAPER_NAME, M.CREDIT, M.EARNED_CREDIT, M.POINT,
                M.GRADE_POINT, M.GRADE, M.THEORY_MAX, M.THEORY_MIN, M.THEORY_OBT, M.THEORY_GRACE, M.THEORY_PRACT_ABSENT,
                M.PRACTICAL_MAX, M.PRACTICAL_MIN, M.PRACTICAL_OBT, M.PRACTICAL_ABSENT, M.INTERNAL_MAX, M.INTERNAL_MIN,
                M.INTERNAL_OBT, M.INTERNAL_ABSENT, M.SESSIONAL_MAX, M.SESSIONAL_MIN, M.SESSIONAL_OBT, M.SESSIONAL_ABSENT,
                M.TOTAL_MAX, M.TOTAL_MIN, M.TOTAL_OBT, M.SUBJECT_GRACE, M.PAPER_STATUS, M.SUBJECT_STATUS, M.RE_EX,
                M.OLD_MARKS, M.BACK_POST_ID, M.BARCODE, M.OMR_FEE_PAID, M.SCAN_IMAGE_PATH, M.OMR_SERIES, M.ANSWER_KEY_PATH,
                M.CREATED_AT, M.CREATED_BY, M.LAST_UPDATED_AT, M.LAST_UPDATED_BY, M.IS_ACTIVE, M.MW, M.SOURCE_TYPE,
                M.CREDIT_POINT, M.CATCH_CODE, CONVERT(BIT, 0) AS IS_QUALIFIYING
    FROM        AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MARKS_TEMP M
    WHERE       M.RESULT_ID = @RESULT_ID
                AND M.LOG_SERIAL = @LOG_SERIAL
    ORDER BY    M.SUBJECT_SERIAL, M.PAPER_SERIAL

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_MASTER]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_MASTER] @RESULT_ID INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_MASTER @RESULT_ID = 152221  -- int

    SET NOCOUNT ON

    DECLARE @LOG_SERIAL INT, @MASTER_ID INT

    --SELECT          @LOG_SERIAL = ISNULL(MAX(M.LOG_SERIAL), 0)
    --FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
    --    INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
    --        ON R.MASTER_ID = M.MASTER_ID
    --WHERE           RESULT_ID = @RESULT_ID
    --                AND M.ALLOW_TO_APPROVE = 1


    SELECT  TOP 1
            @MASTER_ID = MASTER_ID
    FROM    STUDENT_RESULT
    WHERE   RESULT_ID = @RESULT_ID

    SELECT          @LOG_SERIAL = ISNULL(MAX(M.LOG_SERIAL), 0)
    FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
        INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
            ON R.MASTER_ID = M.MASTER_ID
    WHERE           M.MASTER_ID = @MASTER_ID
                    AND M.ALLOW_TO_APPROVE = 1

    IF @LOG_SERIAL = 0
    BEGIN



        SELECT          M.MASTER_ID, M.SOURCE_TYPE, M.ENROLLMENT_NO, M.AADHAAR_NO, M.ABC_ACCOUNT_ID, M.STUDENT_NAME,
                        M.FATHER_NAME, M.MOTHER_NAME, M.GENDER, M.CATEGORY, M.SUB_CATEGORY, M.DOB, M.NATIONALITY_CODE,
                        M.COUNTRY_CODE, M.MOBILE, M.FOREIGN_MOBILE_NO, M.EMAIL, M.ALTERNATE_MOBILE, M.GUARDIAN_MOBILE,
                        M.PHOTO_PATH, M.SIGNATURE_PATH, M.MOBILE_VERIFIED, M.EMAIL_VERIFIED, M.LOGIN_PASSWORD, M.REMARKS,
                        M.CREATED_AT, M.CREATED_BY, M.LAST_UPDATED_AT, M.LAST_UPDATED_BY, M.IS_ACTIVE, NULL AS RU_NUMBER,
                        M.LAST_APPROVED_BY, M.LAST_APPROVED_AT, ISNULL(M.DOB, CONVERT(DATE, '01-JAN-2000')) AS DOB,
                        CONVERT(BIT, 0) AS IS_EDITED, M.APPLICATION_DOCUMENT
        FROM            dbo.STUDENT_MASTER M
            INNER JOIN  dbo.STUDENT_RESULT R
                ON M.MASTER_ID = R.MASTER_ID
        WHERE           R.RESULT_ID = @RESULT_ID

    END
    ELSE
    BEGIN

        SELECT  TOP 1
                M.MASTER_ID, M.LOG_SERIAL, M.LOG_DATE_TIME, M.SOURCE_TYPE, M.ENROLLMENT_NO, M.AADHAAR_NO, M.ABC_ACCOUNT_ID,
                M.STUDENT_NAME, M.FATHER_NAME, M.MOTHER_NAME, M.GENDER, M.CATEGORY, M.SUB_CATEGORY, M.DOB,
                M.NATIONALITY_CODE, M.COUNTRY_CODE, M.MOBILE, M.FOREIGN_MOBILE_NO, M.EMAIL, M.ALTERNATE_MOBILE,
                M.GUARDIAN_MOBILE, M.PHOTO_PATH, M.SIGNATURE_PATH, M.MOBILE_VERIFIED, M.EMAIL_VERIFIED, M.LOGIN_PASSWORD,
                M.REMARKS, M.CREATED_AT, M.CREATED_BY, M.LAST_UPDATED_AT, M.LAST_UPDATED_BY, M.IS_ACTIVE, M.RU_NUMBER,
                M.LAST_APPROVED_BY, M.LAST_APPROVED_AT, ISNULL(M.DOB, CONVERT(DATE, '01-JAN-2000')),
                CONVERT(BIT, 1) AS IS_EDITED, M.APPLICATION_DOCUMENT
        FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
        --INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
        --ON M.MASTER_ID = R.MASTER_ID
        WHERE   M.MASTER_ID = @MASTER_ID
                AND M.LOG_SERIAL = @LOG_SERIAL
    --ORDER BY M.LOG_DATE_TIME DESC

    END

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_MASTER_DETAIL]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_MASTER_DETAIL] @RESULT_ID INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_MASTER_DETAIL @RESULT_ID = 103056  -- int

    SET NOCOUNT ON

    SELECT          M.*, CM.COURSE_NAME, COL.COLLEGE_NAME
    FROM            dbo.STUDENT_MASTER_DETAIL M
        INNER JOIN  dbo.STUDENT_RESULT R
            ON M.MASTER_ID = R.MASTER_ID
        INNER JOIN  AGRA_MASTER.dbo.COURSE_MASTER CM
            ON M.COURSE_ID_MAIN = CM.COURSE_ID_MAIN
               AND  CM.COURSE_ID = R.COURSE_ID
        INNER JOIN  AGRA_MASTER.dbo.COLLEGE_MST COL
            ON M.COLLEGE_CODE = COL.COLLEGE_CODE
    WHERE           R.RESULT_ID = @RESULT_ID

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_MASTER_TEMP_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_MASTER_TEMP_LOG]
    @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_MASTER @RESULT_ID = 103056  -- int

    SET NOCOUNT ON

    SELECT          M.MASTER_ID, M.LOG_SERIAL, M.LOG_DATE_TIME, M.SOURCE_TYPE, M.ENROLLMENT_NO, M.AADHAAR_NO, M.ABC_ACCOUNT_ID,
                    M.STUDENT_NAME, M.FATHER_NAME, M.MOTHER_NAME, M.GENDER, M.CATEGORY, M.SUB_CATEGORY, M.DOB,
                    M.NATIONALITY_CODE, M.COUNTRY_CODE, M.MOBILE, M.FOREIGN_MOBILE_NO, M.EMAIL, M.ALTERNATE_MOBILE,
                    M.GUARDIAN_MOBILE, M.PHOTO_PATH, M.SIGNATURE_PATH, M.MOBILE_VERIFIED, M.EMAIL_VERIFIED, M.LOGIN_PASSWORD,
                    M.REMARKS, M.CREATED_AT, M.CREATED_BY, M.LAST_UPDATED_AT, M.LAST_UPDATED_BY, M.IS_ACTIVE, M.RU_NUMBER,
                    M.LAST_APPROVED_BY, M.LAST_APPROVED_AT, M.ALLOW_TO_APPROVE, M.LAST_EDIT_REMARKS, M.APPLICATION_DOCUMENT
    FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
        INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
            ON M.MASTER_ID = R.MASTER_ID
               AND  M.LOG_SERIAL = R.LOG_SERIAL
    WHERE           R.RESULT_ID = @RESULT_ID
                    AND M.LOG_SERIAL = @LOG_SERIAL

END

GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_RESULT]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_RESULT] @RESULT_ID INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_RESULT @RESULT_ID = 103056  -- int

    SET NOCOUNT ON

    DECLARE @LOG_SERIAL INT

    SELECT  @LOG_SERIAL = ISNULL(MAX(LOG_SERIAL), 0)
    FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP
    WHERE   RESULT_ID = @RESULT_ID

    IF @LOG_SERIAL = 0
    BEGIN

        SELECT  *
        FROM    dbo.STUDENT_RESULT
        WHERE   RESULT_ID = @RESULT_ID
    END
    ELSE
    BEGIN
        SELECT  *
        FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP
        WHERE   RESULT_ID = @RESULT_ID
                AND LOG_SERIAL = @LOG_SERIAL
    END

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_RESULT_TEMP_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_RESULT_TEMP_LOG]
    @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT
AS
BEGIN

    SET NOCOUNT ON


    SELECT  *
    FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP
    WHERE   RESULT_ID = @RESULT_ID
            AND LOG_SERIAL = @LOG_SERIAL

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NEP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NEP] @RESULT_ID INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_SEM_WISE_RECORD_NEP @RESULT_ID = 197748  -- int

    SET NOCOUNT ON

    DECLARE @LOG_SERIAL INT

    SELECT  @LOG_SERIAL = ISNULL(MAX(LOG_SERIAL), 0)
    FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP
    WHERE   RESULT_ID = @RESULT_ID

    IF @LOG_SERIAL = 0
    BEGIN
        SELECT  *
        FROM    dbo.STUDENT_SEMESTER_WISE_RECORD_NEP
        WHERE   RESULT_ID = @RESULT_ID
    END
    ELSE
    BEGIN
        SELECT  *
        FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_SEMESTER_WISE_RECORD_NEP_TEMP
        WHERE   RESULT_ID = @RESULT_ID
                AND LOG_SERIAL = @LOG_SERIAL
    END

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NEP_TEMP_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NEP_TEMP_LOG]
    @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT
AS
BEGIN

    SET NOCOUNT ON

    SELECT  *
    FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_SEMESTER_WISE_RECORD_NEP_TEMP
    WHERE   RESULT_ID = @RESULT_ID
            AND LOG_SERIAL = @LOG_SERIAL

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NON_NEP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NON_NEP] @RESULT_ID INT
AS
BEGIN

    --EXEC dbo.APP_GET_STUDENT_SEM_WISE_RECORD_NEP @RESULT_ID = 197748  -- int

    SET NOCOUNT ON

    SELECT  *
    FROM    dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP
    WHERE   RESULT_ID = @RESULT_ID

END
GO
/****** Object:  StoredProcedure [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NON_NEP_TEMP_LOG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_GET_STUDENT_SEM_WISE_RECORD_NON_NEP_TEMP_LOG]
    @MASTER_ID INT, @RESULT_ID INT, @LOG_SERIAL INT
AS
BEGIN

    SET NOCOUNT ON

    SELECT  *
    FROM    AGRA_RESULT_DEMO_LOG.dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP_TEMP
    WHERE   RESULT_ID = @RESULT_ID
            AND LOG_SERIAL = @LOG_SERIAL

END
GO
/****** Object:  StoredProcedure [dbo].[APP_SEARCH_STUDENT]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_SEARCH_STUDENT] @ROLL_NO_OR_ENROLLMENT_NO VARCHAR(25)
AS
BEGIN

    --EXEC dbo.APP_SEARCH_STUDENT @ROLL_NO_OR_ENROLLMENT_NO = '2200080011001'  -- varchar(25)

    SET NOCOUNT ON

    SELECT          M.MASTER_ID, R.RESULT_ID, M.ENROLLMENT_NO, D.ROLL_NO, M.STUDENT_NAME, M.FATHER_NAME, M.MOTHER_NAME,
                    CM.COURSE_ID_MAIN, CMM.COURSE_NAME_MAIN, CM.COURSE_ID, CM.COURSE_NAME, R.YEAR_SEM, R.SESSION, R.EXAM_TYPE,
                    R.SOURCE_TYPE, D.COLLEGE_CODE, COL.COLLEGE_NAME, R.SEMESTER_RESULT, R.FINAL_RESULT, R.FINAL_DIVISION,
                    R.THEORY_DIVISION, R.PRACTICAL_DIVISION, M.APPLICATION_DOCUMENT, CM.RESULT_PATTERN
    FROM            dbo.STUDENT_MASTER M
        INNER JOIN  dbo.STUDENT_MASTER_DETAIL D
            ON M.MASTER_ID = D.MASTER_ID
        INNER JOIN  AGRA_MASTER.dbo.COURSE_MASTER CM
            ON D.COURSE_ID_MAIN = CM.COURSE_ID_MAIN
        INNER JOIN  AGRA_MASTER.dbo.COURSE_MASTER_MAIN CMM
            ON CM.COURSE_ID_MAIN = CMM.COURSE_ID_MAIN
        INNER JOIN  AGRA_MASTER.dbo.COLLEGE_MST COL
            ON COL.COLLEGE_CODE = D.COLLEGE_CODE
        INNER JOIN  dbo.STUDENT_RESULT R
            ON D.MASTER_ID = R.MASTER_ID
               AND  R.COURSE_ID = CM.COURSE_ID
        INNER JOIN  AGRA_MASTER.dbo.EXAM_TYPE_MASTER ETM
            ON R.EXAM_TYPE = ETM.EXAM_TYPE
    --WHERE           'RMPU22174968' IN ( M.ENROLLMENT_NO, R.ROLL_NO )
    WHERE           @ROLL_NO_OR_ENROLLMENT_NO IN ( M.ENROLLMENT_NO, R.ROLL_NO )
                    AND R.IS_HISTORY = 0-- AND R.ALLOW_EDITING = 1
    --AND R.SOURCE_TYPE IN ( 'UGNEP_RESULT_DATA', 'PG_NEP_RESULT_DATA' )
    ORDER BY        CM.COURSE_ID_MAIN, CM.SEM_NO, ETM.EXAM_TYPE_SERIAL, R.SESSION
END
GO
/****** Object:  StoredProcedure [dbo].[APP_SEARCH_STUDENT_EDITED_LIST]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[APP_SEARCH_STUDENT_EDITED_LIST]
    @ROLL_NO_OR_ENROLLMENT_NO VARCHAR(25), @RU_NO VARCHAR(25), @STATUS VARCHAR(25)
AS
BEGIN
    SET NOCOUNT ON

    DECLARE @QUERY VARCHAR(4000)

    SELECT  @QUERY
        = ' SELECT  M.MASTER_ID, R.RESULT_ID, M.LOG_SERIAL, M.ENROLLMENT_NO, D.ROLL_NO, M.STUDENT_NAME, M.FATHER_NAME,
                    M.MOTHER_NAME, CM.COURSE_ID_MAIN, CMM.COURSE_NAME_MAIN, CM.COURSE_ID, CM.COURSE_NAME, R.YEAR_SEM,
                    R.SESSION, R.EXAM_TYPE, R.SOURCE_TYPE, D.COLLEGE_CODE, COL.COLLEGE_NAME, R.SEMESTER_RESULT, R.FINAL_RESULT,
                    R.FINAL_DIVISION, R.THEORY_DIVISION, R.PRACTICAL_DIVISION, M.REMARKS, M.ALLOW_TO_APPROVE,
                    M.LAST_EDIT_REMARKS, M.LAST_UPDATED_BY, U.Name AS LAST_UPDATED_BY_NAME, M.LAST_UPDATED_AT, M.RU_NUMBER,
                    M.ALLOW_TO_APPROVE, CASE WHEN M.ALLOW_TO_APPROVE = 1 THEN ''Pending''
                                            WHEN ISNULL(M.LAST_APPROVED_BY, -1) <> -1 THEN ''Approved'' ELSE ''N/A'' END AS STATUS,
                    M.LAST_APPROVED_BY, AU.Name AS LAST_APPROVED_BY_NAME, M.LAST_APPROVED_AT, CM.RESULT_PATTERN
    FROM            AGRA_RESULT_DEMO_LOG.dbo.STUDENT_MASTER_TEMP M
        INNER JOIN  dbo.STUDENT_MASTER_DETAIL D
            ON M.MASTER_ID = D.MASTER_ID
        INNER JOIN  AGRA_MASTER.dbo.COURSE_MASTER CM
            ON D.COURSE_ID_MAIN = CM.COURSE_ID_MAIN
        INNER JOIN  AGRA_MASTER.dbo.COURSE_MASTER_MAIN CMM
            ON CM.COURSE_ID_MAIN = CMM.COURSE_ID_MAIN
        INNER JOIN  AGRA_MASTER..dbo.COLLEGE_MST COL
            ON COL.COLLEGE_CODE = D.COLLEGE_CODE
        INNER JOIN  AGRA_RESULT_DEMO_LOG.dbo.STUDENT_RESULT_TEMP R
            ON D.MASTER_ID = R.MASTER_ID
               AND  R.COURSE_ID = CM.COURSE_ID
               AND  R.LOG_SERIAL = M.LOG_SERIAL
        INNER JOIN  AGRA_MASTER.dbo.EXAM_TYPE_MASTER ETM
            ON R.EXAM_TYPE = ETM.EXAM_TYPE
        LEFT JOIN   AGRA_APP_ADMIN.dbo.TblUser U
            ON M.LAST_UPDATED_BY = U.Id
        LEFT JOIN   AGRA_APP_ADMIN.dbo.TblUser AU
            ON M.LAST_APPROVED_BY = AU.Id
    WHERE      1=1'

    IF LEN(@ROLL_NO_OR_ENROLLMENT_NO) > 0
    BEGIN
        SELECT  @QUERY = CONCAT(@QUERY, ' AND ''', @ROLL_NO_OR_ENROLLMENT_NO, ''' IN (M.ENROLLMENT_NO, R.ROLL_NO)')
    END

    IF LEN(@RU_NO) > 0
    BEGIN
        SELECT  @QUERY = CONCAT(@QUERY, ' AND M.RU_NUMBER =''', @RU_NO, '''')
    END

	IF @STATUS = 'Pending'
	BEGIN
        SELECT  @QUERY = CONCAT(@QUERY, ' AND M.ALLOW_TO_APPROVE = 1')
	END

	IF @STATUS = 'Approved'
	BEGIN
        SELECT  @QUERY = CONCAT(@QUERY, ' AND ISNULL(M.LAST_APPROVED_BY, -1) <> -1')
	END

    SELECT  @QUERY = CONCAT(@QUERY, ' ORDER BY M.ALLOW_TO_APPROVE DESC, M.LAST_UPDATED_AT')

	EXEC (@QUERY)
END
GO
/****** Object:  StoredProcedure [dbo].[ApplyOrdinance_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE  PROC  [dbo].[ApplyOrdinance_AM]  
(  
 @CollegeCode VARCHAR(8000) ='0001,0002,0005,0030,0089,0100,0101,0102,0103,0115,0116,0129,0134,0147,0164,0172,0178,0180,0190,0207,0220,0222,0227,0228,0232,0241,0242,0248,0252,0258,0274,0278,0288,0294,0297,0298,0312,0330,0333,0335,0340,0343,0350,0369,0373,0375,0376,0378,0398,0399,0400,0410,0414,0418,0420,0440,0444,0447,0452,0455,0456,0459,0462,0471,0472,0477,0478,0479,0489,0494,0498,0500,0507,0511,0512,0520,0521,0525,0526,0535,0543,0544,0573,0582,0583,0587,0588,0613,0622,0633,0635,0636,0637,0638,0639,0640,0642,0648,0650,0663,0684,0688,0696,0697,0703,0718,0721,0747,0770,0779,0799,0803,0806,0820,0821,0824,0840,0841,0871,0875,0879,0924,0925,0926,0942,0944,0954,0957,0970,0975,1041,1054,1131'  
,@COURSE_ID INT =142  
,@EXAM_TYPE_ID  VARCHAR(15)='RE-STUDENT'  
,@SESSION_ID VARCHAR(20)='2024-25'  
,@RESULT_TYPE_ID INT=1   
,@ROLL_NO VARCHAR(50) =''  
,@IS_RW BIT=0  
,@flag varchar(100)=NULL  
)  
AS  
   
  DECLARE @PROCNAME varchar(2000)=NULL   
  DECLARE @SQL_QUERY VARCHAR(MAX)   
  
  
  UPDATE STUDENT_RESULT SET IS_PUBLISHED=0,PUBLISH_DATE=GETDATE()  
  WHERE COURSE_ID=@COURSE_ID  
  AND SESSION=@SESSION_ID  
  AND EXAM_TYPE=@EXAM_TYPE_ID  
  AND IS_HISTORY=0  
  AND ( (LEN(@CollegeCode)=0 AND 1=1) OR(LEN(@CollegeCode)>0  AND  COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CollegeCode,',')))  )  
  AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  ROLL_NO=@ROLL_NO ))  
  
  
   SET @SQL_QUERY=  
  '   DECLARE @TBLRESULTDATA AS RESULT_USERS_TBLTYPE;     INSERT INTO @TBLRESULTDATA (MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE)  
   SELECT MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,YEAR_SEM,ORDINANCE_ID,RESULT_TYPE FROM STUDENT_RESULT   
   WHERE COURSE_ID='+''+CAST( @COURSE_ID AS VARCHAR(20))+'' +  
   '  AND SESSION='''+@SESSION_ID+''''+  
   '  AND EXAM_TYPE='''+@EXAM_TYPE_ID+''''  
  +' AND ( (LEN('''+@CollegeCode+''')=0 AND 1=1) OR(LEN('''+@CollegeCode+''')>0  AND  COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT('''+ @CollegeCode+''','','')))  ) '  
  +' AND ( (LEN('''+@ROLL_NO+''')=0 AND 1=1) OR  (LEN('''+@ROLL_NO+''')>1  AND  ROLL_NO='''+@ROLL_NO +'''))'     
  +' AND IS_PUBLISHED=0    AND IS_HISTORY=0'  
  
 

   --select @PROCNAME   
    select @PROCNAME= PROC_NAME from AGRA_MASTER.DBO.RESULTTYPE_WISE_ORDINANCE WHERE COURSE_ID=@COURSE_ID AND RESULT_TYPE_ID=@RESULT_TYPE_ID  
  
    --PRINT @SQL_QUERY

 IF(@PROCNAME IS NOT NULL)  
   BEGIN  
  SET @SQL_QUERY =@SQL_QUERY+  N' EXEC '+@PROCNAME + ' @TBLRESULTDATA,'+CONVERT(VARCHAR(10), @COURSE_ID)+','+''+ CAST( @RESULT_TYPE_ID AS varchar(10))  
   -- +'SELECT ''RECORDS ''+CAST((SELECT COUNT(1) FROM  @TBLRESULTDATA ) AS VARCHAR(20)) + '' HAS BEEN  SAVED SUCCESSFULLY !!''  AS RESPONSEMESSAGE, 1 AS RESPONSECODE, 1 AS RESPONSEMESSAGECODE'       
   execute (@SQL_QUERY)  
  
 --SELECT 'DATA HAS BEEN  SAVED SUCCESSFULLY !!!!' AS RESPONSEMESSAGE, 1 AS RESPONSECODE, '1' AS RESPONSEMESSAGECODE;  
  
 END    
 ELSE  
  BEGIN   
  SELECT 'DATA NOT SAVED SUCCESSFULLY( ERROR ).!!' AS RESPONSEMESSAGE, -1 AS RESPONSECODE, '-100' AS RESPONSEMESSAGECODE;  
  END   
   
  
    
  
  
   
GO
/****** Object:  StoredProcedure [dbo].[AuthenticateAdmin_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create PROCEDURE [dbo].[AuthenticateAdmin_AM] (
@Flag			VARCHAR(100),
@userName		VARCHAR(100),
@Password		VARCHAR(50)
)

/* 

   EXEC [dbo].[AuthenticateAdmin_AM] '','',''

*/

AS
BEGIN
		
SELECT *
FROM AdminMasters where (Email= @userName or Name= @userName) and Password=@Password
END
GO
/****** Object:  StoredProcedure [dbo].[EXECUTE_INDIVIDUAL_BULK_ORDINANCE]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EXECUTE_INDIVIDUAL_BULK_ORDINANCE]
    @RESULT_ID INT, @IS_CORRECTION_FROM_APP BIT
AS
BEGIN

SET NOCOUNT ON
    --DECLARE @LIST RESULT_ID_LIST

    --INSERT INTO @LIST
    --(
    --    RESULT_ID, MASTER_ID, SESSION, YEAR_SEM, EXAM_TYPE, RESULT_PATTERN
    --)
    --SELECT          RESULT_ID, MASTER_ID, SESSION, YEAR_SEM, EXAM_TYPE, CM.RESULT_PATTERN
    --FROM            dbo.STUDENT_RESULT R
    --    INNER JOIN  dbo.COURSE_MASTER CM
    --        ON R.COURSE_ID = CM.COURSE_ID
    --WHERE           R.RESULT_ID = @RESULT_ID
    --                AND R.IS_HISTORY = 0

    --DECLARE @RESULT_PATTERN VARCHAR(25),@V_MASTER_ID INT,@V_IS_GRACE BIT

    --SELECT  TOP 1
    --        @RESULT_PATTERN = RESULT_PATTERN,@V_MASTER_ID=MASTER_ID
    --FROM    @LIST


    --IF @RESULT_PATTERN IN ( 'NEP-PG', 'NEP-UG' )
    --BEGIN
    --    IF @V_IS_GRACE=0
    --    BEGIN
    --         EXEC dbo.BULK_ORDINANCE_NEP_UG_PG @RESULT_ID_LIST = @LIST, @IS_CORRECTION_FROM_APP = @IS_CORRECTION_FROM_APP
    --    END
    --    ELSE
    --    BEGIN
    --         EXEC dbo.BULK_ORDINANCE_NEP_UG_PG_GRACE_PANKAJ  @RESULT_ID_LIST = @LIST, @IS_CORRECTION_FROM_APP = @IS_CORRECTION_FROM_APP
    --    END
    --END

END
GO
/****** Object:  StoredProcedure [dbo].[GET_EDITPAPERMASTER_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[GET_EDITPAPERMASTER_AM]  
	 @Flag VARCHAR(100),
	 @UserId INT  ,
	 @PAPER_CODE_PK VARCHAR(25)
AS  
 
  
--------//  GET_EDITPAPERMASTER_AM '',0,'Z060602T'
   
BEGIN  
      SELECT  [PAPER_CODE_PK], [SUBJECT_NAME], [PAPER_NAME], [PAPER_TYPE], [PAPER_TYPE_CAT], [CREDIT], [IS_QUALIFIYING], [THEORY_MAX], [THEORY_MIN], [INTERNAL_MAX], [INTERNAL_MIN], [SESSIONAL_MAX], [SESSIONAL_MIN], [TOTAL_MAX], [TOTAL_MIN], [SUBJECT_PAPER_CODE], [ISRW], [SESSIONID], [PAPER_SERIAL_NO] FROM dbo.PAPER_MASTER(NOLOCK) WHERE PAPER_CODE_PK=@PAPER_CODE_PK;

	   SELECT  DISTINCT PAPER_TYPE_NAME ,PTYPE FROM AGRA_MASTER.dbo.PAPER_TYPE_MASTER(NOLOCK) ORDER BY PTYPE;

END  
GO
/****** Object:  StoredProcedure [dbo].[GET_MANAGEPAPERMASTER_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[GET_MANAGEPAPERMASTER_AM]  
	 @Flag VARCHAR(100),
	 @UserId INT  
AS  
 
  
--------//  [GET_MANAGEPAPERMASTER_AM] '',0  
   
BEGIN  
      SELECT  DISTINCT PAPER_TYPE_NAME ,PTYPE FROM AGRA_MASTER.dbo.PAPER_TYPE_MASTER(NOLOCK) ORDER BY PTYPE;
     

END  
GO
/****** Object:  StoredProcedure [dbo].[GET_PAPER_MASTER_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[GET_PAPER_MASTER_AM]  
	 @Flag VARCHAR(100),
	 @UserId INT,
     @PageNumber INT       
    ,@Search VARCHAR(500) NULL  
AS  
 
  
--------//  GET_PAPER_MASTER_AM '',0,1,''  
   
BEGIN  
      SET NOCOUNT ON;     
      DECLARE @PageSize INT  =10;
      DECLARE @RecordCount INT =0;
      DECLARE @Totalpage int  =0


      SELECT @RecordCount = COUNT(*)
      FROM dbo.PAPER_MASTER WITH(NOLOCK) 
       WHERE ( (ISNULL(@Search,'')='' AND 1=1)  OR (ISNULL(@Search,'')<>'' AND LEN(@Search)>=1 AND (SUBJECT_NAME LIKE '%'+@Search+'%'  OR  PAPER_NAME LIKE '%'+@Search+'%')   ))

       set @Totalpage=@RecordCount/@PageSize+(IIF( @RecordCount%@PageSize>0,1,0 ))
       --SELECT @Totalpage

        SET @PageNumber =IIF(ISNULL(@Search,'')<>'' AND @Totalpage>=@PageNumber,@PageNumber,IIF(ISNULL(@Search,'')='' AND @Totalpage>=@PageNumber,@PageNumber,1))
         
         SELECT @RecordCount RecordCount,@PageSize PageSize,@PageNumber PageCurrent  
	
 ;  WITH TEMP AS 
      (
      
    SELECT  ROW_NUMBER()OVER(ORDER BY PAPER_CODE_PK DESC ) SrNo,* FROM 
    
    ( 
      SELECT  TOP (@PageNumber*@PageSize)   [PAPER_CODE_PK], [SUBJECT_NAME], [PAPER_NAME], [PAPER_TYPE], [PAPER_TYPE_CAT], [CREDIT], [IS_QUALIFIYING], [THEORY_MAX], [THEORY_MIN], [INTERNAL_MAX], [INTERNAL_MIN], [SESSIONAL_MAX], [SESSIONAL_MIN], [TOTAL_MAX], [TOTAL_MIN], [SUBJECT_PAPER_CODE], [ISRW], [SESSIONID], [PAPER_SERIAL_NO] 
      FROM dbo.PAPER_MASTER(NOLOCK)
      WHERE ( (ISNULL(@Search,'')='' AND 1=1)  OR (ISNULL(@Search,'')<>'' AND LEN(@Search)>=1 AND (SUBJECT_NAME LIKE '%'+@Search+'%'  OR  PAPER_NAME LIKE '%'+@Search+'%')   ))

      
      ) AS A
     
  )
		 SELECT * FROM TEMP WHERE
		 
		 SrNo between (@PageNumber - 1) * @PageSize + 1 and @PageNumber*@PageSize

END  
GO
/****** Object:  StoredProcedure [dbo].[Get_Sync_Mark_Result_Demo_Erp_DTO_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[Get_Sync_Mark_Result_Demo_Erp_DTO_AM]  
	 @Flag VARCHAR(100),
	 @UserId INT  ,
	 @Search VARCHAR(50),
	 @COURSE_ID INT=0,
	 @SESSIONNAME VARCHAR(50)
AS  
 
  
--------//  [Get_Sync_Mark_Result_Demo_Erp_DTO_AM] '',0,'',141,'2022-23'
   
BEGIN  
	  SELECT  COURSE_ID,COURSE_ID_MAIN,COURSE_NAME,COURSE_NAME_PROPER FROM AGRA_MASTER.dbo.COURSE_MASTER(NOLOCK) ORDER BY COURSE_NAME;
	  SELECT  SESSION_ID,SESSIONS,START_YEAR,ENDYEAR_YEAR,ISACTIVE FROM AGRA_MASTER.dbo.SESSION_MASTER(NOLOCK) ORDER BY ISACTIVE DESC;
    
      SELECT  EX_TYPE_ID,EXAM_TYPE FROM AGRA_MASTER.dbo.EXAM_TYPE_MASTER(NOLOCK);


	  SELECT  [EXAM_IN_SESS_ID] ,[SESSION_ID_FK]  ,[COURSE_ID_FK]  ,[HELD_IN] ,[EXAM_FREQUENCY] FROM [AGRA_RESULT_DEMO].[dbo].[EXAM_IN_SESSION] (NOLOCK) e
	  JOIN AGRA_MASTER.dbo.SESSION_MASTER s ON e.SESSION_ID_FK=s.SESSION_ID
	  WHERE 
	  s.SESSIONS=@SESSIONNAME AND 
	  e.COURSE_ID_FK=@COURSE_ID  

END  
GO
/****** Object:  StoredProcedure [dbo].[INSERT_UPDATE_PaperMaster_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  PROCEDURE [dbo].[INSERT_UPDATE_PaperMaster_AM] (
@Flag				 VARCHAR(100),
@PAPER_CODE_PK		 VARCHAR(25), 
@SUBJECT_NAME		 NVARCHAR(200), 
@PAPER_NAME			 NVARCHAR(500), 
@PAPER_TYPE			 VARCHAR(5),
@PAPER_TYPE_CAT 	 VARCHAR(5),
@CREDIT				 int,
@IS_QUALIFIYING		 int,
@THEORY_MAX			 int,
@THEORY_MIN			 int, 
@INTERNAL_MAX		 int,
@INTERNAL_MIN		 int,
@SESSIONAL_MAX       int,
@SESSIONAL_MIN		 int,
@TOTAL_MAX			 int,
@TOTAL_MIN		     int,
@SUBJECT_PAPER_CODE  VARCHAR(50),
@ISRW				 int, 
@SESSIONID			 int,
@PAPER_SERIAL_NO     int,
@EditFlag	         bit=0
)



AS
 BEGIN
    

 IF(@EditFlag=0) 			
  BEGIN 
  IF NOT EXISTS(SELECT 1 FROM PAPER_MASTER WHERE PAPER_CODE_PK=@PAPER_CODE_PK)
     BEGIN
   
     INSERT INTO [dbo].[PAPER_MASTER]
           ([PAPER_CODE_PK]
           ,[SUBJECT_NAME]
           ,[PAPER_NAME]
           ,[PAPER_TYPE]
           ,[PAPER_TYPE_CAT]
           ,[CREDIT]
           ,[IS_QUALIFIYING]
           ,[THEORY_MAX]
           ,[THEORY_MIN]
           ,[INTERNAL_MAX]
           ,[INTERNAL_MIN]
           ,[SESSIONAL_MAX]
           ,[SESSIONAL_MIN]
           ,[TOTAL_MAX]
           ,[TOTAL_MIN]
           ,[SUBJECT_PAPER_CODE]
           ,[ISRW]
           ,[SESSIONID]
           ,[PAPER_SERIAL_NO])
     VALUES
           (@PAPER_CODE_PK 
           ,@SUBJECT_NAME 
           ,@PAPER_NAME 
           ,@PAPER_TYPE 
           ,@PAPER_TYPE_CAT 
           ,@CREDIT 
           ,@IS_QUALIFIYING 
           ,@THEORY_MAX 
           ,@THEORY_MIN 
           ,@INTERNAL_MAX 
           ,@INTERNAL_MIN 
           ,@SESSIONAL_MAX 
           ,@SESSIONAL_MIN 
           ,@TOTAL_MAX 
           ,@TOTAL_MIN 
           ,@SUBJECT_PAPER_CODE 
           ,@ISRW 
           ,@SESSIONID 
           ,@PAPER_SERIAL_NO )
 
        SELECT 'DATA SAVED SUCCESSFULLY.!!' AS RESPONSEMESSAGE, 1 AS RESPONSECODE, 0 AS RESPONSEMESSAGECODE;
	 END 
   ELSE
     BEGIN 
	  SELECT 'DATA NOT SAVED SUCCESSFULLY (PAPER_CODE ALREADY EXISTS).!!' AS RESPONSEMESSAGE, -1 AS RESPONSECODE, '-100' AS RESPONSEMESSAGECODE;
   END 
  END

ELSE
 BEGIN 
  
UPDATE [dbo].[PAPER_MASTER]
   SET [SUBJECT_NAME] = @SUBJECT_NAME 
      ,[PAPER_NAME] = @PAPER_NAME 
      ,[PAPER_TYPE] = @PAPER_TYPE 
      ,[PAPER_TYPE_CAT] = @PAPER_TYPE_CAT 
      ,[CREDIT] = @CREDIT 
      ,[IS_QUALIFIYING] = @IS_QUALIFIYING 
      ,[THEORY_MAX] = @THEORY_MAX
      ,[THEORY_MIN] = @THEORY_MIN
      ,[INTERNAL_MAX] = @INTERNAL_MAX
      ,[INTERNAL_MIN] = @INTERNAL_MIN
      ,[SESSIONAL_MAX] = @SESSIONAL_MAX
      ,[SESSIONAL_MIN] = @SESSIONAL_MIN
      ,[TOTAL_MAX] = @TOTAL_MAX
      ,[TOTAL_MIN] = @TOTAL_MIN
      ,[SUBJECT_PAPER_CODE] = @SUBJECT_PAPER_CODE 
      ,[ISRW] = @ISRW 
      ,[SESSIONID] = @SESSIONID 
      ,[PAPER_SERIAL_NO] = @PAPER_SERIAL_NO 
      WHERE  [PAPER_CODE_PK] = @PAPER_CODE_PK 
      SELECT 'DATA UPDATED SUCCESSFULLY.!!' AS RESPONSEMESSAGE, 1 AS RESPONSECODE, 0 AS RESPONSEMESSAGECODE;
	  
    
 END 




 END 
GO
/****** Object:  StoredProcedure [dbo].[MANUAL_POST_SEMESTER_WISE_NON_NEP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[MANUAL_POST_SEMESTER_WISE_NON_NEP]
AS
BEGIN

    INSERT INTO dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP
    (
        RESULT_ID, YEAR_SEM, MASTER_ID, EXAM_TYPE, TOTAL_MAX, TOTAL_MIN, TOTAL_OBT, STATUS, SOURCE_TYPE, IS_CALCULATED,
        EARN_CREDIT, GPA, TOTAL_CGPA, CREDIT_POINT, TOTAL_CREDIT, THEORY_MAX, THEORY_OBT, PRACTICAL_MAX, PRACTICAL_OBT
    )
    SELECT          R.RESULT_ID_NEW, S.YEAR_SEM, S.MASTER_ID, S.EXAM_TYPE, S.TOTAL_MAX_MARKS, S.TOTAL_MIN_MARKS, S.TOTAL_OBT_MARKS,
                    CASE WHEN S.SEMESTER_RESULT LIKE '%PASS%' THEN 'PASS' ELSE 'FAIL' END, S.SOURCE_TYPE, 1, S.EARNED_CREDIT, S.SGPA, S.CGPA, S.TOTAL_GRADE_POINT, S.TOTAL_CREDIT,
                    S.THEORY_MAX_MARKS, S.THEORY_OBT_MARKS, S.PRACTICAL_MAX_MARKS, S.PRACTICAL_OBT_MARKS
    FROM            dbo.STUDENT_RESULT R
        INNER JOIN  AGRA_MASTER.dbo.COURSE_MASTER CM
            ON R.COURSE_ID = CM.COURSE_ID
        INNER JOIN  dbo.STUDENT_RESULT S
            ON R.MASTER_ID = S.MASTER_ID
               AND  S.IS_HISTORY = 0
               AND  R.IS_HISTORY = 0
               AND  S.YEAR_SEM <= R.YEAR_SEM
    WHERE           ISNULL(CM.RESULT_PATTERN,'') NOT IN ('nep-pg','nep-ug')
                    AND NOT EXISTS
    (
        SELECT  *
        FROM    dbo.STUDENT_SEMESTER_WISE_RECORD_NON_NEP N
        WHERE   N.RESULT_ID = R.RESULT_ID_NEW
                AND N.YEAR_SEM = S.YEAR_SEM
    )
ORDER BY R.MASTER_ID,R.RESULT_ID_NEW
END
GO
/****** Object:  StoredProcedure [dbo].[ORDINANCE_BED_MARK_SYS]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 CREATE PROC [dbo].[ORDINANCE_BED_MARK_SYS] 
 (
  @PREPARERESULTDATA   RESULT_USERS_TBLTYPE  READONLY 
 ,@COURSE_ID INT =141
 ,@RESULT_TYPE_ID INT 

)
 
AS
 
--DECLARE @FINAL_RESULT VARCHAR(20)

DECLARE @TBLRESULTDATA AS  RESULT_USERS_TBLTYPE  
 
  INSERT INTO @TBLRESULTDATA (MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE)
  SELECT MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE FROM @PREPARERESULTDATA 

 /*--------------------------------------------INSERT IN CONSOLIDATE --------------------*/ 
 
     INSERT INTO CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT(COURSE_ID_MAIN,COURSE_ID,COURSE_NAME, A.MASTER_ID,ROLL_NO)
     SELECT  C.COURSE_ID_MAIN,C.COURSE_ID,D.COURSE_NAME_MAIN ,A.MASTER_ID,A.ROLL_NO    
	 FROM STUDENT_RESULT A 
	 INNER JOIN 
     @TBLRESULTDATA T 
     ON A.RESULT_ID=T.RESULT_ID
     AND A.COURSE_ID=T.COURSE_ID
     LEFT OUTER JOIN  
     CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
     ON A.ROLL_NO=B.ROLL_NO 
	 INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER C ON
	 C.COURSE_ID=A.COURSE_ID
     INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER_MAIN D ON
	 C.COURSE_ID_MAIN=D.COURSE_ID_MAIN
     WHERE A.COURSE_ID=@COURSE_ID
	 AND  B.ROLL_NO IS NULL
	  
 	/*-------------------------------------------------------------------------------------------*/
	 

-- UPDATE STUDENT_MARKS  SET TOTAL_OBT=0
--,THEORY_MAX=0
--,THEORY_MIN=0
--,TOTAL_MAX=0
--,TOTAL_MIN=0
-- WHERE ROLL_NO='2403980140053'
--AND YEAR_SEM=1
 /*---------------------------RESET RESULT DATA-----------------------------------------------*/
 
  
  UPDATE  R
    SET TOTAL_CREDIT=0
   ,EARNED_CREDIT=0
   ,SEMESTER_RESULT=NULL
   ,ERROR_DETAILS=NULL
   ,TOTAL_POINT=0
   ,TOTAL_GRADE_POINT=0
   ,SGPA=0
   ,TOTAL_OBT_MARKS=0 
   ,TOTAL_MAX_MARKS=0
   ,TOTAL_MIN_MARKS=0
    FROM STUDENT_RESULT R
    WHERE EXISTS  (SELECT 1 FROM @TBLRESULTDATA  T WHERE R.RESULT_ID=T.RESULT_ID)
 
 
UPDATE A SET   
         A.CREDIT= P.CREDIT                                                                  
        ,A.THEORY_MAX=OD.THEORY_MAX                                                           
        ,A.THEORY_MIN=OD.THEORY_MIN  
	    ,A.INTERNAL_MAX=OD.INTERNAL_MAX                                                       
        ,A.INTERNAL_MIN=OD.INTERNAL_MIN                                                       
        ,A.SESSIONAL_MAX =OD.SESSIONAL_MAX                                                    
        ,A.SESSIONAL_MIN =OD.SESSIONAL_MIN                                                    
        ,A.TOTAL_MAX =OD.PAPER_TOTAL_MAX 
        ,A.TOTAL_MIN =OD.PAPER_TOTAL_MIN  
		,A.TOTAL_OBT =ISNULL( IIF((A.THEORY_OBT=-99 OR  A.THEORY_OBT=-98), 0,  A.THEORY_OBT),0) 
                                   +ISNULL( NULLIF(A.INTERNAL_OBT,-99),0) +ISNULL( NULLIF(A.SESSIONAL_OBT,-99),0) 
				  
		,THEORY_PRACT_ABSENT=IIF((A.THEORY_OBT=-99),1, 0) 
		,INTERNAL_ABSENT=IIF((A.INTERNAL_OBT=-99),1, 0) 
		,SESSIONAL_ABSENT=IIF((A.SESSIONAL_OBT=-99),1, 0) 
		,A.UFM=  IIF((A.THEORY_OBT=-98),1, 0)
		,A.THEORY_PRACT_MW= IIF((A.THEORY_OBT IS NULL ),1, 0)
		,A.INTERNAL_MW= IIF((OD.INTERNAL_CHECK=1 AND INTERNAL_OBT IS NULL) ,1, 0)
		,A.SESSIONAL_MW= IIF((OD.SESSIONAL_CHECK=1 AND SESSIONAL_OBT IS NULL) ,1, 0)
		,A.GRADE=NULL
		,A.PAPER_STATUS= CASE  
		                    WHEN  A.PAPER_NAME='NOT OPTED' AND A.SUBJECT_TYPE='MINOR' THEN 'PASS'
							WHEN ( (OD.INTERNAL_CHECK=1 AND   INTERNAL_OBT IS NOT NULL  AND    ISNULL(A.INTERNAL_OBT,0)> ISNULL(OD.INTERNAL_MAX,0) )  
							        OR 
								   (OD.INTERNAL_CHECK=0 AND   INTERNAL_OBT IS NOT NULL )  
							     ) THEN 'INT_ERR'

                            WHEN ( 
							       (OD.SESSIONAL_CHECK=1 AND  SESSIONAL_OBT IS NOT NULL  AND  ISNULL(A.SESSIONAL_OBT,0)> ISNULL(OD.SESSIONAL_MAX,0) )  
							        OR 
								   (OD.SESSIONAL_CHECK=0 AND  SESSIONAL_OBT IS NOT NULL )  
							     ) THEN 'SES_ERR'

                                 WHEN ((A.THEORY_OBT IS NOT NULL AND A.THEORY_OBT> OD.THEORY_MAX) OR (A.TOTAL_OBT IS NOT NULL AND A.TOTAL_OBT> OD.PAPER_TOTAL_MAX)  ) THEN 'MRK_ERR' 
						      

		                    ELSE NULL
					     END 
	          ,[LAST_UPDATED_AT]=GETDATE()  

    FROM [dbo].[STUDENT_MARKS] A
   INNER JOIN 
   @TBLRESULTDATA B 
   ON A.RESULT_ID=B.RESULT_ID
   AND A.COURSE_ID=B.COURSE_ID
   INNER JOIN
   AGRA_MASTER.DBO.RESULTTYPE_WISE_ORDINANCE CO 
   ON B.COURSE_ID= CO.COURSE_ID
   AND B.ORDINANCE_ID=CO.ORDINANCE_ID
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE O
    ON  B.ORDINANCE_ID =O.ORDINANCE_ID  
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE_DETAILS OD 
   ON O.ORDINANCE_ID=OD.ORDINANCE_ID
   INNER JOIN 
   PAPER_MASTER P 
   ON A.PAPER_CODE=P.PAPER_CODE_PK
   AND P.PAPER_TYPE_CAT=OD.PAPER_TYPE_CAT
 
  
/*-------------------------------------------CHECK VALIDATION OF DATA -------------------------------*/ 

 

;WITH TEMP AS
 (
SELECT  COUNT(1)TOTALPAPERCOUNT,
        COUNT( IIF(SUBJECT_TYPE = 'THEORY',1,NULL))THEORY_COUNT,
        COUNT( IIF(SUBJECT_TYPE= 'PRACTICAL',1,NULL))PRACTIAL_COUNT,
		COUNT( IIF((PAPER_STATUS = 'INT_ERR' OR PAPER_STATUS = 'MRK_ERR'  OR PAPER_STATUS = 'SES_ERR'),1,NULL))MRK_ERR,
		COUNT( IIF(SUBJECT_TYPE= 'RESEARCH',1,NULL))RESEARCH,
		SUM(IIF(SUBJECT_TYPE = 'THEORY',TOTAL_OBT,0))THEORY_MRK_TOTAL,
        SUM(IIF(SUBJECT_TYPE = 'PRACTICAL',TOTAL_OBT,0))PRACTICAL_MRK_TOTAL,
	    SUM(TOTAL_OBT )GRAND_TOTAL,
  B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  FROM [dbo].[STUDENT_MARKS] A
  INNER JOIN @TBLRESULTDATA B 
  ON A.RESULT_ID=B.RESULT_ID
  AND A.COURSE_ID=B.COURSE_ID
   GROUP BY B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  )


   UPDATE A SET SEMESTER_RESULT=IIF(ERRORDETAILS IS NULL ,NULL,'#ERROR')
  ,IS_PUBLISHED=10
  ,PUBLISH_DATE=GETDATE()
  ,ERROR_DETAILS=ERRORDETAILS
 

  FROM  STUDENT_RESULT A
  
  INNER JOIN (
                SELECT RESULT_ID 
				     ,CASE WHEN MRK_ERR>0 THEN 'PAPER MARK ERROR' 
				      WHEN A.TOTALPAPERCOUNT<>B.PAPER_COUNT THEN 'PAPER IS MISSING'
                      WHEN A.THEORY_COUNT<>B.MAJOR_PAPER_COUNT  THEN 'THEORY PAPER IS MISSING'
                      WHEN A.PRACTIAL_COUNT<>B.PRACTICAL_PAPER_COUNT THEN 'PRACTICAL PAPER IS MISSING'
					  WHEN A.THEORY_MRK_TOTAL> B.THEORY_MAX  THEN 'TOTAL THEORY MARKS ERROR'
                      WHEN A.PRACTICAL_MRK_TOTAL>B.PRACTICAL_MAX THEN 'TOTAL PRACTICAL MARKS ERROR'
					  WHEN  A.GRAND_TOTAL  > B.TOTAL_MAX THEN 'GRAND TOTAL MARKS ERROR'

                     ELSE
                      NULL  
                      END ERRORDETAILS
                FROM TEMP A  
                INNER JOIN 
                AGRA_MASTER.DBO.ORDINANCE B 
                ON  A.ORDINANCE_ID=B.ORDINANCE_ID
                
    ) AS B
  ON A.RESULT_ID=B.RESULT_ID
     WHERE A.COURSE_ID=@COURSE_ID
     AND A.IS_PUBLISHED=0
     AND  A.IS_HISTORY=0
	 and ERRORDETAILS IS NOT NULL
	 AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE A.RESULT_ID=T.RESULT_ID)




/*---------------DELETE THOSE RESUTID WHICH HAS ERROR------------------------------*/ 
---SELECT *
DELETE T FROM @TBLRESULTDATA T 
WHERE EXISTS ( SELECT RESULT_ID FROM STUDENT_RESULT R
                WHERE IS_PUBLISHED=10 AND T.RESULT_ID=R.RESULT_ID)

 
  /*------------------------------------------SET PAPER STATUS-----------------------------*/   
 
 UPDATE SM  SET  
 		      PAPER_STATUS=   CASE 
			                  WHEN (SM.THEORY_OBT =-99  and SM.INTERNAL_OBT=-99  ) THEN 'ABSENT' 
				              WHEN (SM.THEORY_OBT=-98  ) THEN 'UFM'
							  WHEN (SM.THEORY_OBT IS NULL OR ( (ISNULL(INTERNAL_MAX,0)>0  AND INTERNAL_OBT IS NULL) OR (ISNULL(SESSIONAL_MAX,0)>0 AND SESSIONAL_OBT IS NULL))) THEN 'MW' 
							  WHEN (SM.THEORY_OBT >0 AND SM.THEORY_OBT>=SM.THEORY_MIN AND SM.THEORY_OBT<=SM.THEORY_MAX
							        AND SM.TOTAL_OBT>0 AND SM.TOTAL_OBT>=SM.TOTAL_MIN AND SM.TOTAL_OBT<=SM.TOTAL_MAX
							  
							   and
								   ( 
									   (   ISNULL(INTERNAL_MAX,0)>0  AND  INTERNAL_OBT IS NOT NULL 
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >=0  
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >= ISNULL(SM.INTERNAL_MIN,0) 
										   AND INTERNAL_OBT <= SM.INTERNAL_MAX  
									    ) 
									   OR 
									   (ISNULL(SESSIONAL_MAX,0)=0   and 1=1)    
								    )
								  and
								   ( 
									   (   ISNULL(SESSIONAL_MAX,0)>0 AND  SESSIONAL_OBT IS NOT NULL 
										   AND ISNULL( NULLIF( SESSIONAL_OBT,-99),0) >=0  
										   AND ISNULL( NULLIF( SESSIONAL_OBT,-99),0) >= ISNULL(SM.SESSIONAL_MIN,0) 
										   AND SESSIONAL_OBT <= SM.SESSIONAL_MAX  
									    ) 
									   OR 
									   (ISNULL(SESSIONAL_MAX,0)=0  and 1=1)    
								    )

							   
								   )  
								   THEN 'PASS'

					           ELSE 
							  CASE WHEN (
							    ( TOTAL_OBT >0 AND  TOTAL_OBT< SM.TOTAL_MIN AND B.ALLOW_GRACE=1 ) and B.GRACE-(SM.TOTAL_MIN-(TOTAL_OBT)  )>=0  
								 
							   AND (
							       
								     (ISNULL(B.GRACE_APPLY_EXAM_TYPE,'0')='0' AND 1=1) 
								       OR ( 
								           (
									       GRACE_APPLY_EXAM_TYPE<>'0' 
										   AND  SM.EXAM_TYPE IN (SELECT EXAM_TYPE FROM AGRA_MASTER.[dbo].[FUN_GET_EXAMTYPE] (GRACE_APPLY_EXAM_TYPE))) 
									       )  
								      ) 
							       )
								THEN 'PASS WITH G'+CAST((SM.TOTAL_MIN-TOTAL_OBT) AS VARCHAR(15)) 
							  ELSE
							  'FAIL'
							 END
						  END 
				,LAST_UPDATED_AT= GETDATE()
						
				FROM STUDENT_MARKS SM
				INNER JOIN @TBLRESULTDATA SR
				ON SR.RESULT_ID=SM.RESULT_ID
				AND SR.MASTER_ID=SM.MASTER_ID
				INNER JOIN 
                AGRA_MASTER.DBO.ORDINANCE B 
                ON  SR.ORDINANCE_ID=B.ORDINANCE_ID


 
 

UPDATE SR SET   TOTAL_OBT_MARKS = TOTALMARKSOBT 
               ,TOTAL_MAX_MARKS=  B.TOTAL_MAX 
			   ,TOTAL_MIN_MARKS=  B.TOTAL_MIN  
			  
			   ,THEORY_OBT_MARKS =IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL,TOTAL_THEORY_OBT)
               ,THEORY_MAX_MARKS= IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL,THEORY_MAX)
			   ,THEORY_MIN_MARKS=IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL,THEORY_MIN)


			   ,[PRACTICAL_MAX_MARKS] =IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1, NULL, PRACTICAL_MAX)
               ,[PRACTICAL_MIN_MARKS]= IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1, NULL,ISNULL(B.PRACTICAL_MIN,0) )
               ,[PRACTICAL_OBT_MARKS]=IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1, NULL,ISNULL(A.TOTAL_PRACTICAL_OBT,0) )


			   ,LAST_ORDINANCE_RUN_AT=GETDATE()
			   ,LAST_UPDATED_AT=GETDATE()
               ,SR.SEMESTER_RESULT= CASE WHEN( ERRORCOUNT>0 OR PAPER_COUNT<>B.PAPER_COUNT)  THEN '#ERROR'
			                           WHEN UFMCOUNT>0    THEN 'RD( UFM )'
			                           WHEN MWCOUNT_THEORY>0     THEN 'RD( MW )'
									   
	                                   WHEN ABSENTCOUNT_THEORY=PAPERCOUNT_THEORY  THEN 'ABSENT'
                                       WHEN (ABSENTCOUNT_THEORY>0 or FAILCOUNT_THEORY>0 OR GRACECOUNT_THEORY>1 OR TOTAL_THEORY_OBT<(B.THEORY_MIN ) )THEN 'FAIL' 
									   WHEN (MAJOR_PAPER_COUNT -PASSCOUNT_THEORY=1   AND  GRACECOUNT_THEORY=1 AND TOTALMARKSOBT>=(B.TOTAL_MIN)  AND TOTAL_THEORY_OBT>=(B.THEORY_MIN) )
									   THEN  (   SELECT PAPER_STATUS FROM STUDENT_MARKS S 
									             INNER JOIN PAPER_MASTER P
												 ON S.PAPER_CODE=P.PAPER_CODE_PK
												  WHERE SR.COURSE_ID=S.COURSE_ID
												  AND SR.RESULT_ID=S.RESULT_ID
												  AND PAPER_STATUS LIKE 'PASS WITH%' AND PAPER_TYPE='T')

                                       WHEN PASSCOUNT_THEORY=B.MAJOR_PAPER_COUNT    THEN 'PASS'
						  END   
                   ,SR.PRACTICAL_RESULT= CASE WHEN( ERRORCOUNT>0 OR PRACTICAL_PAPER_COUNT<>B.PRACTICAL_PAPER_COUNT)  THEN '#ERROR'
			                           WHEN UFMCOUNT>0    THEN 'RD( UFM )'
			                           WHEN MWCOUNT_PRACTICAL>0     THEN 'RD( MW )'
									   
	                                   WHEN ABSENTCOUNT_PRACTICAL=PAPERCOUNT_PRACTICAL  THEN 'ABSENT'
                                       WHEN (ABSENTCOUNT_PRACTICAL>0 or FAILCOUNT_PRACTICAL>0 OR TOTAL_PRACTICAL_OBT<(B.PRACTICAL_MIN ) )THEN 'FAIL' 
									   WHEN (PAPERCOUNT_PRACTICAL-PASSCOUNT_PRACTICAL=1   AND TOTAL_PRACTICAL_OBT>=(B.PRACTICAL_MIN) )
									   THEN  (   SELECT PAPER_STATUS FROM STUDENT_MARKS S  
									              INNER JOIN PAPER_MASTER P
												 ON S.PAPER_CODE=P.PAPER_CODE_PK
												  WHERE SR.COURSE_ID=S.COURSE_ID
												  AND SR.RESULT_ID=S.RESULT_ID
												  AND PAPER_STATUS LIKE 'PASS WITH%' AND PAPER_TYPE='P')
                                      
									   WHEN PASSCOUNT_PRACTICAL=B.PRACTICAL_PAPER_COUNT    THEN 'PASS'
									 
									 END 



 
 
    FROM STUDENT_RESULT  SR
   
   INNER JOIN ( 
      SELECT SM.ROLL_NO
	 ,SUM(SM.TOTAL_OBT)TOTALMARKSOBT 
	 ,SUM(IIF(PAPER_TYPE='T',SM.TOTAL_OBT,0))TOTAL_THEORY_OBT
	 ,SUM(IIF(PAPER_TYPE= 'P',SM.TOTAL_OBT,0))TOTAL_PRACTICAL_OBT



     ,COUNT( IIF((PAPER_STATUS='INT_ERR' OR PAPER_STATUS='MRK_ERR'),1,NULL))ERRORCOUNT
	 ,COUNT( IIF((PAPER_STATUS='UFM'),1,NULL))UFMCOUNT
	 ,COUNT(IIF( PAPER_TYPE='T',1,NULL))PAPERCOUNT_THEORY
	 ,COUNT(IIF( PAPER_TYPE='P',1,NULL))PAPERCOUNT_PRACTICAL
	 ,COUNT(IIF(PAPER_TYPE='T' AND   PAPER_STATUS='MW',1,NULL))MWCOUNT_THEORY
	 ,COUNT(IIF(PAPER_TYPE='T' AND    PAPER_STATUS='PASS',1,NULL))PASSCOUNT_THEORY
	 ,COUNT(IIF(PAPER_TYPE='T' AND    PAPER_STATUS   LIKE 'PASS WITH%',1,NULL))GRACECOUNT_THEORY
	 ,COUNT(IIF(PAPER_TYPE='T' AND    PAPER_STATUS='ABSENT',1,NULL))ABSENTCOUNT_THEORY
	 ,COUNT(IIF(PAPER_TYPE='T' AND   PAPER_STATUS='FAIL',1,NULL))FAILCOUNT_THEORY

	 ,COUNT(IIF(PAPER_TYPE='p' AND    PAPER_STATUS='PASS',1,NULL))PASSCOUNT_PRACTICAL
	 ,COUNT(IIF(PAPER_TYPE='p' AND    PAPER_STATUS   LIKE 'PASS WITH%',1,NULL))GRACECOUNT_PRACTICAL
	 ,COUNT(IIF(PAPER_TYPE='p' AND    PAPER_STATUS='ABSENT',1,NULL))ABSENTCOUNT_PRACTICAL
	 ,COUNT(IIF(PAPER_TYPE='p' AND   PAPER_STATUS='FAIL',1,NULL))FAILCOUNT_PRACTICAL
	 ,COUNT(IIF(PAPER_TYPE='p' AND   PAPER_STATUS='MW',1,NULL))MWCOUNT_PRACTICAL


	 ,SM.MASTER_ID,SM.RESULT_ID
	 FROM STUDENT_MARKS SM
	 INNER JOIN @TBLRESULTDATA SR
	 ON SR.RESULT_ID=SM.RESULT_ID
	 AND SR.MASTER_ID=SM.MASTER_ID
	 INNER JOIN PAPER_MASTER PM
	 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
     GROUP BY SM.ROLL_NO,SM.MASTER_ID,SM.RESULT_ID 

 )AS A ON A.MASTER_ID=SR.MASTER_ID 
	    AND A.RESULT_ID=SR.RESULT_ID 
	    INNER JOIN 
        AGRA_MASTER.DBO.ORDINANCE B 
        ON  SR.ORDINANCE_ID=B.ORDINANCE_ID
	    WHERE  SR.IS_PUBLISHED = 0 
	    AND SR.IS_HISTORY=0
		AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)
		 
 /*------------------------UPDATE CONSOLIDATE --------------------*/
  EXEC UPDATE_STUDENT_CONSOLIDATE @TBLRESULTDATA ,@COURSE_ID,@RESULT_TYPE_ID
 /*-----------------------------------END-------------------------------*/
 
 UPDATE  SR  set    FINAL_RESULT=
   CASE   WHEN  (SEMESTER_RESULT='ABSENT' OR PRACTICAL_RESULT ='ABSENT')  THEN 'ABSENT'
				                         WHEN  (SEMESTER_RESULT='RD( MW )' OR PRACTICAL_RESULT ='RD( MW )')   THEN  'RD( MW )'
										 WHEN  SEMESTER_RESULT='RD( UFM )'   THEN  'RD( UFM )'
										 WHEN ( SEMESTER_RESULT='FAIL'OR PRACTICAL_RESULT = 'FAIL' )THEN   'FAIL'
                                         WHEN  YEAR_SEM=1 AND( SEMESTER_RESULT LIKE 'PASS%' AND  PRACTICAL_RESULT = 'PASS')  THEN'PASS'
										 /*-----------------------PROMOTED BACK-------------------*/

										 WHEN YEAR_SEM=2 AND  SEMESTER_RESULT='PASS' 
										     AND  (b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=0 or b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=0) 
										     THEN  'RD( PYMW )'
										 
                                        
										 WHEN YEAR_SEM=3 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=0 OR  b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=0 or b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=0) 
										      ) 
										   THEN  'PROMOTED WITH BACK'


                                          WHEN YEAR_SEM=4 AND  SEMESTER_RESULT='PASS' 
										       AND ((b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=0 OR b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=0 OR  b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=0 or b.RESULTSTATUS & POWER(2,YEAR_SEM-4)=0) 
										      ) 
										  THEN  'PROMOTED WITH BACK'


										  
										   WHEN YEAR_SEM=5 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=0 OR b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=0 OR b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=0 OR  b.RESULTSTATUS & POWER(2,YEAR_SEM-4)=0 or b.RESULTSTATUS & POWER(2,YEAR_SEM-5)=0) 
										           ) 
										   THEN  'PROMOTED WITH BACK'


										     WHEN YEAR_SEM=6 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=0 OR b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=0 OR b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=0 OR b.RESULTSTATUS & POWER(2,YEAR_SEM-4)=0 OR  b.RESULTSTATUS & POWER(2,YEAR_SEM-5)=0 or b.RESULTSTATUS & POWER(2,YEAR_SEM-6)=0) 
										          ) 
										       THEN  'PROMOTED WITH BACK'



										  /*--------------------------------------------------------------------*/

						                 WHEN  YEAR_SEM=2 AND   (b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=2 and b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=1   )
							              AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS		
 
										 THEN  'PASS'
		                         
								 
								         WHEN  YEAR_SEM=3 AND   (b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=4   and b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=2 and b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=1 )
							              AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
										 THEN  'PASS'
								 
							         	 

								 
								         WHEN  YEAR_SEM=4 AND   (b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=8  and b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=4 and b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=2 and b.RESULTSTATUS & POWER(2,YEAR_SEM-4)=1 and b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=1   )
							             AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
						                 THEN  'PASS'

                                     	 WHEN  YEAR_SEM=5 AND   (b.RESULTSTATUS & POWER(2,YEAR_SEM-1)=16  and b.RESULTSTATUS & POWER(2,YEAR_SEM-2)=8 and b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=4 and b.RESULTSTATUS & POWER(2,YEAR_SEM-4)=2 and b.RESULTSTATUS & POWER(2,YEAR_SEM-5)=1 and b.RESULTSTATUS & POWER(2,YEAR_SEM-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,YEAR_SEM-1)=16 and b.QUALIFYING_PAPER & POWER(2,YEAR_SEM-2)=8 and b.QUALIFYING_PAPER & POWER(2,YEAR_SEM-3)=8 and b.QUALIFYING_PAPER & POWER(2,YEAR_SEM-4)=2 and b.QUALIFYING_PAPER & POWER(2,YEAR_SEM-5)=1)  AND  (B.EARN_CREDIT_5 ) IN(20)  )
							             AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
						                 THEN  'PASS'
                                       
									    WHEN YEAR_SEM=6 AND  B.RESULTSTATUS=63  
										 AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
										 THEN  'PASS' 
								 
								 END 
    
							 FROM STUDENT_RESULT SR   
							  INNER JOIN @TBLRESULTDATA T
							  ON SR.RESULT_ID=T.RESULT_ID
							  INNER JOIN 
						      CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
						      ON  SR.ROLL_NO=B.ROLL_NO
	                          WHERE IS_PUBLISHED=0 
						      AND IS_HISTORY=0
								
 
 
/*-----------------------------------------DIVISION --------------------------------------------------*/

 ;WITH TEMPDIVISION AS
  (
  SELECT A.MASTER_ID,A.ROLL_NO,
 SUM(THEORY_OBT_MARKS)MARKS
,SUM(THEORY_MAX_MARKS)TOTALTHMAX 
,SUM(THEORY_OBT_MARKS)*100/SUM(THEORY_MAX_MARKS) THEORY_PERCENT

,SUM(PRACTICAL_OBT_MARKS)PRACMARKS
,SUM(PRACTICAL_MAX_MARKS) TOTALPRACMAX
,SUM(PRACTICAL_OBT_MARKS)*100/SUM(PRACTICAL_MAX_MARKS) PRAC_PERCENT
 
 FROM STUDENT_RESULT A
 INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER B
 ON A.COURSE_ID=B.COURSE_ID
 INNER JOIN @TBLRESULTDATA T
 ON A.ROLL_NO=T.ROLL_NO
 WHERE   A.IS_HISTORY = 0 
 AND YEAR_SEM<=(SELECT SEM_NO FROM AGRA_MASTER.DBO.COURSE_MASTER  WHERE  COURSE_ID=T.COURSE_ID AND IS_FINAL_YEAR_SEM=1)  
 GROUP BY A.MASTER_ID,A.ROLL_NO
)

 --SELECT  * FROM  TEMPDIVISION

UPDATE SR SET
FINAL_DIVISION=
CASE  WHEN FINAL_RESULT='PASS' AND  THEORY_PERCENT<= O.I_DIV_MAX_CGPA_PERCENT AND O.I_DIV_MIN_CGPA_PERCENT<=THEORY_PERCENT
THEN  'FIRST DIVISION'
  WHEN FINAL_RESULT='PASS' AND  THEORY_PERCENT<= O.II_DIV_MAX_CGPA_PERCENT AND O.II_DIV_MIN_CGPA_PERCENT<=THEORY_PERCENT
THEN  'SECOND DIVISION' 
  WHEN FINAL_RESULT='PASS' AND  THEORY_PERCENT<= O.III_DIV_MAX_CGPA_PERCENT AND O.III_DIV_MIN_CGPA_PERCENT<=THEORY_PERCENT
THEN   'THIRD DIVISION' 

END ,


THEORY_DIVISION=
CASE WHEN FINAL_RESULT='PASS' AND  THEORY_PERCENT<= O.I_DIV_MAX_CGPA_PERCENT AND O.I_DIV_MIN_CGPA_PERCENT<=THEORY_PERCENT
THEN  'FIRST DIVISION'
  WHEN FINAL_RESULT='PASS' AND  THEORY_PERCENT<= O.II_DIV_MAX_CGPA_PERCENT AND O.II_DIV_MIN_CGPA_PERCENT<=THEORY_PERCENT
THEN  'SECOND DIVISION' 
  WHEN FINAL_RESULT='PASS' AND THEORY_PERCENT<= O.III_DIV_MAX_CGPA_PERCENT AND O.III_DIV_MIN_CGPA_PERCENT<=THEORY_PERCENT
THEN   'THIRD DIVISION' 

END 
   
  ,PRACTICAL_DIVISION=CASE WHEN FINAL_RESULT='PASS' AND O.I_DIV_MIN_CGPA_PERCENT<=PRAC_PERCENT  AND PRAC_PERCENT<= O.I_DIV_MAX_PRAC_PERCENT
THEN  'FIRST DIVISION'
  WHEN FINAL_RESULT='PASS' AND  O.II_DIV_MIN_PRAC_PERCENT<=PRAC_PERCENT AND PRAC_PERCENT<= O.II_DIV_MAX_PRAC_PERCENT
THEN  'SECOND DIVISION' 
  WHEN FINAL_RESULT='PASS' AND O.III_DIV_MIN_PRAC_PERCENT<=PRAC_PERCENT AND  PRAC_PERCENT<= O.III_DIV_MAX_PRAC_PERCENT
THEN   'THIRD DIVISION' 

END  
 
FROM  TEMPDIVISION A
INNER JOIN @TBLRESULTDATA B
ON A.MASTER_ID=B.MASTER_ID
INNER JOIN 
STUDENT_RESULT SR
ON B.RESULT_ID=SR.RESULT_ID
AND A.MASTER_ID=SR.MASTER_ID
AND SR.ORDINANCE_ID=B.ORDINANCE_ID
INNER JOIN 
 AGRA_MASTER.DBO.ORDINANCE O
 ON O.ORDINANCE_ID=SR.ORDINANCE_ID

  


/*----------------------------------------------------------------------------------------------------*/


 /*----------------SET FINAL RESULT IMW PMW------------------------*/
  EXEC SET_IMW_PMW @TBLRESULTDATA,@COURSE_ID

/*------------------------------------------------------------------*/

 
	   /*----------UPDATE PUBLISHED STATUS 0-FOR WAITING FOR EXECUTE, 1-EXECUTED ,2-LIVE------*/
	   
		UPDATE  SR SET SR.IS_PUBLISHED=1,PUBLISH_DATE=GETDATE(),LAST_ORDINANCE_RUN_AT=GETDATE(),IS_LIVE=0
		    FROM STUDENT_RESULT SR
		    INNER JOIN @TBLRESULTDATA T
			ON SR.RESULT_ID=T.RESULT_ID
			AND SR.COURSE_ID=T.COURSE_ID
			WHERE SR.IS_PUBLISHED=0
			AND SR.IS_HISTORY=0
 
GO
/****** Object:  StoredProcedure [dbo].[ORDINANCE_FOR_TEST]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 

CREATE PROC [dbo].[ORDINANCE_FOR_TEST] 
 (
  @PREPARERESULTDATA   RESULT_USERS_TBLTYPE  READONLY 
 ,@COURSE_ID INT =111
 ,@RESULT_TYPE_ID INT 

)

AS

DECLARE @POINT  INT =0
DECLARE @PAPER_RESULT VARCHAR(80)
DECLARE @FINAL_RESULT VARCHAR(20)
DECLARE @EarnCR INT =0
DECLARE @GRADE_POINT  VARCHAR(20)
DECLARE @TBLRESULTDATA AS  RESULT_USERS_TBLTYPE  
 
  INSERT INTO @TBLRESULTDATA (MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE)
  SELECT MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE FROM @PREPARERESULTDATA 

 /*--------------------------------------------INSERT IN CONSOLIDATE --------------------*/ 
  
  
   
  

 /*-------------------------------------------------------------------------------------------*/


 /*---------------------------RESET RESULT DATA-----------------------------------------------*/

  UPDATE  R
   SET TOTAL_CREDIT=0
   ,EARNED_CREDIT=0
   ,SEMESTER_RESULT=NULL
   ,ERROR_DETAILS=NULL
   ,TOTAL_POINT=0
   ,TOTAL_GRADE_POINT=0
   ,SGPA=0
   ,TOTAL_OBT_MARKS=0 
   FROM STUDENT_RESULT R
    WHERE EXISTS  (SELECT 1 FROM @TBLRESULTDATA  T WHERE R.RESULT_ID=T.RESULT_ID)
  
    
   /*COURSE_ID=@COURSE_ID
   AND SESSION=@SESSION
   AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
   AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  ROLL_NO=@ROLL_NO ))   
   AND IS_PUBLISHED=0
   */
 

 
UPDATE A SET   
         A.CREDIT= P.CREDIT                                                                  
        ,A.THEORY_MAX=OD.THEORY_MAX                                                           
        ,A.THEORY_MIN=OD.THEORY_MIN  
	    ,A.INTERNAL_MAX=OD.INTERNAL_MAX                                                       
        ,A.INTERNAL_MIN=OD.INTERNAL_MIN                                                       
        ,A.SESSIONAL_MAX =OD.SESSIONAL_MAX                                                    
        ,A.SESSIONAL_MIN =OD.SESSIONAL_MIN                                                    
        ,A.TOTAL_MAX =OD.PAPER_TOTAL_MAX 
        ,A.TOTAL_MIN =OD.PAPER_TOTAL_MIN  
        ,A.TOTAL_OBT =ISNULL( IIF((A.THEORY_OBT=-99 OR  A.THEORY_OBT=-98), 0,  A.THEORY_OBT),0) 
                                   +ISNULL( NULLIF(A.INTERNAL_OBT,-99),0) +ISNULL( NULLIF(A.SESSIONAL_OBT,-99),0) 
				  
		,THEORY_PRACT_ABSENT=IIF((A.THEORY_OBT=-99),1, 0) 
		,INTERNAL_ABSENT=IIF((A.INTERNAL_OBT=-99),1, 0) 
		,SESSIONAL_ABSENT=IIF((A.SESSIONAL_OBT=-99),1, 0) 
		,A.UFM=  IIF((A.THEORY_OBT=-98),1, 0)
		,A.THEORY_PRACT_MW= IIF((A.THEORY_OBT IS NULL ),1, 0)
		,A.INTERNAL_MW= IIF((OD.INTERNAL_CHECK=1 AND INTERNAL_OBT IS NULL) ,1, 0)
		,A.SESSIONAL_MW= IIF((OD.SESSIONAL_CHECK=1 AND SESSIONAL_OBT IS NULL) ,1, 0)
		,A.GRADE=NULL
		,A.PAPER_STATUS= CASE  
		                    WHEN  A.PAPER_NAME='NOT OPTED' AND A.SUBJECT_TYPE='MINOR' THEN 'PASS'
							WHEN (OD.INTERNAL_MAX IS NOT  NULL AND   INTERNAL_OBT IS NOT NULL  AND    ISNULL(A.INTERNAL_OBT,0)> ISNULL(OD.INTERNAL_MAX,0) )   THEN 'INT_ERR'
							WHEN ((A.THEORY_OBT IS NOT NULL AND A.THEORY_OBT> OD.THEORY_MAX) ) THEN 'MRK_ERR' 
							       

		                    ELSE NULL
					     END 
	          ,[LAST_UPDATED_AT]=GETDATE()  

   FROM [dbo].[STUDENT_MARKS] A
   INNER JOIN 
   @TBLRESULTDATA B 
   ON A.RESULT_ID=B.RESULT_ID
   AND A.COURSE_ID=B.COURSE_ID
   INNER JOIN
   AGRA_MASTER.DBO.RESULTTYPE_WISE_ORDINANCE CO 
   ON B.COURSE_ID= CO.COURSE_ID
    AND B.ORDINANCE_ID=CO.ORDINANCE_ID
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE O
   ON  B.ORDINANCE_ID =O.ORDINANCE_ID  
   
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE_DETAILS OD 
   ON O.ORDINANCE_ID=OD.ORDINANCE_ID
   INNER JOIN 
   PAPER_MASTER P 
   ON A.PAPER_CODE=P.PAPER_CODE_PK
   AND P.PAPER_TYPE_CAT=OD.PAPER_TYPE_CAT
 
 

 /*
   WHERE B.COURSE_ID=@COURSE_ID
   AND B.SESSION=@SESSION
   AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  B.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
   AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  B.ROLL_NO=@ROLL_NO ))   
   AND B.IS_PUBLISHED=0
   */
    
/*-------------------------------------------CHECK VALIDATION OF DATA -------------------------------*/ 

 

;WITH TEMP AS
 (
SELECT  COUNT(DISTINCT IIF(SUBJECT_TYPE IN('MAJOR1','MAJOR2','MAJOR_ELECTIVE'),SUBJECT_TYPE,NULL))MAJORCOUNT,
        COUNT( IIF(SUBJECT_TYPE = 'VOCATIONAL',1,NULL))VOCATIONAL,
        COUNT( IIF(SUBJECT_TYPE= 'CO_CURRICULAR',1,NULL))COCURRICULAR,
		COUNT( IIF((PAPER_STATUS = 'INT_ERR' OR PAPER_STATUS = 'MRK_ERR' ),1,NULL))MRK_ERR,
		COUNT( IIF(SUBJECT_TYPE= 'RESEARCH',1,NULL))RESEARCH,
        SUM(IIF(SUBJECT_TYPE = 'MINOR',CREDIT,0))MINORCR,
        SUM(IIF(SUBJECT_TYPE LIKE 'MAJOR%',CREDIT,0))MAJORCR,
        SUM(IIF(SUBJECT_TYPE = 'VOCATIONAL',CREDIT,0))VOCATIONALCR,
  B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  FROM [dbo].[STUDENT_MARKS] A
  INNER JOIN @TBLRESULTDATA B 
  ON A.RESULT_ID=B.RESULT_ID
  AND A.COURSE_ID=B.COURSE_ID
  
  /*
  --INNER JOIN @TBLRESULTDATA T
   --ON T.RESULT_ID=A.RESULT_ID
   --AND A.COURSE_ID=T.COURSE_ID
   --WHERE B.IS_PUBLISHED=0
   --AND  B.IS_HISTORY=0

  --WHERE B.COURSE_ID=@COURSE_ID
  --AND B.SESSION=@SESSION
  --AND B.EXAM_TYPE=@EXAMTYPE
  --AND B.IS_PUBLISHED=0
  --AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  B.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
  --AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  B.ROLL_NO=@ROLL_NO ))
  */

   GROUP BY B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  )

 
   UPDATE A SET SEMESTER_RESULT=IIF(ERRORDETAILS IS NULL ,NULL,'#ERROR')
  ,IS_PUBLISHED=10
  ,PUBLISH_DATE=GETDATE()
  ,ERROR_DETAILS=ERRORDETAILS
  FROM  STUDENT_RESULT A
  
  INNER JOIN (
                SELECT RESULT_ID 
				     ,CASE WHEN MRK_ERR>0 THEN 'PAPER MARK ERROR' 
				      WHEN A.MAJORCOUNT<>B.MAJOR_PAPER_COUNT THEN 'MAJOR PAPER IS MISSING'
                      WHEN A.VOCATIONAL<>B.VOCATIONAL_PAPER_COUNT  THEN 'VOCATIONAL  PAPER IS MISSING'
                      WHEN A.COCURRICULAR<>B.QUALIFY_PAPER_COUNT THEN 'CO-CURRICULAR PAPER IS MISSING'
					  WHEN A.RESEARCH<>B.RESEARCH_PAPER_COUNT THEN 'RESEARCH PAPER IS MISSING'
                      WHEN A.MAJORCR<>B.TOTAL_MAJOR_CR THEN 'MAJOR PAPER CREDIT IS WRONG'
                      WHEN A.VOCATIONALCR<>B.VOCATIONAL_CR THEN 'VOCATIONAL PAPER CREDIT IS WRONG'
					  
                      WHEN MINORCR>0 AND  (A.MAJORCR+A.VOCATIONALCR+MINORCR) NOT IN (25,27)  THEN 'MINOR PAPER CREDIT IS WRONG'
                     
					 ELSE
                      NULL  
                      END ERRORDETAILS
                FROM TEMP A  
                INNER JOIN 
                AGRA_MASTER.DBO.ORDINANCE B 
                ON  A.ORDINANCE_ID=B.ORDINANCE_ID
                /*WHERE 
                (
                 A.MAJORCOUNT<>B.MAJOR_PAPER_COUNT
                 OR A.VOCATIONAL<>B.VOCATIONAL_PAPER_COUNT 
                 OR A.COCURRICULAR<>B.QUALIFY_PAPER_COUNT
                 OR A.MAJORCR<>B.TOTAL_MAJOR_CR
                 OR A.VOCATIONALCR<>B.VOCATIONAL_CR
				  OR A.RESEARCH<>B.RESEARCH_PAPER_COUNT
                 OR  MINORCR>0 AND  (A.MAJORCR+A.VOCATIONALCR+MINORCR) NOT IN (25,27)
				 OR MRK_ERR>0
                )*/
    ) AS B
  ON A.RESULT_ID=B.RESULT_ID
     WHERE A.COURSE_ID=@COURSE_ID
     AND A.IS_PUBLISHED=0
     AND  A.IS_HISTORY=0
	 and ERRORDETAILS IS NOT NULL
	 AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE A.RESULT_ID=T.RESULT_ID)

/*---------------DELETE THOSE RESUTID WHICH HAS ERROR------------------------------*/ 
---SELECT *


DELETE T FROM @TBLRESULTDATA T 
WHERE EXISTS ( SELECT RESULT_ID FROM STUDENT_RESULT R
                WHERE IS_PUBLISHED=10 AND T.RESULT_ID=R.RESULT_ID)


 /*
  WHERE A.COURSE_ID=@COURSE_ID
  AND A.SESSION=@SESSION
  AND A.EXAM_TYPE=@EXAMTYPE
  AND A.IS_PUBLISHED=0
  AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  A.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
  AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  A.ROLL_NO=@ROLL_NO ))   
  */ 
    
  /*------------------------------------------SET PAPER STATUS-----------------------------*/   
 
 UPDATE SM  SET  
 		      PAPER_STATUS=   CASE 
			                  WHEN (SM.THEORY_OBT =-99  and SM.INTERNAL_OBT=-99  ) THEN 'ABSENT' 
				              WHEN ( SM.THEORY_OBT=-98  ) THEN 'UFM'
							  WHEN (SM.THEORY_OBT IS NULL OR (INTERNAL_MAX IS NOT NULL AND INTERNAL_OBT IS NULL)) THEN 'MW' 
							  WHEN (SM.THEORY_OBT >0 AND SM.THEORY_OBT>=SM.THEORY_MIN AND SM.THEORY_OBT<=SM.THEORY_MAX
							        AND SM.TOTAL_OBT>0 AND SM.TOTAL_OBT>=SM.TOTAL_MIN AND SM.TOTAL_OBT<=SM.TOTAL_MAX
							  
							   and
								   ( 
									   (   INTERNAL_MAX IS NOT NULL  AND  INTERNAL_OBT IS NOT NULL 
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >=0  
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >= ISNULL(SM.INTERNAL_MIN,0) 
										   AND INTERNAL_OBT <= SM.INTERNAL_MAX  
									    ) 
									   OR 
									   (INTERNAL_MAX IS  NULL  and 1=1)    
								   
								   
								   )
								  

							   
								   )  
								   THEN 'PASS'

					           ELSE 'FAIL' 
							END 
				,LAST_UPDATED_AT= GETDATE()
						
				FROM STUDENT_MARKS SM
				 INNER JOIN @TBLRESULTDATA SR
				 ON SR.RESULT_ID=SM.RESULT_ID
				 AND SR.MASTER_ID=SM.MASTER_ID




				/*  INNER JOIN @TBLRESULTDATA T
                  ON T.RESULT_ID=SR.RESULT_ID
                  AND T.COURSE_ID=SR.COURSE_ID
				  WHERE  SR.IS_PUBLISHED = 0 
	                AND  SR.IS_HISTORY=0

				
				   WHERE  SM.COURSE_ID = @COURSE_ID 
				    AND SR.EXAM_TYPE=@EXAMTYPE 
					AND SR.SESSION=@SESSION 
					AND PAPER_NAME<>'NOT OPTED'
				    AND SR.IS_PUBLISHED=0        
					AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  SR.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  )
                    AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  SR.ROLL_NO=@ROLL_NO ))
		       */

 



 /*--------------------SET CREDIT --------------------------------------------------------------*/

 
 UPDATE SM SET @POINT=CASE WHEN PM.PAPER_TYPE NOT IN('C','R') AND  SM.PAPER_STATUS ='PASS' 
			   THEN   (SELECT VALUE FROM  (SELECT  ROW_NUMBER()OVER(ORDER BY VALUE)RW, VALUE  FROM  STRING_SPLIT(  dbo.GET_GRADE_POINT(SR.RESULT_TYPE,SM.TOTAL_OBT*100/FLOOR(PM.TOTAL_MAX)),','))AS A WHERE RW=1) ELSE 0   END  
			  ,Point=@POINT
			 ,@EarnCR =IIF( SM.PAPER_STATUS ='PASS', PM.CREDIT  ,0 )
			 ,SM.EARNED_CREDIT=@EarnCR
		     ,SM.GRADE_POINT= @POINT*@EarnCR
			 ,Grade= CASE 
			          WHEN   PM.PAPER_TYPE  IN('C') AND  SM.PAPER_STATUS='PASS' THEN 'Q'
	                  WHEN  PM.PAPER_TYPE  IN('C') AND  SM.PAPER_STATUS IN('FAIL','ABSENT')  THEN 'NQ'
					  WHEN  PM.PAPER_TYPE  IN('C') AND  SM.PAPER_STATUS='MW'  THEN ''
                      WHEN  PM.PAPER_TYPE NOT IN('C') AND ( SM.PAPER_STATUS='FAIL' )  THEN 'F' 
					  WHEN  PM.PAPER_TYPE NOT IN('C') AND   SM.PAPER_STATUS='MW' THEN '' 
					  WHEN  PM.PAPER_TYPE NOT IN('C') AND SM.PAPER_STATUS='ABSENT' THEN 'AB' 
                      ELSE  
					  CASE 
					  WHEN PM.PAPER_TYPE NOT IN('C') AND SM.PAPER_STATUS='MW' THEN '' 
					  WHEN SM.PAPER_STATUS LIKE '%ERR' THEN ''
					  WHEN SM.PAPER_STATUS='ABSENT' THEN 'AB' WHEN SM.PAPER_STATUS='FAIL' THEN 'F' WHEN SM.PAPER_STATUS='UFM' THEN 'U' 
			          ELSE (SELECT VALUE FROM  (SELECT  ROW_NUMBER()OVER(ORDER BY VALUE)RW, VALUE  FROM  STRING_SPLIT( dbo.GET_GRADE_POINT(SR.RESULT_TYPE, SM.TOTAL_OBT *100/FLOOR(PM.TOTAL_MAX)),','))AS A WHERE RW=2) 
					  END 
			 END 



            FROM STUDENT_MARKS SM
				 INNER JOIN @TBLRESULTDATA SR
				 ON SR.RESULT_ID=SM.RESULT_ID
				 AND SR.MASTER_ID=SM.MASTER_ID
				 INNER JOIN PAPER_MASTER PM
				 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
				  
				 
				/* 
				  WHERE  SR.IS_PUBLISHED = 0 
                    AND  SR.IS_HISTORY=0
				  SM.COURSE_ID  = @COURSE_ID 
				 AND SR.EXAM_TYPE=@EXAMTYPE 
				 AND SR.SESSION=@SESSION 
				 AND SR.IS_PUBLISHED=0
				 AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  SR.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
				 AND ( (lEN(@ROLL_NO)=0 AND 1=1) OR  (lEN(@ROLL_NO)>1  AND  SR.ROLL_NO=@ROLL_NO )) ;  

				 */
 

 UPDATE SR SET SR.TOTAL_CREDIT=A.TOTALCREDIT
              ,SR.EARNED_CREDIT =A.TOTALEARNCREDIT
			  ,SR.TOTAL_MAJOR_CREDIT=TOTALMAJORCREDIT
			  ,SR.TOTAL_MAJOR_EARN_CREDIT=TOTALMAJOREARNCREDIT
			  ,SR.TOTAL_POINT=A.TOTALPOINT 
	          ,SR.TOTAL_GRADE_POINT=GRADEPOINT
	          ,TOTAL_OBT_MARKS =TOTALMARKSOBT
			  ,TOTAL_MAX_MARKS=THEORY_MAX
			  ,TOTAL_MIN_MARKS=THEORY_MIN
			  ,SR.CO_CURRICULAR_RESULT=A.CO_CURRICULAR_RESULT
	          ,SR.SGPA= CASE 
			               WHEN A.TOTALCREDIT>0 THEN  CONVERT(DECIMAL(7,3),ROUND( A.GRADEPOINT/CONVERT( DECIMAL(7,3),A.TOTALCREDIT),3,1)) ELSE 0 
			        	END  

             ,LAST_ORDINANCE_RUN_AT=GETDATE()
			 ,LAST_UPDATED_AT=GETDATE()
             ,SR.SEMESTER_RESULT= CASE WHEN UFMCOUNT>0    THEN 'RD( UFM )'
			                           WHEN MWCOUNT>0     THEN 'RD( MW )'
									   WHEN ERRORCOUNT>0  THEN '#ERROR'
	                                   WHEN ABSENTCOUNT=PAPERCOUNT  THEN 'ABSENT'
			                           WHEN (ABSENTCOUNT>0 or FAILCOUNT>0 ) THEN 'FAIL' 
									   --WHEN FAILCOUNT>0   THEN 'FAIL'
									   WHEN PASSCOUNT=PAPERCOUNT    THEN 'PASS'
									 
									 END 
       FROM STUDENT_RESULT  SR
   
   INNER JOIN (
      SELECT SM.ROLL_NO
	 ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.CREDIT,0))TOTALCREDIT
	 ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.EARNED_CREDIT,0))TOTALEARNCREDIT
	 ,SUM(IIF(SM.SUBJECT_TYPE IN( 'MAJOR1','MAJOR2','MAJOR_ELECTIVE') ,SM.CREDIT,0  ) )TOTALMAJORCREDIT
	 ,SUM(IIF(SM.SUBJECT_TYPE IN( 'MAJOR1','MAJOR2','MAJOR_ELECTIVE') ,SM.EARNED_CREDIT,0  ) )TOTALMAJOREARNCREDIT
     ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.POINT,0))TOTALPOINT
	 ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.GRADE_POINT,0)) GRADEPOINT 
	 ,SUM(SM.TOTAL_OBT)TOTALMARKSOBT 
	 ,SUM( SM.TOTAL_MAX)THEORY_MAX
	 ,SUM( SM.TOTAL_MIN )THEORY_MIN 
     ,MAX(IIF( PM.PAPER_TYPE='C' AND SM.GRADE='Q' , 'Q' ,'NQ' ) ) CO_CURRICULAR_RESULT 
	 ,COUNT( IIF((PAPER_STATUS='INT_ERR' OR PAPER_STATUS='MRK_ERR'),1,NULL))ERRORCOUNT
	 ,COUNT( IIF((PAPER_STATUS='UFM'),1,NULL))UFMCOUNT
	 ,COUNT( IIF(PM.PAPER_TYPE NOT IN('R','C') ,1,NULL))PAPERCOUNT
	 ,COUNT( IIF(PM.PAPER_TYPE NOT IN('R','C')  AND  PAPER_STATUS='MW',1,NULL))MWCOUNT
	 ,COUNT( IIF(PM.PAPER_TYPE NOT IN('R','C')  AND  PAPER_STATUS='PASS',1,NULL))PASSCOUNT
	 ,COUNT( IIF((PM.PAPER_TYPE NOT IN('R','C') AND  PAPER_STATUS='ABSENT'),1,NULL))ABSENTCOUNT
	 ,COUNT( IIF((PM.PAPER_TYPE NOT IN('R','C') AND  PAPER_STATUS='FAIL'),1,NULL))FAILCOUNT
	 ,SM.MASTER_ID,SM.RESULT_ID
	 FROM STUDENT_MARKS SM
	 INNER JOIN @TBLRESULTDATA SR
	 ON SR.RESULT_ID=SM.RESULT_ID
	 AND SR.MASTER_ID=SM.MASTER_ID
	 INNER JOIN PAPER_MASTER PM
	 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
	 
  /*
	--WHERE  SM.COURSE_ID  = @COURSE_ID 
	--AND SR.EXAM_TYPE=@EXAMTYPE 
    -- AND SR.SESSION=@SESSION 
	-- AND SR.IS_PUBLISHED=0
    -- AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  SR.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
	-- AND ( (lEN(@ROLL_NO)=0 AND 1=1) OR  (lEN(@ROLL_NO)>1  AND  SR.ROLL_NO=@ROLL_NO )) 
	*/



     GROUP BY SM.ROLL_NO,SM.MASTER_ID,SM.RESULT_ID 

 )AS A ON A.MASTER_ID=SR.MASTER_ID 
	    AND A.RESULT_ID=SR.RESULT_ID 
	    
	 WHERE  SR.IS_PUBLISHED = 0 
	       AND SR.IS_HISTORY=0
		   AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)


/*
	   WHERE SR.COURSE_ID =@COURSE_ID  
	    AND SR.IS_PUBLISHED =0
        AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  SR.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  )
        AND ( (lEN(@ROLL_NO)=0 AND 1=1) OR  (lEN(@ROLL_NO)>1  AND  SR.ROLL_NO=@ROLL_NO )) 

*/


/*------------------------------------------UPDATE CONSOLIDATE-----------------------------*/

		 UPDATE B SET B.QUALIFYING_PAPER=  IIF ( SR.CO_CURRICULAR_RESULT ='Q' ,  B.QUALIFYING_PAPER| POWER(2,SR.YEAR_SEM -1),  B.QUALIFYING_PAPER & (B.QUALIFYING_PAPER ^  PowER(2, SR.YEAR_SEM - 1)) ) ,
         B.UPDATEON=GETDATE()
            FROM  STUDENT_RESULT SR
	        INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
		    ON SR.ROLL_NO=B.ROLL_NO
	         WHERE  SR.IS_PUBLISHED = 0 
			  AND   SR.IS_HISTORY = 0 
			  AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)
		
		


		/*
			WHERE  SR.COURSE_ID= @COURSE_ID 
		     AND SR.EXAM_TYPE=@EXAMTYPE 
			AND SR.SESSION=@SESSION 
			AND IS_PUBLISHED=0
			AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  SR.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
			AND ( (lEN(@ROLL_NO)=0 AND 1=1) OR  (lEN(@ROLL_NO)>1  AND  SR.ROLL_NO=@ROLL_NO )) 
		
		*/



		 

 
   
; WITH TEMP AS
 (
  SELECT A.MASTER_ID,A.ROLL_NO, SUM( TOTAL_GRADE_POINT) TOTALGP ,SUM(TOTAL_CREDIT)TOTALCR,SUM(EARNED_CREDIT)TOTALEARNCR 
 ,CONVERT(DECIMAL(16,3),SUM( TOTAL_GRADE_POINT)/SUM(TOTAL_CREDIT)) CGPA
  FROM STUDENT_RESULT A
 INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER B
 ON A.COURSE_ID=B.COURSE_ID
 INNER JOIN @TBLRESULTDATA T
 ON A.ROLL_NO=T.ROLL_NO
  WHERE   A.IS_HISTORY = 0 
  AND YEAR_SEM<=(SELECT SEM_NO FROM AGRA_MASTER.DBO.COURSE_MASTER  WHERE  COURSE_ID=T.COURSE_ID) 
  GROUP BY A.MASTER_ID,A.ROLL_NO
) 	
  
UPDATE SR SET
   CUM_TOTAL_POINT=TOTALGP
  ,CUM_TOTAL_CREDIT=TOTALCR
  ,CUM_TOTAL_EARNED_CREDIT=TOTALEARNCR
  ,SR.CGPA=B.CGPA
  FROM STUDENT_RESULT SR 
  INNER JOIN TEMP B
  ON SR.MASTER_ID=B.MASTER_ID
  AND SR.ROLL_NO=B.ROLL_NO
  WHERE SR.IS_PUBLISHED = 0 
  AND   SR.IS_HISTORY = 0 
  AND   SR.COURSE_ID=@COURSE_ID
  AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)
 
 /*------------------------UPDATE CONSOLIDATE --------------------*/

  --EXEC UPDATE_STUDENT_CONSOLIDATE @TBLRESULTDATA ,@COURSE_ID,@RESULT_TYPE_ID
  

 /*-----------------------------------END-------------------------------*/
 
 UPDATE  SR  set    FINAL_RESULT= CASE   WHEN  YEAR_SEM=6 AND SEMESTER_RESULT='PASS'   AND(B.QUALIFYING_PAPER<>63 ) THEN 'RD( QPNC )'
                                         WHEN  YEAR_SEM=6 AND SEMESTER_RESULT='PASS'   AND(B.QUALIFYING_RESEARCH<>32 ) THEN 'RD( QPNC )'
 
 
                                         WHEN  SEMESTER_RESULT='ABSENT'   THEN 'ABSENT'
				                         WHEN  SEMESTER_RESULT='RD( MW )'    THEN  'RD( MW )'
										 WHEN  SEMESTER_RESULT='RD( UFM )'   THEN  'RD( UFM )'
										 WHEN  SEMESTER_RESULT='FAIL'   THEN   'PROMOTED WITH BACK'

										 WHEN  YEAR_SEM=1 AND SEMESTER_RESULT='PASS' THEN'PASS'
										 /*-----------------------PROMOTED BACK-------------------*/

										 WHEN YEAR_SEM=2 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-2)=0) 
										       OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'
										 
                                        
										 WHEN YEAR_SEM=3 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-3)=0) 
										       OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'


										   WHEN YEAR_SEM=4 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-4)=0) 
										       OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'


										  
										   WHEN YEAR_SEM=5 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-4)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-5)=0) 
										         OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'


										     WHEN YEAR_SEM=6 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-4)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-5)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-6)=0) 
										         OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										      THEN  'PROMOTED WITH BACK'



										  /*--------------------------------------------------------------------*/

						                 WHEN  YEAR_SEM=2 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-2)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=1)  AND   MINOR_I_YEAR='PASS' AND (B.EARN_CREDIT_1+ B.EARN_CREDIT_2 ) IN(46,48)  )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
		                         
								 
								         WHEN  YEAR_SEM=3 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=4   and b.RESULTSTATUS & POWER(2,SEM_NO-2)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=4 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-3)=1) AND (B.EARN_CREDIT_3 ) IN(21,25,27)  )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
								 
							         	 WHEN YEAR_SEM=4 AND SEMESTER_RESULT ='PASS'   AND((b.RESULTSTATUS & POWER(2,SEM_NO-1)=8 and  b.RESULTSTATUS & POWER(2,SEM_NO-2)=4  and  b.RESULTSTATUS & POWER(2,SEM_NO-3)=2 and  b.RESULTSTATUS & POWER(2,SEM_NO-4)=1 ) AND  ( B.MINOR_II_YEAR IS NULL  or    ( B.MINOR_II_YEAR IS NOT NULL AND   MINOR_II_YEAR<>'PASS') ))  
										 THEN 'RD( MNNC )'

								 
								         WHEN  YEAR_SEM=4 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=8  and b.RESULTSTATUS & POWER(2,SEM_NO-2)=4 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-4)=1 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=4 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-3)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-4)=1)  AND   MINOR_II_YEAR='PASS' AND (B.EARN_CREDIT_3+ B.EARN_CREDIT_4 ) IN(46,48) )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'

                                     	 WHEN  YEAR_SEM=5 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=16  and b.RESULTSTATUS & POWER(2,SEM_NO-2)=8 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=4 and b.RESULTSTATUS & POWER(2,SEM_NO-4)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-5)=1 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=16 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-3)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-4)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-5)=1)  AND  (B.EARN_CREDIT_5 ) IN(20)  )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
                                       
									    WHEN YEAR_SEM=6 AND   (B.RESULTSTATUS=63 AND B.QUALIFYING_PAPER=63 AND QUALIFYING_RESEARCH=32 AND (( B.MINOR_I_YEAR is not null  and   B.MINOR_I_YEAR='PASS') AND (  B.MINOR_II_YEAR is not null AND  MINOR_II_YEAR='PASS')) AND (B.EARN_CREDIT_1+ B.EARN_CREDIT_2+B.EARN_CREDIT_3+ B.EARN_CREDIT_4 +B.EARN_CREDIT_5+ B.EARN_CREDIT_6)>=132  )
										 AND CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
										 THEN  'PASS' 
								 
								 END 
    
							 FROM STUDENT_RESULT SR   
							  INNER JOIN @TBLRESULTDATA T
							  ON SR.RESULT_ID=T.RESULT_ID
							  INNER JOIN 
						      CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
						      ON  SR.ROLL_NO=B.ROLL_NO
	                          WHERE IS_PUBLISHED=0 
						      AND IS_HISTORY=0
								







/*-----------------------------------------DIVISION -----------------------------------*/



/*----------------------------------------------------------------------------------*/


 /*----------------SET FINAL RESULT IMW PMW------------------------*/
  EXEC SET_IMW_PMW @TBLRESULTDATA,@COURSE_ID

/*------------------------------------------------------------------*/

/*;WITH TEMPRESULT As 
(
     select SM.MASTER_ID,SM.RESULT_ID,SM.COURSE_ID,SM.YEAR_SEM,SM.EXAM_TYPE,
	 COUNT( CASE WHEN SM.THEORY_OBT IS NULL AND SM.PAPER_STATUS='MW'  AND PM.PAPER_TYPE='T'  THEN 1 ELSE NULL END)MW,
	 COUNT( CASE WHEN (SM.INTERNAL_OBT IS NULL AND SM.PAPER_STATUS='MW' AND SM.INTERNAL_MAX IS NOT NULL)
	  OR (SM.THEORY_OBT IS NULL AND SM.PAPER_STATUS='MW' AND PM.PAPER_TYPE_CAT IN('V','R'))
     THEN 1 ELSE NULL END) IMW,
	 COUNT( CASE WHEN SM.THEORY_OBT IS NULL AND SM.PAPER_STATUS='MW' AND PM.PAPER_TYPE IN('P') THEN 1 ELSE NULL END) PMW
	 FROM STUDENT_MARKS SM
     INNER JOIN @TBLRESULTDATA SR
		     ON SR.RESULT_ID=SM.RESULT_ID
		    AND SR.MASTER_ID=SM.MASTER_ID
	 INNER JOIN dbo.PAPER_MASTER  PM
	    ON  PM.PAPER_CODE_PK=SM.PAPER_CODE 
		   AND SM.COURSE_ID= @COURSE_ID
	    GROUP BY SM.MASTER_ID,SM.RESULT_ID,SM.COURSE_ID,SM.YEAR_SEM,SM.EXAM_TYPE
	 )

	  
	 UPDATE SR SET SR.FINAL_RESULT =
	  IIF( SM.PMW>0,'RD( PMW )', IIF( SM.IMW >0, 'RD( IMW )', IIF( SM.MW >0, 'RD( MW )',NULL   )))
	  FROM  TEMPRESULT SM  
	 INNER JOIN STUDENT_RESULT SR
		     ON SR.RESULT_ID=SM.RESULT_ID
		    AND SR.MASTER_ID=SM.MASTER_ID
     INNER JOIN
	  @TBLRESULTDATA T 
	     ON T.RESULT_ID=SR.RESULT_ID  
	     AND T.COURSE_ID=SR.COURSE_ID
	     WHERE SR.COURSE_ID=@COURSE_ID    
	     AND SR.SEMESTER_RESULT='RD( MW )'
	     AND SR.IS_PUBLISHED=0
	     AND SR.IS_HISTORY=0
	 
	 */



	   /*----------UPDATE PUBLISHED STATUS 0-FOR WAITING FOR EXECUTE, 1-EXECUTED ,2-LIVE------*/
	   
		UPDATE  SR SET SR.IS_PUBLISHED=1,PUBLISH_DATE=GETDATE(),LAST_ORDINANCE_RUN_AT=GETDATE(),IS_LIVE=0
		    FROM STUDENT_RESULT SR
		    INNER JOIN @TBLRESULTDATA T
			ON SR.RESULT_ID=T.RESULT_ID
			AND SR.COURSE_ID=T.COURSE_ID
			WHERE SR.IS_PUBLISHED=0
			AND SR.IS_HISTORY=0
GO
/****** Object:  StoredProcedure [dbo].[ORDINANCE_MARK_SYS]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 CREATE PROC [dbo].[ORDINANCE_MARK_SYS] 
 (
  @PREPARERESULTDATA   RESULT_USERS_TBLTYPE  READONLY 
 ,@COURSE_ID INT =111
 ,@RESULT_TYPE_ID INT 

)

AS
 
--DECLARE @GRACE TINYINT
DECLARE @FINAL_RESULT VARCHAR(20)
DECLARE @TBLRESULTDATA AS  RESULT_USERS_TBLTYPE  
 
  INSERT INTO @TBLRESULTDATA (MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE)
  SELECT MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE FROM @PREPARERESULTDATA 

 /*--------------------------------------------INSERT IN CONSOLIDATE --------------------*/ 
 
    INSERT INTO CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT(COURSE_ID,COURSE_NAME, A.MASTER_ID,ROLL_NO)
     SELECT  C.COURSE_ID_MAIN,D.COURSE_NAME_MAIN ,A.MASTER_ID,A.ROLL_NO    
	 FROM STUDENT_RESULT A 
	  INNER JOIN 
      @TBLRESULTDATA T 
     ON A.RESULT_ID=T.RESULT_ID
    AND A.COURSE_ID=T.COURSE_ID
    LEFT OUTER JOIN  
    CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
    ON A.ROLL_NO=B.ROLL_NO 
	INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER C ON
	C.COURSE_ID=A.COURSE_ID
    INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER_MAIN D ON
	C.COURSE_ID_MAIN=D.COURSE_ID_MAIN
    WHERE A.COURSE_ID=@COURSE_ID
	AND  B.ROLL_NO IS NULL
	  
 	/*-------------------------------------------------------------------------------------------*/

 /*---------------------------RESET RESULT DATA-----------------------------------------------*/

  
  UPDATE  R
    SET TOTAL_CREDIT=0
   ,EARNED_CREDIT=0
   ,SEMESTER_RESULT=NULL
   ,ERROR_DETAILS=NULL
   ,TOTAL_POINT=0
   ,TOTAL_GRADE_POINT=0
   ,SGPA=0
   ,TOTAL_OBT_MARKS=0 
   ,TOTAL_MAX_MARKS=0
   
 FROM STUDENT_RESULT R
    WHERE EXISTS  (SELECT 1 FROM @TBLRESULTDATA  T WHERE R.RESULT_ID=T.RESULT_ID)
  
   

 
UPDATE A SET   
         A.CREDIT= P.CREDIT                                                                  
        ,A.THEORY_MAX=OD.THEORY_MAX                                                           
        ,A.THEORY_MIN=OD.THEORY_MIN  
	    ,A.INTERNAL_MAX=OD.INTERNAL_MAX                                                       
        ,A.INTERNAL_MIN=OD.INTERNAL_MIN                                                       
        ,A.SESSIONAL_MAX =OD.SESSIONAL_MAX                                                    
        ,A.SESSIONAL_MIN =OD.SESSIONAL_MIN                                                    
        ,A.TOTAL_MAX =OD.PAPER_TOTAL_MAX 
        ,A.TOTAL_MIN =OD.PAPER_TOTAL_MIN  

        ,A.TOTAL_OBT =ISNULL( IIF((A.THEORY_OBT=-99 OR  A.THEORY_OBT=-98), 0,  A.THEORY_OBT),0) 
                                   +ISNULL( NULLIF(A.INTERNAL_OBT,-99),0) +ISNULL( NULLIF(A.SESSIONAL_OBT,-99),0) 
				  
		,THEORY_PRACT_ABSENT=IIF((A.THEORY_OBT=-99),1, 0) 
		,INTERNAL_ABSENT=IIF((A.INTERNAL_OBT=-99),1, 0) 
		,SESSIONAL_ABSENT=IIF((A.SESSIONAL_OBT=-99),1, 0) 
		,A.UFM=  IIF((A.THEORY_OBT=-98),1, 0)
		,A.THEORY_PRACT_MW= IIF((A.THEORY_OBT IS NULL ),1, 0)
		,A.INTERNAL_MW= IIF((OD.INTERNAL_CHECK=1 AND INTERNAL_OBT IS NULL) ,1, 0)
		,A.SESSIONAL_MW= IIF((OD.SESSIONAL_CHECK=1 AND SESSIONAL_OBT IS NULL) ,1, 0)
		,A.GRADE=NULL
		,A.PAPER_STATUS= CASE  
		                    WHEN  A.PAPER_NAME='NOT OPTED' AND A.SUBJECT_TYPE='MINOR' THEN 'PASS'
							WHEN ( (OD.INTERNAL_CHECK=1 AND   INTERNAL_OBT IS NOT NULL  AND    ISNULL(A.INTERNAL_OBT,0)> ISNULL(OD.INTERNAL_MAX,0) )  
							        OR 
								   (OD.INTERNAL_CHECK=0 AND   INTERNAL_OBT IS NOT NULL )  
							     ) THEN 'INT_ERR'

                            WHEN ( 
							       (OD.SESSIONAL_CHECK=1 AND  SESSIONAL_OBT IS NOT NULL  AND  ISNULL(A.SESSIONAL_OBT,0)> ISNULL(OD.SESSIONAL_MAX,0) )  
							        OR 
								   (OD.SESSIONAL_CHECK=0 AND  SESSIONAL_OBT IS NOT NULL )  
							     ) THEN 'SES_ERR'

                                 WHEN ((A.THEORY_OBT IS NOT NULL AND A.THEORY_OBT> OD.THEORY_MAX) OR (A.TOTAL_OBT IS NOT NULL AND A.TOTAL_OBT> OD.PAPER_TOTAL_MAX)  ) THEN 'MRK_ERR' 
						      

		                    ELSE NULL
					     END 
	          ,[LAST_UPDATED_AT]=GETDATE()  

   FROM [dbo].[STUDENT_MARKS] A
   INNER JOIN 
   @TBLRESULTDATA B 
   ON A.RESULT_ID=B.RESULT_ID
   AND A.COURSE_ID=B.COURSE_ID
   INNER JOIN
   AGRA_MASTER.DBO.RESULTTYPE_WISE_ORDINANCE CO 
   ON B.COURSE_ID= CO.COURSE_ID
    AND B.ORDINANCE_ID=CO.ORDINANCE_ID
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE O
   ON  B.ORDINANCE_ID =O.ORDINANCE_ID  
   
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE_DETAILS OD 
   ON O.ORDINANCE_ID=OD.ORDINANCE_ID
   INNER JOIN 
   PAPER_MASTER P 
   ON A.PAPER_CODE=P.PAPER_CODE_PK
   AND P.PAPER_TYPE_CAT=OD.PAPER_TYPE_CAT
 
  
/*-------------------------------------------CHECK VALIDATION OF DATA -------------------------------*/ 



;WITH TEMP AS
 (
SELECT  COUNT(1)TOTALPAPERCOUNT,
        COUNT( IIF(SUBJECT_TYPE = 'THEORY',1,NULL))THEORY_COUNT,
        COUNT( IIF(SUBJECT_TYPE= 'PRACTICAL',1,NULL))PRACTIAL_COUNT,
		COUNT( IIF((PAPER_STATUS = 'INT_ERR' OR PAPER_STATUS = 'MRK_ERR'  OR PAPER_STATUS = 'SES_ERR'),1,NULL))MRK_ERR,
		COUNT( IIF(SUBJECT_TYPE= 'RESEARCH',1,NULL))RESEARCH,
		SUM(IIF(SUBJECT_TYPE = 'THEORY',TOTAL_OBT,0))THEORY_MRK_TOTAL,
        SUM(IIF(SUBJECT_TYPE = 'PRACTICAL',TOTAL_OBT,0))PRACTICAL_MRK_TOTAL,
	    SUM(TOTAL_OBT )GRAND_TOTAL,
  B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  FROM [dbo].[STUDENT_MARKS] A
  INNER JOIN @TBLRESULTDATA B 
  ON A.RESULT_ID=B.RESULT_ID
  AND A.COURSE_ID=B.COURSE_ID
   GROUP BY B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  )


   UPDATE A SET SEMESTER_RESULT=IIF(ERRORDETAILS IS NULL ,NULL,'#ERROR')
  ,IS_PUBLISHED=10
  ,PUBLISH_DATE=GETDATE()
  ,ERROR_DETAILS=ERRORDETAILS
  FROM  STUDENT_RESULT A
  
  INNER JOIN (
                SELECT RESULT_ID 
				     ,CASE WHEN MRK_ERR>0 THEN 'PAPER MARK ERROR' 
				      WHEN A.TOTALPAPERCOUNT<>B.PAPER_COUNT THEN 'PAPER IS MISSING'
                      WHEN A.THEORY_COUNT<>B.MAJOR_PAPER_COUNT  THEN 'THEORY PAPER IS MISSING'
                      WHEN A.PRACTIAL_COUNT<>B.PRACTICAL_PAPER_COUNT THEN 'PRACTICAL PAPER IS MISSING'
					  WHEN A.THEORY_MRK_TOTAL>B.THEORY_MAX  THEN 'TOTAL THEORY MARKS ERROR'
                      WHEN A.PRACTICAL_MRK_TOTAL>B.PRACTICAL_MAX THEN 'TOTAL PRACTICAL MARKS ERROR'
					  WHEN  A.GRAND_TOTAL  > TOTAL_MAX THEN 'GRAND TOTAL MARKS ERROR'

                     ELSE
                      NULL  
                      END ERRORDETAILS
                FROM TEMP A  
                INNER JOIN 
                AGRA_MASTER.DBO.ORDINANCE B 
                ON  A.ORDINANCE_ID=B.ORDINANCE_ID
                
    ) AS B
  ON A.RESULT_ID=B.RESULT_ID
     WHERE A.COURSE_ID=@COURSE_ID
     AND A.IS_PUBLISHED=0
     AND  A.IS_HISTORY=0
	 and ERRORDETAILS IS NOT NULL
	 AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE A.RESULT_ID=T.RESULT_ID)

/*---------------DELETE THOSE RESUTID WHICH HAS ERROR------------------------------*/ 
---SELECT *
  

DELETE T FROM @TBLRESULTDATA T 
WHERE EXISTS ( SELECT RESULT_ID FROM STUDENT_RESULT R
                WHERE IS_PUBLISHED=10 AND T.RESULT_ID=R.RESULT_ID)

 
  /*------------------------------------------SET PAPER STATUS-----------------------------*/   
 
 UPDATE SM  SET  
 		      PAPER_STATUS=   CASE 
			                  WHEN (SM.THEORY_OBT =-99  and SM.INTERNAL_OBT=-99  ) THEN 'ABSENT' 
				              WHEN (SM.THEORY_OBT=-98  ) THEN 'UFM'
							  WHEN (SM.THEORY_OBT IS NULL OR ( (ISNULL(INTERNAL_MAX,0)>0  AND INTERNAL_OBT IS NULL) OR (ISNULL(SESSIONAL_MAX,0)>0 AND SESSIONAL_OBT IS NULL))) THEN 'MW' 
							  WHEN (SM.THEORY_OBT >0 AND SM.THEORY_OBT>=SM.THEORY_MIN AND SM.THEORY_OBT<=SM.THEORY_MAX
							        AND SM.TOTAL_OBT>0 AND SM.TOTAL_OBT>=SM.TOTAL_MIN AND SM.TOTAL_OBT<=SM.TOTAL_MAX
							  
							   and
								   ( 
									   (   ISNULL(INTERNAL_MAX,0)>0  AND  INTERNAL_OBT IS NOT NULL 
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >=0  
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >= ISNULL(SM.INTERNAL_MIN,0) 
										   AND INTERNAL_OBT <= SM.INTERNAL_MAX  
									    ) 
									   OR 
									   (ISNULL(SESSIONAL_MAX,0)=0   and 1=1)    
								    )
								  and
								   ( 
									   (   ISNULL(SESSIONAL_MAX,0)>0 AND  SESSIONAL_OBT IS NOT NULL 
										   AND ISNULL( NULLIF( SESSIONAL_OBT,-99),0) >=0  
										   AND ISNULL( NULLIF( SESSIONAL_OBT,-99),0) >= ISNULL(SM.SESSIONAL_MIN,0) 
										   AND SESSIONAL_OBT <= SM.SESSIONAL_MAX  
									    ) 
									   OR 
									   (ISNULL(SESSIONAL_MAX,0)=0  and 1=1)    
								    )

							   
								   )  
								   THEN 'PASS'

					           ELSE 
							  CASE WHEN (
							    ( TOTAL_OBT >0 AND  TOTAL_OBT< SM.TOTAL_MIN AND B.ALLOW_GRACE=1 ) and B.GRACE-(SM.TOTAL_MIN-(TOTAL_OBT)  )>=0  
								 
							   AND (
							       
								     (ISNULL(B.GRACE_APPLY_EXAM_TYPE,'0')='0' AND 1=1) 
								       OR ( 
								           (
									       GRACE_APPLY_EXAM_TYPE<>'0' 
										   AND  SM.EXAM_TYPE IN (SELECT EXAM_TYPE FROM AGRA_MASTER.[dbo].[FUN_GET_EXAMTYPE] (GRACE_APPLY_EXAM_TYPE))) 
									       )  
								      ) 
							       )
								THEN 'PASS WITH G'+CAST((SM.TOTAL_MIN-TOTAL_OBT) AS VARCHAR(15)) 
							  ELSE
							  'FAIL'
							 END
						  END 
				,LAST_UPDATED_AT= GETDATE()
						
				FROM STUDENT_MARKS SM
				INNER JOIN @TBLRESULTDATA SR
				ON SR.RESULT_ID=SM.RESULT_ID
				AND SR.MASTER_ID=SM.MASTER_ID
				INNER JOIN 
                AGRA_MASTER.DBO.ORDINANCE B 
                ON  SR.ORDINANCE_ID=B.ORDINANCE_ID

 



  

 UPDATE SR SET  TOTAL_OBT_MARKS = TOTALMARKSOBT 
               ,TOTAL_MAX_MARKS=B.TOTAL_MAX  
			   ,TOTAL_MIN_MARKS= B.TOTAL_MIN
			  
			   ,THEORY_OBT_MARKS =IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL,TOTAL_THEORY_MARKS_OBT)
               ,THEORY_MAX_MARKS= IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL,B.THEORY_MAX)
			   ,THEORY_MIN_MARKS=IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL,B.THEORY_MIN)

			   ,[PRACTICAL_MAX_MARKS] =IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL, TOTAL_PRAC_MARKS_OBT)
               ,[PRACTICAL_MIN_MARKS]= IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1, NULL,ISNULL(B.PRACTICAL_MAX,0))
               ,[PRACTICAL_OBT_MARKS]=IIF(B.ADD_PRAC_IN_TOTAL_MARKS=1,NULL,ISNULL(B.PRACTICAL_MIN,0))
			  
			  ,LAST_ORDINANCE_RUN_AT=GETDATE()
			  ,LAST_UPDATED_AT=GETDATE()
              ,SR.SEMESTER_RESULT= CASE WHEN UFMCOUNT>0    THEN 'RD( UFM )'
			                           WHEN MWCOUNT>0     THEN 'RD( MW )'
									   WHEN ERRORCOUNT>0  THEN '#ERROR'
	                                   WHEN ABSENTCOUNT=PAPERCOUNT  THEN 'ABSENT'
                                       WHEN (ABSENTCOUNT>0 or FAILCOUNT>0 OR GRACECOUNT>1 OR TOTALMARKSOBT<(B.TOTAL_MIN  )) THEN 'FAIL' 
									   WHEN (PAPER_COUNT-PASSCOUNT=1   AND  GRACECOUNT=1 AND TOTALMARKSOBT>=(B.TOTAL_MIN  )) 
									   THEN  (   SELECT PAPER_STATUS FROM STUDENT_MARKS S  
												  WHERE SR.COURSE_ID=S.COURSE_ID
												  AND SR.RESULT_ID=S.RESULT_ID
												  AND PAPER_STATUS LIKE 'PASS WITH%')
                                      
									   WHEN PASSCOUNT=B.PAPER_COUNT    THEN 'PASS'
									 

			         END 
		 




									 
       FROM STUDENT_RESULT  SR
   
   INNER JOIN (
      SELECT SM.ROLL_NO
	 ,SUM(SM.TOTAL_OBT)TOTALMARKSOBT 
	 ,SUM(IIF(PAPER_TYPE_CAT='T',SM.TOTAL_OBT,0))TOTAL_THEORY_MARKS_OBT 
	 ,SUM(IIF(PAPER_TYPE_CAT='P',SM.TOTAL_OBT,0))TOTAL_PRAC_MARKS_OBT  
	 ,SUM(SM.THEORY_MAX)THEORY_MAX 
	 ,SUM(SM.THEORY_MIN)THEORY_MIN
     ,COUNT( IIF((PAPER_STATUS='INT_ERR' OR PAPER_STATUS='MRK_ERR'),1,NULL))ERRORCOUNT
	 ,COUNT( IIF((PAPER_STATUS='UFM'),1,NULL))UFMCOUNT
	 ,COUNT(*)PAPERCOUNT
	 ,COUNT(IIF(PAPER_STATUS='MW',1,NULL))MWCOUNT
	 ,COUNT(IIF(PAPER_STATUS='PASS',1,NULL))PASSCOUNT
	 ,COUNT(IIF(PAPER_STATUS LIKE 'PASS WITH%',1,NULL))GRACECOUNT
	 ,COUNT(IIF(PAPER_STATUS='ABSENT',1,NULL))ABSENTCOUNT
	 ,COUNT(IIF(PAPER_STATUS='FAIL',1,NULL))FAILCOUNT

	 ,SM.MASTER_ID,SM.RESULT_ID
	 FROM STUDENT_MARKS SM
	 INNER JOIN @TBLRESULTDATA SR
	 ON SR.RESULT_ID=SM.RESULT_ID
	 AND SR.MASTER_ID=SM.MASTER_ID
	 INNER JOIN PAPER_MASTER PM
	 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
     GROUP BY SM.ROLL_NO,SM.MASTER_ID,SM.RESULT_ID 

 )AS A ON A.MASTER_ID=SR.MASTER_ID 
	    AND A.RESULT_ID=SR.RESULT_ID 
	    	 INNER JOIN 
     AGRA_MASTER.DBO.ORDINANCE B 
     ON  SR.ORDINANCE_ID=B.ORDINANCE_ID
	 WHERE  SR.IS_PUBLISHED = 0 
	       AND SR.IS_HISTORY=0
		   AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)


  
 
 /*------------------------UPDATE CONSOLIDATE --------------------*/

 EXEC UPDATE_STUDENT_CONSOLIDATE @TBLRESULTDATA ,@COURSE_ID,@RESULT_TYPE_ID
  

 /*-----------------------------------END-------------------------------*/
 
 UPDATE  SR  set    FINAL_RESULT= CASE   WHEN  SEMESTER_RESULT='ABSENT'   THEN 'ABSENT'
				                         WHEN  SEMESTER_RESULT='RD( MW )'    THEN  'RD( MW )'
										 WHEN  SEMESTER_RESULT='RD( UFM )'   THEN  'RD( UFM )'
										 WHEN  SEMESTER_RESULT='FAIL'   THEN   'PROMOTED WITH BACK'

										 WHEN  YEAR_SEM=1 AND SEMESTER_RESULT='PASS' THEN'PASS'
										 /*-----------------------PROMOTED BACK-------------------*/

										 WHEN YEAR_SEM=2 AND  SEMESTER_RESULT='PASS' 
										     AND  (b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-2)=0) 
										     THEN  'PROMOTED WITH BACK'
										 
                                        
										 WHEN YEAR_SEM=3 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-3)=0) 
										      ) 
										   THEN  'PROMOTED WITH BACK'


                                          WHEN YEAR_SEM=4 AND  SEMESTER_RESULT='PASS' 
										       AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-4)=0) 
										      ) 
										  THEN  'PROMOTED WITH BACK'


										  
										   WHEN YEAR_SEM=5 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-4)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-5)=0) 
										           ) 
										   THEN  'PROMOTED WITH BACK'


										     WHEN YEAR_SEM=6 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-4)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-5)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-6)=0) 
										          ) 
										       THEN  'PROMOTED WITH BACK'



										  /*--------------------------------------------------------------------*/

						                 WHEN  YEAR_SEM=2 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-2)=1   )
							              AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS		
 
										 THEN  'PASS'
		                         
								 
								         WHEN  YEAR_SEM=3 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=4   and b.RESULTSTATUS & POWER(2,SEM_NO-2)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 )
							              AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
										 THEN  'PASS'
								 
							         	 

								 
								         WHEN  YEAR_SEM=4 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=8  and b.RESULTSTATUS & POWER(2,SEM_NO-2)=4 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-4)=1 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1   )
							             AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
						                 THEN  'PASS'

                                     	 WHEN  YEAR_SEM=5 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=16  and b.RESULTSTATUS & POWER(2,SEM_NO-2)=8 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=4 and b.RESULTSTATUS & POWER(2,SEM_NO-4)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-5)=1 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=16 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-3)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-4)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-5)=1)  AND  (B.EARN_CREDIT_5 ) IN(20)  )
							             AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
						                 THEN  'PASS'
                                       
									    WHEN YEAR_SEM=6 AND  B.RESULTSTATUS=63  
										 AND  TOTAL_MIN_MARKS<= TOTAL_OBT_MARKS and TOTAL_OBT_MARKS <=TOTAL_MAX_MARKS	
										 THEN  'PASS' 
								 
								 END 
    
							 FROM STUDENT_RESULT SR   
							  INNER JOIN @TBLRESULTDATA T
							  ON SR.RESULT_ID=T.RESULT_ID
							  INNER JOIN 
						      CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
						      ON  SR.ROLL_NO=B.ROLL_NO
	                          WHERE IS_PUBLISHED=0 
						      AND IS_HISTORY=0
								

 
/*-----------------------------------------DIVISION -----------------------------------*/







/*----------------------------------------------------------------------------------*/


 /*----------------SET FINAL RESULT IMW PMW------------------------*/
  EXEC SET_IMW_PMW @TBLRESULTDATA,@COURSE_ID

/*------------------------------------------------------------------*/

 
	   /*----------UPDATE PUBLISHED STATUS 0-FOR WAITING FOR EXECUTE, 1-EXECUTED ,2-LIVE------*/
	   
		UPDATE  SR SET SR.IS_PUBLISHED=1,PUBLISH_DATE=GETDATE(),LAST_ORDINANCE_RUN_AT=GETDATE(),IS_LIVE=0
		    FROM STUDENT_RESULT SR
		    INNER JOIN @TBLRESULTDATA T
			ON SR.RESULT_ID=T.RESULT_ID
			AND SR.COURSE_ID=T.COURSE_ID
			WHERE SR.IS_PUBLISHED=0
			AND SR.IS_HISTORY=0
 
GO
/****** Object:  StoredProcedure [dbo].[ORDINANCE_NEP_PG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 


CREATE PROC [dbo].[ORDINANCE_NEP_PG] 
 (
  @PREPARERESULTDATA   RESULT_USERS_TBLTYPE  READONLY 
 ,@COURSE_ID INT =230
 ,@RESULT_TYPE_ID INT 

)

AS

DECLARE @POINT  INT =0
DECLARE @PAPER_RESULT VARCHAR(80)
DECLARE @FINAL_RESULT VARCHAR(20)
DECLARE @EarnCR INT =0
DECLARE @GRADE_POINT  VARCHAR(20)
DECLARE @TBLRESULTDATA AS  RESULT_USERS_TBLTYPE  
 
   INSERT INTO @TBLRESULTDATA (MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE)
  SELECT MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE FROM @PREPARERESULTDATA 

/*--------------------------------------------INSERT IN CONSOLIDATE --------------------*/ 
 
    INSERT INTO CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT(COURSE_ID,COURSE_NAME, A.MASTER_ID,ROLL_NO)
     SELECT  C.COURSE_ID_MAIN,D.COURSE_NAME_MAIN ,A.MASTER_ID,A.ROLL_NO    
	 FROM STUDENT_RESULT A 
	  INNER JOIN 
      @TBLRESULTDATA T 
     ON A.RESULT_ID=T.RESULT_ID
    AND A.COURSE_ID=T.COURSE_ID
    LEFT OUTER JOIN  
    CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
    ON A.ROLL_NO=B.ROLL_NO 
	INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER C ON
	C.COURSE_ID=A.COURSE_ID
    INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER_MAIN D ON
	C.COURSE_ID_MAIN=D.COURSE_ID_MAIN
    WHERE A.COURSE_ID=@COURSE_ID
	AND  B.ROLL_NO IS NULL
	  
 	/*-------------------------------------------------------------------------------------------*/


 /*---------------------------RESET RESULT DATA-----------------------------------------------*/

 UPDATE  R
   SET TOTAL_CREDIT=0
   ,EARNED_CREDIT=0
   ,SEMESTER_RESULT=NULL
   ,ERROR_DETAILS=NULL
   ,TOTAL_POINT=0
   ,TOTAL_GRADE_POINT=0
   ,SGPA=0
   ,TOTAL_OBT_MARKS=0 
   FROM STUDENT_RESULT R
    WHERE EXISTS  (SELECT 1 FROM @TBLRESULTDATA  T WHERE R.RESULT_ID=T.RESULT_ID)
  
 
 
 
UPDATE A SET   
         A.CREDIT= P.CREDIT                                                                  
        ,A.THEORY_MAX=OD.THEORY_MAX                                                           
        ,A.THEORY_MIN=OD.THEORY_MIN  
	    ,A.INTERNAL_MAX=OD.INTERNAL_MAX                                                       
        ,A.INTERNAL_MIN=OD.INTERNAL_MIN                                                       
        ,A.SESSIONAL_MAX =OD.SESSIONAL_MAX                                                    
        ,A.SESSIONAL_MIN =OD.SESSIONAL_MIN                                                    
        ,A.TOTAL_MAX =OD.PAPER_TOTAL_MAX 
        ,A.TOTAL_MIN =OD.PAPER_TOTAL_MIN  
        ,A.TOTAL_OBT =ISNULL( IIF((A.THEORY_OBT=-99 OR  A.THEORY_OBT=-98), 0,  A.THEORY_OBT),0) 
                                   +ISNULL( NULLIF(A.INTERNAL_OBT,-99),0) +ISNULL( NULLIF(A.SESSIONAL_OBT,-99),0) 
				  
		,THEORY_PRACT_ABSENT=IIF((A.THEORY_OBT=-99),1, 0) 
		,INTERNAL_ABSENT=IIF((A.INTERNAL_OBT=-99),1, 0) 
		,SESSIONAL_ABSENT=IIF((A.SESSIONAL_OBT=-99),1, 0) 
		,A.UFM=  IIF((A.THEORY_OBT=-98),1, 0)
		,A.THEORY_PRACT_MW= IIF((A.THEORY_OBT IS NULL ),1, 0)
		,A.INTERNAL_MW= IIF((OD.INTERNAL_CHECK=1 AND INTERNAL_OBT IS NULL) ,1, 0)
		,A.SESSIONAL_MW= IIF((OD.SESSIONAL_CHECK=1 AND SESSIONAL_OBT IS NULL) ,1, 0)
		,A.GRADE=NULL
		,A.PAPER_STATUS= CASE  
		                    WHEN  A.PAPER_NAME='NOT OPTED' AND A.SUBJECT_TYPE='MINOR' THEN 'PASS'
							WHEN (OD.INTERNAL_MAX IS NOT  NULL AND   INTERNAL_OBT IS NOT NULL  AND    ISNULL(A.INTERNAL_OBT,0)> ISNULL(OD.INTERNAL_MAX,0) )   THEN 'INT_ERR'
							WHEN ((A.THEORY_OBT IS NOT NULL AND A.THEORY_OBT> OD.THEORY_MAX) ) THEN 'MRK_ERR' 
							       

		                    ELSE NULL
					     END 
	          ,[LAST_UPDATED_AT]=GETDATE()  

   FROM [dbo].[STUDENT_MARKS] A
   INNER JOIN 
   @TBLRESULTDATA B 
   ON A.RESULT_ID=B.RESULT_ID
   AND A.COURSE_ID=B.COURSE_ID
   INNER JOIN
   AGRA_MASTER.DBO.RESULTTYPE_WISE_ORDINANCE CO 
   ON B.COURSE_ID= CO.COURSE_ID
    AND B.ORDINANCE_ID=CO.ORDINANCE_ID
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE O
   ON  B.ORDINANCE_ID =O.ORDINANCE_ID  
   
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE_DETAILS OD 
   ON O.ORDINANCE_ID=OD.ORDINANCE_ID
   INNER JOIN 
   PAPER_MASTER P 
   ON A.PAPER_CODE=P.PAPER_CODE_PK
   AND P.PAPER_TYPE_CAT=OD.PAPER_TYPE_CAT
  
/*-------------------------------------------CHECK VALIDATION OF DATA -------------------------------*/ 

 

;WITH TEMP AS
 (
SELECT  COUNT( IIF(SUBJECT_TYPE IN('THEORY','PRACTICAL'),SUBJECT_TYPE,NULL))MAJORCOUNT,
        COUNT( IIF(SUBJECT_TYPE = 'MINOR',1,NULL))MINORCOUNT,
        COUNT( IIF(SUBJECT_TYPE= 'RESEARCH',1,NULL))RESEARCHCOUNT,
		COUNT( IIF((PAPER_STATUS ='INT_ERR' OR PAPER_STATUS = 'MRK_ERR' ),1,NULL))MRK_ERR,
        SUM(IIF(SUBJECT_TYPE IN( 'THEORY','PRACTICAL'),CREDIT,0))MAJORCR,
        SUM(IIF(SUBJECT_TYPE = 'MINOR',CREDIT,0))MINORCR,
        SUM(IIF(SUBJECT_TYPE = 'RESEARCH',CREDIT,0))RESEARCHCR,
		
  B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID,YEAR_SEM 
  FROM [dbo].[STUDENT_MARKS] A
  INNER JOIN @TBLRESULTDATA B 
  ON A.RESULT_ID=B.RESULT_ID
  AND A.COURSE_ID=B.COURSE_ID
  GROUP BY B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID,YEAR_SEM 
  )

 
   UPDATE A SET SEMESTER_RESULT=IIF(ERRORDETAILS IS NULL ,NULL,'#ERROR')
  ,IS_PUBLISHED=10
  ,PUBLISH_DATE=GETDATE()
  ,ERROR_DETAILS=ERRORDETAILS
  FROM  STUDENT_RESULT A
   INNER JOIN (
                SELECT RESULT_ID 
				     ,CASE WHEN MRK_ERR>0 THEN 'PAPER MARK ERROR' 
				      WHEN A.MAJORCOUNT<>B.MAJOR_PAPER_COUNT THEN 'THEORY PAPER IS MISSING'
                      WHEN A.RESEARCHCOUNT<>B.RESEARCH_PAPER_COUNT THEN 'RESEARCH PAPER IS MISSING'
                      WHEN A.MAJORCR<>B.TOTAL_MAJOR_CR THEN 'THEORY PAPER CREDIT IS WRONG'

                      WHEN YEAR_SEM IN(1,2)  
					   AND (   
					             (MINORCR=0 AND(MAJORCR<>20)) OR 
						         (  
								 (A.MINORCR>0 AND A.MINORCR<4)
								 OR (MINORCR>0 AND RESEARCHCR=0 AND MINORCR=4 AND    MAJORCR+MINORCR<>24 ) 
								 OR ( MINORCR>0 AND RESEARCHCR=0 AND MINORCR=5 AND   MAJORCR+MINORCR<>25 )
								 OR ( MINORCR>0 AND RESEARCHCR=0 AND MINORCR=6 AND   MAJORCR+MINORCR<>26 )
								 
								 )
								  OR 
								  (  
							   
								  (
								   (MINORCR>0 AND RESEARCHCR=4 AND MINORCR=4  AND ( MAJORCR+MINORCR+RESEARCHCR<>28 ))
								    OR 
								   (MINORCR>0 AND RESEARCHCR=8 AND MINORCR=4  AND ( MAJORCR+MINORCR+RESEARCHCR<>32 ))
								  )
						          OR 
								  (
								   (MINORCR>0 AND RESEARCHCR=4 AND MINORCR=5  AND ( MAJORCR+MINORCR+RESEARCHCR<>29 ))
								   OR 
								   (MINORCR>0 AND RESEARCHCR=8 AND MINORCR=5  AND ( MAJORCR+MINORCR+RESEARCHCR<>33 ))
								  )
                                  OR 
								  (
								  
								   (MINORCR>0 AND RESEARCHCR=4 AND MINORCR=6  AND ( MAJORCR+MINORCR+RESEARCHCR<>30 ))
								   OR 
								   (MINORCR>0 AND RESEARCHCR=8 AND MINORCR=6  AND ( MAJORCR+MINORCR+RESEARCHCR<>34 ))
								   )
								)
						       OR (MINORCR=0 AND RESEARCHCR>0 AND RESEARCHCR=4 AND ( MAJORCR+RESEARCHCR<>24 ))
							   OR (MINORCR=0 AND RESEARCHCR>0 AND RESEARCHCR=8 AND ( MAJORCR+RESEARCHCR<>28 ))
					          )
							  
					 
					   THEN  'PAPER CREDIT IS WRONG'
					   WHEN YEAR_SEM IN(3,4)  
					   AND     
					    MAJORCR <> 20  OR (RESEARCHCR>0   AND ( MAJORCR+ RESEARCHCR<>24 AND  MAJORCR +RESEARCHCR<>28 ))
						THEN   'PAPER CREDIT IS WRONG'

                      ELSE
                      NULL  
                      END ERRORDETAILS
                FROM TEMP A  
                INNER JOIN 
                AGRA_MASTER.DBO.ORDINANCE B 
                ON  A.ORDINANCE_ID=B.ORDINANCE_ID
              


   ) AS B
  ON A.RESULT_ID=B.RESULT_ID
     WHERE A.COURSE_ID=@COURSE_ID
     AND   A.IS_PUBLISHED=0
     AND   A.IS_HISTORY=0
	 AND   B.ERRORDETAILS IS NOT NULL
	 AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE A.RESULT_ID=T.RESULT_ID)





/*---------------DELETE THOSE RESUTID WHICH HAS ERROR------------------------------*/ 
 --SELECT *

 
 DELETE T
FROM @TBLRESULTDATA T 
WHERE EXISTS ( SELECT RESULT_ID FROM STUDENT_RESULT R
                WHERE IS_PUBLISHED=10 AND T.RESULT_ID=R.RESULT_ID)


  
    
  /*------------------------------------------SET PAPER STATUS-----------------------------*/   
 
 UPDATE SM  SET  
 		      PAPER_STATUS=   CASE 
			                  WHEN (SM.THEORY_OBT =-99  and SM.INTERNAL_OBT=-99  ) THEN 'ABSENT' 
				              WHEN ( SM.THEORY_OBT=-98  ) THEN 'UFM'
							  WHEN (SM.THEORY_OBT IS NULL OR (INTERNAL_MAX IS NOT NULL AND INTERNAL_OBT IS NULL)) THEN 'MW' 
							  WHEN (SM.THEORY_OBT >0 AND SM.THEORY_OBT>=SM.THEORY_MIN AND SM.THEORY_OBT<=SM.THEORY_MAX
							        AND SM.TOTAL_OBT>0 AND SM.TOTAL_OBT>=SM.TOTAL_MIN AND SM.TOTAL_OBT<=SM.TOTAL_MAX
							  
							   and
								   ( 
									   (   INTERNAL_MAX IS NOT NULL  AND  INTERNAL_OBT IS NOT NULL 
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >=0  
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >= ISNULL(SM.INTERNAL_MIN,0) 
										   AND INTERNAL_OBT <= SM.INTERNAL_MAX  
									    ) 
									   OR 
									   (INTERNAL_MAX IS  NULL  and 1=1)    
								   
								   
								   )
								  

							   
								   )  
								   THEN 'PASS'

					           ELSE 'FAIL' 
							END 
				,LAST_UPDATED_AT= GETDATE()
						
				FROM STUDENT_MARKS SM
				 INNER JOIN @TBLRESULTDATA SR
				 ON SR.RESULT_ID=SM.RESULT_ID
				 AND SR.MASTER_ID=SM.MASTER_ID

				  
 

 /*--------------------SET CREDIT --------------------------------------------------------------*/

  
 UPDATE SM SET @POINT=  (SELECT VALUE FROM  (SELECT  ROW_NUMBER()OVER(ORDER BY VALUE)RW, VALUE  FROM  STRING_SPLIT(  dbo.GET_GRADE_POINT(SR.RESULT_TYPE,SM.TOTAL_OBT*100/FLOOR(PM.TOTAL_MAX)),','))AS A WHERE RW=1)  
			  ,Point=@POINT
			 ,@EarnCR =IIF( SM.PAPER_STATUS ='PASS', PM.CREDIT  ,0 )
			 ,SM.EARNED_CREDIT=@EarnCR
		     ,SM.GRADE_POINT= @POINT*@EarnCR
			 ,Grade=  CASE 
					  WHEN SM.PAPER_STATUS LIKE '%ERR' THEN ''
					  WHEN SM.PAPER_STATUS='ABSENT' THEN 'AB' WHEN SM.PAPER_STATUS='FAIL' THEN 'F' WHEN SM.PAPER_STATUS='UFM' THEN 'U' 
			          ELSE (SELECT VALUE FROM  (SELECT  ROW_NUMBER()OVER(ORDER BY VALUE)RW, VALUE  FROM  STRING_SPLIT( dbo.GET_GRADE_POINT(SR.RESULT_TYPE, SM.TOTAL_OBT *100/FLOOR(PM.TOTAL_MAX)),','))AS A WHERE RW=2) 
					  END 
			   
                 FROM STUDENT_MARKS SM
				 INNER JOIN @TBLRESULTDATA SR
				 ON SR.RESULT_ID=SM.RESULT_ID
				 AND SR.MASTER_ID=SM.MASTER_ID
				 INNER JOIN PAPER_MASTER PM
				 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
				 
 

 UPDATE SR SET SR.TOTAL_CREDIT=A.TOTALCREDIT
              ,SR.EARNED_CREDIT =A.TOTALEARNCREDIT
			  ,SR.TOTAL_MAJOR_CREDIT=TOTALMAJORCREDIT
			  ,SR.TOTAL_MAJOR_EARN_CREDIT=TOTALMAJOREARNCREDIT
			  ,SR.TOTAL_POINT=A.TOTALPOINT 
	          ,SR.TOTAL_GRADE_POINT=GRADEPOINT
	          ,TOTAL_OBT_MARKS =TOTALMARKSOBT
			  ,TOTAL_MAX_MARKS=THEORY_MAX
			  ,TOTAL_MIN_MARKS=THEORY_MIN
			  ,SR.SGPA= CASE 
			               WHEN A.TOTALCREDIT>0 THEN  CONVERT(DECIMAL(7,3),ROUND( A.GRADEPOINT/CONVERT( DECIMAL(7,3),A.TOTALCREDIT),3,1)) ELSE 0 
			        	END  

             ,LAST_ORDINANCE_RUN_AT=GETDATE()
			 ,LAST_UPDATED_AT=GETDATE()
             ,SR.SEMESTER_RESULT= CASE WHEN UFMCOUNT>0    THEN 'RD( UFM )'
			                           WHEN MWCOUNT>0     THEN 'RD( MW )'
									   WHEN ERRORCOUNT>0  THEN '#ERROR'
	                                   WHEN ABSENTCOUNT=PAPERCOUNT  THEN 'ABSENT'
			                           WHEN (ABSENTCOUNT>0 or FAILCOUNT>0 ) THEN 'FAIL' 
									   WHEN PASSCOUNT=PAPERCOUNT    THEN 'PASS'
									 
									 END 
       FROM STUDENT_RESULT  SR
   
   INNER JOIN (
      SELECT SM.ROLL_NO
	 ,SUM(SM.CREDIT )TOTALCREDIT
	 ,SUM(SM.EARNED_CREDIT )TOTALEARNCREDIT
	 ,SUM(IIF(SM.SUBJECT_TYPE IN( 'THEORY','PRACTICAL') ,SM.CREDIT,0  ) )TOTALMAJORCREDIT
	 ,SUM(IIF(SM.SUBJECT_TYPE IN( 'THEORY','PRACTICAL') ,SM.EARNED_CREDIT,0  ) )TOTALMAJOREARNCREDIT
     ,SUM(SM.POINT)TOTALPOINT
	 ,SUM(SM.GRADE_POINT ) GRADEPOINT 
	 ,SUM(SM.TOTAL_OBT)TOTALMARKSOBT 
	 ,SUM( SM.TOTAL_MAX)THEORY_MAX
	 ,SUM( SM.TOTAL_MIN )THEORY_MIN 
     ,COUNT( IIF((PAPER_STATUS='INT_ERR' OR PAPER_STATUS='MRK_ERR'),1,NULL))ERRORCOUNT
	 ,COUNT( IIF((PAPER_STATUS='UFM'),1,NULL))UFMCOUNT
	 ,COUNT(1)PAPERCOUNT
	-- ,COUNT(IIF(SM.SUBJECT_TYPE IN( 'THEORY') ,1,NULL ))THEORY_COUNT
	-- ,COUNT(IIF(SM.SUBJECT_TYPE IN( 'MINOR') ,1,NULL ))MINOR_COUNT
	 ,COUNT( IIF(PAPER_STATUS='MW',1,NULL))MWCOUNT
	 ,COUNT( IIF(PAPER_STATUS='PASS',1,NULL))PASSCOUNT
	 ,COUNT( IIF(PAPER_STATUS='ABSENT',1,NULL))ABSENTCOUNT
	 ,COUNT( IIF(PAPER_STATUS='FAIL',1,NULL))FAILCOUNT
	 ,SM.MASTER_ID,SM.RESULT_ID
	 FROM STUDENT_MARKS SM
	 INNER JOIN @TBLRESULTDATA SR
	 ON SR.RESULT_ID=SM.RESULT_ID
	 AND SR.MASTER_ID=SM.MASTER_ID
	 INNER JOIN PAPER_MASTER PM
	 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
     GROUP BY SM.ROLL_NO,SM.MASTER_ID,SM.RESULT_ID 

 )AS A ON A.MASTER_ID=SR.MASTER_ID 
	    AND A.RESULT_ID=SR.RESULT_ID 
	    
	 WHERE  SR.IS_PUBLISHED = 0 
	       AND SR.IS_HISTORY=0
		   AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)

 
 
   
; WITH TEMP AS
 (
  SELECT A.MASTER_ID,A.ROLL_NO, SUM( TOTAL_GRADE_POINT) TOTALGP ,SUM(TOTAL_CREDIT)TOTALCR,SUM(EARNED_CREDIT)TOTALEARNCR 
 ,CONVERT(DECIMAL(16,3),SUM( TOTAL_GRADE_POINT)/SUM(TOTAL_CREDIT)) CGPA
  FROM STUDENT_RESULT A
 INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER B
 ON A.COURSE_ID=B.COURSE_ID
 INNER JOIN @TBLRESULTDATA T
 ON A.ROLL_NO=T.ROLL_NO
  WHERE   A.IS_HISTORY = 0 
  AND YEAR_SEM<=(SELECT SEM_NO FROM AGRA_MASTER.DBO.COURSE_MASTER  WHERE  COURSE_ID=T.COURSE_ID) 
  GROUP BY A.MASTER_ID,A.ROLL_NO
) 	
  
UPDATE SR SET
   CUM_TOTAL_POINT=TOTALGP
  ,CUM_TOTAL_CREDIT=TOTALCR
  ,CUM_TOTAL_EARNED_CREDIT=TOTALEARNCR
  ,SR.CGPA=B.CGPA
  FROM STUDENT_RESULT SR 
  INNER JOIN TEMP B
  ON SR.MASTER_ID=B.MASTER_ID
  AND SR.ROLL_NO=B.ROLL_NO
  WHERE SR.IS_PUBLISHED = 0 
  AND   SR.IS_HISTORY = 0 
  AND   SR.COURSE_ID=@COURSE_ID
  AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)
 

 /*---------------------------UPDATE CUMALETIVE IN ALL SEMESTER--------------------*/

  ;WITH RESULTID_WITH_COURSEID AS
   (    
   select A.*,C.COURSE_ID_MAIN 
   from  @TBLRESULTDATA A
   INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C
   ON A.COURSE_ID=C.COURSE_ID
   AND LEFT(ROLL_NO,2)>22
 
   )
   ,TEMP2 AS 
    (
    SELECT  A.COURSE_ID,  A.ROLL_NO, A.RESULT_ID,YEAR_SEM,TOTAL_CREDIT,TOTAL_GRADE_POINT,
    SUM(TOTAL_CREDIT)OVER(PARTITION BY A.MASTER_ID ORDER BY YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS CUMCREDIT 
   ,SUM(EARNED_CREDIT)OVER(PARTITION BY A.MASTER_ID ORDER BY YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS CUMEARNCREDIT
   ,SUM(TOTAL_GRADE_POINT)OVER(PARTITION BY A.MASTER_ID ORDER BY YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS CUMGRADEPOINT
   ,CONVERT(DECIMAL(7,2),
   SUM(ISNULL(A.SGPA,0) * ISNULL(A.TOTAL_CREDIT,0))OVER(PARTITION BY A.MASTER_ID ORDER BY A.YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)
    / CAST(SUM(ISNULL(A.TOTAL_CREDIT,0))OVER(PARTITION BY A.MASTER_ID ORDER BY A.YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS DECIMAL(7,2)
    )
) AS CUM_SGPA
    FROM STUDENT_RESULT A
    INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C
    ON A.COURSE_ID=C.COURSE_ID
    INNER JOIN RESULTID_WITH_COURSEID B
    ON A.MASTER_ID=B.MASTER_ID
    AND B.COURSE_ID_MAIN=C.COURSE_ID_MAIN
    AND IS_HISTORY=0
   )
  --SELECT A.*,B.CUM_TOTAL_CREDIT,B.CUM_TOTAL_EARNED_CREDIT,B.CUM_TOTAL_GRADE_POINT ,B.CGPA
  UPDATE B SET B.CUM_TOTAL_CREDIT=CUMCREDIT
  ,B.CUM_TOTAL_EARNED_CREDIT=CUMEARNCREDIT
  ,B.CUM_TOTAL_GRADE_POINT=CUMGRADEPOINT
  ,B.CGPA=CUM_SGPA
  ,B.IS_PUBLISHED=1
  ,B.PUBLISH_DATE=GETDATE()
  ,B.IS_LIVE=0
  FROM TEMP2 A
  INNER JOIN STUDENT_RESULT B
  ON A.COURSE_ID=B.COURSE_ID
  AND A.RESULT_ID=B.RESULT_ID
 /*-------------------------------------------------------------------------------*/

 /*------------------------UPDATE CONSOLIDATE --------------------*/

 EXEC UPDATE_STUDENT_CONSOLIDATE @TBLRESULTDATA ,@COURSE_ID,@RESULT_TYPE_ID
  

 /*-----------------------------------END-------------------------------*/
  

 UPDATE  SR  set    FINAL_RESULT= CASE   WHEN  SEMESTER_RESULT='ABSENT'   THEN 'ABSENT'
				                         WHEN  SEMESTER_RESULT='RD( MW )'    THEN  'RD( MW )'
										 WHEN  SEMESTER_RESULT='RD( UFM )'   THEN  'RD( UFM )'
										 WHEN  SEMESTER_RESULT='FAIL'   THEN   'PROMOTED WITH BACK'
                                         WHEN  YEAR_SEM=1 AND SEMESTER_RESULT='PASS' THEN'PASS'
										 /*-----------------------PROMOTED BACK-------------------*/

										 WHEN YEAR_SEM=2 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-2)=0) 
										     OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										     THEN  'PROMOTED WITH BACK'
										 
                                        
										 WHEN YEAR_SEM=3 AND  SEMESTER_RESULT='PASS' 
										       AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-3)=0) 
										       OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       THEN  'PROMOTED WITH BACK'


										   WHEN YEAR_SEM=4 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-4)=0) 
										     OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										     THEN  'PROMOTED WITH BACK'


										 

										  /*--------------------------------------------------------------------*/

						                 WHEN  YEAR_SEM=2 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-2)=1  AND   MINOR_I_YEAR='PASS' AND (B.EARN_CREDIT_1+ B.EARN_CREDIT_2 ) >=52   )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
		                         
								     
								         WHEN  YEAR_SEM=3 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=4   and b.RESULTSTATUS & POWER(2,SEM_NO-2)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1  AND (B.EARN_CREDIT_3 )>=20 )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
								 
								       	
										  WHEN  YEAR_SEM=4 AND SEMESTER_RESULT='PASS'   AND(B.RESULTSTATUS=15 AND ((B.MINOR_I_YEAR IS NULL OR  B.MINOR_I_YEAR='FAIL')  ))  
										 THEN 'RD( MNNC )'
								 

								         WHEN  YEAR_SEM=4 AND  (B.RESULTSTATUS=15   AND  ( B.MINOR_I_YEAR is not null  and   B.MINOR_I_YEAR='PASS')  AND (B.EARN_CREDIT_1+ B.EARN_CREDIT_2+B.EARN_CREDIT_3+ B.EARN_CREDIT_4 )>=100  )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'

                                     	  

								 
								 END 
    
							 FROM STUDENT_RESULT SR   
							  INNER JOIN @TBLRESULTDATA T
							  ON SR.RESULT_ID=T.RESULT_ID
							  INNER JOIN 
						      CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
						      ON  SR.ROLL_NO=B.ROLL_NO
	                          WHERE IS_PUBLISHED=0 
						      AND IS_HISTORY=0
								

 


 

/*-----------------------------------------DIVISION -----------------------------------*/



/*----------------------------------------------------------------------------------*/

 /*----------------SET FINAL RESULT IMW PMW------------------------*/
  EXEC SET_IMW_PMW @TBLRESULTDATA,@COURSE_ID

/*------------------------------------------------------------------*/


	   /*----------UPDATE PUBLISHED STATUS 0-FOR WAITING FOR EXECUTE, 1-EXECUTED ,2-LIVE------*/
	   
		UPDATE  SR SET SR.IS_PUBLISHED=1,PUBLISH_DATE=GETDATE(),LAST_ORDINANCE_RUN_AT=GETDATE(),IS_LIVE=0
		    FROM STUDENT_RESULT SR
		    INNER JOIN @TBLRESULTDATA T
			ON SR.RESULT_ID=T.RESULT_ID
			AND SR.COURSE_ID=T.COURSE_ID
			WHERE SR.IS_PUBLISHED=0
			AND SR.IS_HISTORY=0
 












  /* WHERE 
                (
                 A.MAJORCOUNT<>B.MAJOR_PAPER_COUNT
                 OR A.MINORCOUNT<>B.OPTIONAL_PAPER_COUNT
				 OR A.RESEARCHCOUNT<>B.RESEARCH_PAPER_COUNT
                 OR A.MAJORCR<>B.TOTAL_MAJOR_CR
                 OR(  MINORCOUNT>0 AND   YEAR_SEM IN(1,2)  
					   AND (   
					             (MINORCR=0 AND(MAJORCR<>20)) OR 
						         (  
								 (A.MINORCR>0 AND A.MINORCR<4)
								 OR (MINORCR>0 AND RESEARCHCR=0 AND MINORCR=4 AND    MAJORCR+MINORCR<>24 ) 
								 OR ( MINORCR>0 AND RESEARCHCR=0 AND MINORCR=5 AND   MAJORCR+MINORCR<>25 )
								 OR ( MINORCR>0 AND RESEARCHCR=0 AND MINORCR=6 AND   MAJORCR+MINORCR<>26 )
								 
								 )
								  OR 
								  (  
							   
								  (
								   (MINORCR>0 AND RESEARCHCR=4 AND MINORCR=4  AND ( MAJORCR+MINORCR+RESEARCHCR<>28 ))
								    OR 
								   (MINORCR>0 AND RESEARCHCR=8 AND MINORCR=4  AND ( MAJORCR+MINORCR+RESEARCHCR<>32 ))
								  )
						          OR 
								  (
								   (MINORCR>0 AND RESEARCHCR=4 AND MINORCR=5  AND ( MAJORCR+MINORCR+RESEARCHCR<>29 ))
								   OR 
								   (MINORCR>0 AND RESEARCHCR=8 AND MINORCR=5  AND ( MAJORCR+MINORCR+RESEARCHCR<>33 ))
								  )
                                  OR 
								  (
								  
								   (MINORCR>0 AND RESEARCHCR=4 AND MINORCR=6  AND ( MAJORCR+MINORCR+RESEARCHCR<>30 ))
								   OR 
								   (MINORCR>0 AND RESEARCHCR=8 AND MINORCR=6  AND ( MAJORCR+MINORCR+RESEARCHCR<>34 ))
								   )
								)
						       OR (MINORCR=0 AND RESEARCHCR>0 AND RESEARCHCR=4 AND ( MAJORCR+RESEARCHCR<>24 ))
							   OR (MINORCR=0 AND RESEARCHCR>0 AND RESEARCHCR=8 AND ( MAJORCR+RESEARCHCR<>28 ))
					          )
				 
                )
				OR(
				      YEAR_SEM IN(3,4)  
					   AND     
					    MAJORCR <> 20  OR (RESEARCHCR>0   AND ( MAJORCR+ RESEARCHCR<>24 AND  MAJORCR +RESEARCHCR<>28 ))
				)

            OR MRK_ERR>0

		)
		*/
GO
/****** Object:  StoredProcedure [dbo].[ORDINANCE_NEP_UG]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 

CREATE PROC [dbo].[ORDINANCE_NEP_UG] 
 (
  @PREPARERESULTDATA   RESULT_USERS_TBLTYPE  READONLY 
 ,@COURSE_ID INT =111
 ,@RESULT_TYPE_ID INT 

)

AS

DECLARE @POINT  INT =0
DECLARE @PAPER_RESULT VARCHAR(80)
DECLARE @FINAL_RESULT VARCHAR(20)
DECLARE @EarnCR INT =0
DECLARE @GRADE_POINT  VARCHAR(20)
DECLARE @TBLRESULTDATA AS  RESULT_USERS_TBLTYPE  
 
  INSERT INTO @TBLRESULTDATA (MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE)
  SELECT MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE FROM @PREPARERESULTDATA 



 /*--------------------------------------------INSERT IN CONSOLIDATE --------------------*/ 
 
    INSERT INTO CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT(COURSE_ID,COURSE_NAME, A.MASTER_ID,ROLL_NO)
     SELECT  C.COURSE_ID_MAIN,D.COURSE_NAME_MAIN ,A.MASTER_ID,A.ROLL_NO    
	 FROM STUDENT_RESULT A 
	  INNER JOIN 
      @TBLRESULTDATA T 
     ON A.RESULT_ID=T.RESULT_ID
    AND A.COURSE_ID=T.COURSE_ID
    LEFT OUTER JOIN  
    CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
    ON A.ROLL_NO=B.ROLL_NO 
	INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER C ON
	C.COURSE_ID=A.COURSE_ID
    INNER JOIN AGRA_MASTER.dbo.COURSE_MASTER_MAIN D ON
	C.COURSE_ID_MAIN=D.COURSE_ID_MAIN
    WHERE A.COURSE_ID=@COURSE_ID
	AND  B.ROLL_NO IS NULL
	  
 	/*-------------------------------------------------------------------------------------------*/

 /*---------------------------RESET RESULT DATA-----------------------------------------------*/

  UPDATE  R
   SET TOTAL_CREDIT=0
   ,EARNED_CREDIT=0
   ,SEMESTER_RESULT=NULL
   ,ERROR_DETAILS=NULL
   ,TOTAL_POINT=0
   ,TOTAL_GRADE_POINT=0
   ,SGPA=0
   ,TOTAL_OBT_MARKS=0 
   FROM STUDENT_RESULT R
    WHERE EXISTS  (SELECT 1 FROM @TBLRESULTDATA  T WHERE R.RESULT_ID=T.RESULT_ID)
  
    
   /*COURSE_ID=@COURSE_ID
   AND SESSION=@SESSION
   AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
   AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  ROLL_NO=@ROLL_NO ))   
   AND IS_PUBLISHED=0
   */
 

 
UPDATE A SET   
         A.CREDIT= P.CREDIT                                                                  
        ,A.THEORY_MAX=OD.THEORY_MAX                                                           
        ,A.THEORY_MIN=OD.THEORY_MIN  
	    ,A.INTERNAL_MAX=OD.INTERNAL_MAX                                                       
        ,A.INTERNAL_MIN=OD.INTERNAL_MIN                                                       
        ,A.SESSIONAL_MAX =OD.SESSIONAL_MAX                                                    
        ,A.SESSIONAL_MIN =OD.SESSIONAL_MIN                                                    
        ,A.TOTAL_MAX =OD.PAPER_TOTAL_MAX 
        ,A.TOTAL_MIN =OD.PAPER_TOTAL_MIN  
        ,A.TOTAL_OBT =ISNULL( IIF((A.THEORY_OBT=-99 OR  A.THEORY_OBT=-98), 0,  A.THEORY_OBT),0) 
                                   +ISNULL( NULLIF(A.INTERNAL_OBT,-99),0) +ISNULL( NULLIF(A.SESSIONAL_OBT,-99),0) 
				  
		,THEORY_PRACT_ABSENT=IIF((A.THEORY_OBT=-99),1, 0) 
		,INTERNAL_ABSENT=IIF((A.INTERNAL_OBT=-99),1, 0) 
		,SESSIONAL_ABSENT=IIF((A.SESSIONAL_OBT=-99),1, 0) 
		,A.UFM=  IIF((A.THEORY_OBT=-98),1, 0)
		,A.THEORY_PRACT_MW= IIF((A.THEORY_OBT IS NULL ),1, 0)
		,A.INTERNAL_MW= IIF((OD.INTERNAL_CHECK=1 AND INTERNAL_OBT IS NULL) ,1, 0)
		,A.SESSIONAL_MW= IIF((OD.SESSIONAL_CHECK=1 AND SESSIONAL_OBT IS NULL) ,1, 0)
		,A.GRADE=NULL
		,A.PAPER_STATUS= CASE  
		                    WHEN  A.PAPER_NAME='NOT OPTED' AND A.SUBJECT_TYPE='MINOR' THEN 'PASS'
							WHEN (OD.INTERNAL_MAX IS NOT  NULL AND   INTERNAL_OBT IS NOT NULL  AND    ISNULL(A.INTERNAL_OBT,0)> ISNULL(OD.INTERNAL_MAX,0) )   THEN 'INT_ERR'
							WHEN ((A.THEORY_OBT IS NOT NULL AND A.THEORY_OBT> OD.THEORY_MAX) ) THEN 'MRK_ERR' 
							       

		                    ELSE NULL
					     END 
	          ,[LAST_UPDATED_AT]=GETDATE()  

   FROM [dbo].[STUDENT_MARKS] A
   INNER JOIN 
   @TBLRESULTDATA B 
   ON A.RESULT_ID=B.RESULT_ID
   AND A.COURSE_ID=B.COURSE_ID
   INNER JOIN
   AGRA_MASTER.DBO.RESULTTYPE_WISE_ORDINANCE CO 
   ON B.COURSE_ID= CO.COURSE_ID
    AND B.ORDINANCE_ID=CO.ORDINANCE_ID
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE O
   ON  B.ORDINANCE_ID =O.ORDINANCE_ID  
   
   INNER JOIN AGRA_MASTER.DBO.ORDINANCE_DETAILS OD 
   ON O.ORDINANCE_ID=OD.ORDINANCE_ID
   INNER JOIN 
   PAPER_MASTER P 
   ON A.PAPER_CODE=P.PAPER_CODE_PK
   AND P.PAPER_TYPE_CAT=OD.PAPER_TYPE_CAT
 
 

 /*
   WHERE B.COURSE_ID=@COURSE_ID
   AND B.SESSION=@SESSION
   AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  B.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
   AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  B.ROLL_NO=@ROLL_NO ))   
   AND B.IS_PUBLISHED=0
   */
    
/*-------------------------------------------CHECK VALIDATION OF DATA -------------------------------*/ 

 

;WITH TEMP AS
 (
SELECT  COUNT(DISTINCT IIF(SUBJECT_TYPE IN('MAJOR1','MAJOR2','MAJOR_ELECTIVE'),SUBJECT_TYPE,NULL))MAJORCOUNT,
        COUNT( IIF(SUBJECT_TYPE = 'VOCATIONAL',1,NULL))VOCATIONAL,
        COUNT( IIF(SUBJECT_TYPE= 'CO_CURRICULAR',1,NULL))COCURRICULAR,
		COUNT( IIF((PAPER_STATUS = 'INT_ERR' OR PAPER_STATUS = 'MRK_ERR' ),1,NULL))MRK_ERR,
		COUNT( IIF(SUBJECT_TYPE= 'RESEARCH',1,NULL))RESEARCH,
        SUM(IIF(SUBJECT_TYPE = 'MINOR',CREDIT,0))MINORCR,
        SUM(IIF(SUBJECT_TYPE LIKE 'MAJOR%',CREDIT,0))MAJORCR,
        SUM(IIF(SUBJECT_TYPE = 'VOCATIONAL',CREDIT,0))VOCATIONALCR,
  B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  FROM [dbo].[STUDENT_MARKS] A
  INNER JOIN @TBLRESULTDATA B 
  ON A.RESULT_ID=B.RESULT_ID
  AND A.COURSE_ID=B.COURSE_ID
  
   

   GROUP BY B.ROLL_NO,B.RESULT_ID,B.ORDINANCE_ID 
  )

 
   UPDATE A SET SEMESTER_RESULT=IIF(ERRORDETAILS IS NULL ,NULL,'#ERROR')
  ,IS_PUBLISHED=10
  ,PUBLISH_DATE=GETDATE()
  ,ERROR_DETAILS=ERRORDETAILS
  FROM  STUDENT_RESULT A
  
  INNER JOIN (
                SELECT RESULT_ID 
				     ,CASE WHEN MRK_ERR>0 THEN 'PAPER MARK ERROR' 
				      WHEN A.MAJORCOUNT<>B.MAJOR_PAPER_COUNT THEN 'MAJOR PAPER IS MISSING'
                      WHEN A.VOCATIONAL<>B.VOCATIONAL_PAPER_COUNT  THEN 'VOCATIONAL  PAPER IS MISSING'
                      WHEN A.COCURRICULAR<>B.QUALIFY_PAPER_COUNT THEN 'CO-CURRICULAR PAPER IS MISSING'
					  WHEN A.RESEARCH<>B.RESEARCH_PAPER_COUNT THEN 'RESEARCH PAPER IS MISSING'
                      WHEN A.MAJORCR<>B.TOTAL_MAJOR_CR THEN 'MAJOR PAPER CREDIT IS WRONG'
                      WHEN A.VOCATIONALCR<>B.VOCATIONAL_CR THEN 'VOCATIONAL PAPER CREDIT IS WRONG'
					  
                      WHEN MINORCR>0 AND  (A.MAJORCR+A.VOCATIONALCR+MINORCR) NOT IN (25,27)  THEN 'MINOR PAPER CREDIT IS WRONG'
                     
					 ELSE
                      NULL  
                      END ERRORDETAILS
                FROM TEMP A  
                INNER JOIN 
                AGRA_MASTER.DBO.ORDINANCE B 
                ON  A.ORDINANCE_ID=B.ORDINANCE_ID
               
    ) AS B
  ON A.RESULT_ID=B.RESULT_ID
     WHERE A.COURSE_ID=@COURSE_ID
     AND A.IS_PUBLISHED=0
     AND  A.IS_HISTORY=0
	 and ERRORDETAILS IS NOT NULL
	 AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE A.RESULT_ID=T.RESULT_ID)

/*---------------DELETE THOSE RESUTID WHICH HAS ERROR------------------------------*/ 
---SELECT *




DELETE T FROM @TBLRESULTDATA T 
WHERE EXISTS ( SELECT RESULT_ID FROM STUDENT_RESULT R
                WHERE IS_PUBLISHED=10 AND T.RESULT_ID=R.RESULT_ID)
 
  /*------------------------------------------SET PAPER STATUS-----------------------------*/   
 
 UPDATE SM  SET  
 		      PAPER_STATUS=   CASE 
			                  WHEN (SM.THEORY_OBT =-99  and SM.INTERNAL_OBT=-99  ) THEN 'ABSENT' 
				              WHEN ( SM.THEORY_OBT=-98  ) THEN 'UFM'
							  WHEN (SM.THEORY_OBT IS NULL OR (INTERNAL_MAX IS NOT NULL AND INTERNAL_OBT IS NULL)) THEN 'MW' 
							  WHEN (SM.THEORY_OBT >0 AND SM.THEORY_OBT>=SM.THEORY_MIN AND SM.THEORY_OBT<=SM.THEORY_MAX
							        AND SM.TOTAL_OBT>0 AND SM.TOTAL_OBT>=SM.TOTAL_MIN AND SM.TOTAL_OBT<=SM.TOTAL_MAX
							  
							   and
								   ( 
									   (   INTERNAL_MAX IS NOT NULL  AND  INTERNAL_OBT IS NOT NULL 
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >=0  
										   AND ISNULL( NULLIF( INTERNAL_OBT,-99),0) >= ISNULL(SM.INTERNAL_MIN,0) 
										   AND INTERNAL_OBT <= SM.INTERNAL_MAX  
									    ) 
									   OR 
									   (INTERNAL_MAX IS  NULL  and 1=1)    
								   
								   
								   )
								  

							   
								   )  
								   THEN 'PASS'

					           ELSE 'FAIL' 
							END 
				,LAST_UPDATED_AT= GETDATE()
						
				FROM STUDENT_MARKS SM
				 INNER JOIN @TBLRESULTDATA SR
				 ON SR.RESULT_ID=SM.RESULT_ID
				 AND SR.MASTER_ID=SM.MASTER_ID

				  


 /*--------------------SET CREDIT --------------------------------------------------------------*/

 
 UPDATE SM SET @POINT=CASE WHEN PM.PAPER_TYPE NOT IN('C','R') AND  SM.PAPER_STATUS ='PASS' 
			   THEN   (SELECT VALUE FROM  (SELECT  ROW_NUMBER()OVER(ORDER BY VALUE)RW, VALUE  FROM  STRING_SPLIT(  dbo.GET_GRADE_POINT(SR.RESULT_TYPE,SM.TOTAL_OBT*100/FLOOR(PM.TOTAL_MAX)),','))AS A WHERE RW=1) ELSE 0   END  
			  ,Point=@POINT
			 ,@EarnCR =IIF( SM.PAPER_STATUS ='PASS', PM.CREDIT  ,0 )
			 ,SM.EARNED_CREDIT=@EarnCR
		     ,SM.GRADE_POINT= @POINT*@EarnCR
			 ,Grade= CASE 
			          WHEN   PM.PAPER_TYPE  IN('C') AND  SM.PAPER_STATUS='PASS' THEN 'Q'
	                  WHEN  PM.PAPER_TYPE  IN('C') AND  SM.PAPER_STATUS IN('FAIL','ABSENT')  THEN 'NQ'
					  WHEN  PM.PAPER_TYPE  IN('C') AND  SM.PAPER_STATUS='MW'  THEN ''
                      WHEN  PM.PAPER_TYPE NOT IN('C') AND ( SM.PAPER_STATUS='FAIL' )  THEN 'F' 
					  WHEN  PM.PAPER_TYPE NOT IN('C') AND   SM.PAPER_STATUS='MW' THEN '' 
					  WHEN  PM.PAPER_TYPE NOT IN('C') AND SM.PAPER_STATUS='ABSENT' THEN 'AB' 
                      ELSE  
					  CASE 
					  WHEN PM.PAPER_TYPE NOT IN('C') AND SM.PAPER_STATUS='MW' THEN '' 
					  WHEN SM.PAPER_STATUS LIKE '%ERR' THEN ''
					  WHEN SM.PAPER_STATUS='ABSENT' THEN 'AB' WHEN SM.PAPER_STATUS='FAIL' THEN 'F' WHEN SM.PAPER_STATUS='UFM' THEN 'U' 
			          ELSE (SELECT VALUE FROM  (SELECT  ROW_NUMBER()OVER(ORDER BY VALUE)RW, VALUE  FROM  STRING_SPLIT( dbo.GET_GRADE_POINT(SR.RESULT_TYPE, SM.TOTAL_OBT *100/FLOOR(PM.TOTAL_MAX)),','))AS A WHERE RW=2) 
					  END 
			 END 



            FROM STUDENT_MARKS SM
				 INNER JOIN @TBLRESULTDATA SR
				 ON SR.RESULT_ID=SM.RESULT_ID
				 AND SR.MASTER_ID=SM.MASTER_ID
				 INNER JOIN PAPER_MASTER PM
				 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
				  
				 
				 
 

 UPDATE SR SET SR.TOTAL_CREDIT=A.TOTALCREDIT
              ,SR.EARNED_CREDIT =A.TOTALEARNCREDIT
			  ,SR.TOTAL_MAJOR_CREDIT=TOTALMAJORCREDIT
			  ,SR.TOTAL_MAJOR_EARN_CREDIT=TOTALMAJOREARNCREDIT
			  ,SR.TOTAL_POINT=A.TOTALPOINT 
	          ,SR.TOTAL_GRADE_POINT=GRADEPOINT
	          ,TOTAL_OBT_MARKS =TOTALMARKSOBT
			  ,TOTAL_MAX_MARKS=THEORY_MAX
			  ,TOTAL_MIN_MARKS=THEORY_MIN
			  ,SR.CO_CURRICULAR_RESULT=A.CO_CURRICULAR_RESULT
	          ,SR.SGPA= CASE 
			               WHEN A.TOTALCREDIT>0 THEN  CONVERT(DECIMAL(7,3),ROUND( A.GRADEPOINT/CONVERT( DECIMAL(7,3),A.TOTALCREDIT),3,1)) ELSE 0 
			        	END  

             ,LAST_ORDINANCE_RUN_AT=GETDATE()
			 ,LAST_UPDATED_AT=GETDATE()
             ,SR.SEMESTER_RESULT= CASE WHEN UFMCOUNT>0    THEN 'RD( UFM )'
			                           WHEN MWCOUNT>0     THEN 'RD( MW )'
									   WHEN ERRORCOUNT>0  THEN '#ERROR'
	                                   WHEN ABSENTCOUNT=PAPERCOUNT  THEN 'ABSENT'
			                           WHEN (ABSENTCOUNT>0 or FAILCOUNT>0 ) THEN 'FAIL' 
									   --WHEN FAILCOUNT>0   THEN 'FAIL'
									   WHEN PASSCOUNT=PAPERCOUNT    THEN 'PASS'
									 
									 END 
       FROM STUDENT_RESULT  SR
   
   INNER JOIN (
      SELECT SM.ROLL_NO
	 ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.CREDIT,0))TOTALCREDIT
	 ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.EARNED_CREDIT,0))TOTALEARNCREDIT
	 ,SUM(IIF(SM.SUBJECT_TYPE IN( 'MAJOR1','MAJOR2','MAJOR_ELECTIVE') ,SM.CREDIT,0  ) )TOTALMAJORCREDIT
	 ,SUM(IIF(SM.SUBJECT_TYPE IN( 'MAJOR1','MAJOR2','MAJOR_ELECTIVE') ,SM.EARNED_CREDIT,0  ) )TOTALMAJOREARNCREDIT
     ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.POINT,0))TOTALPOINT
	 ,SUM(IIF((PM.PAPER_TYPE NOT IN('R','C') ),SM.GRADE_POINT,0)) GRADEPOINT 
	 ,SUM(SM.TOTAL_OBT)TOTALMARKSOBT 
	 ,SUM( SM.TOTAL_MAX)THEORY_MAX
	 ,SUM( SM.TOTAL_MIN )THEORY_MIN 
     ,MAX(IIF( PM.PAPER_TYPE='C' AND SM.GRADE='Q' , 'Q' ,'NQ' ) ) CO_CURRICULAR_RESULT 
	 ,COUNT( IIF((PAPER_STATUS='INT_ERR' OR PAPER_STATUS='MRK_ERR'),1,NULL))ERRORCOUNT
	 ,COUNT( IIF((PAPER_STATUS='UFM'),1,NULL))UFMCOUNT
	 ,COUNT( IIF(PM.PAPER_TYPE NOT IN('R','C') ,1,NULL))PAPERCOUNT
	 ,COUNT( IIF(PM.PAPER_TYPE NOT IN('R','C')  AND  PAPER_STATUS='MW',1,NULL))MWCOUNT
	 ,COUNT( IIF(PM.PAPER_TYPE NOT IN('R','C')  AND  PAPER_STATUS='PASS',1,NULL))PASSCOUNT
	 ,COUNT( IIF((PM.PAPER_TYPE NOT IN('R','C') AND  PAPER_STATUS='ABSENT'),1,NULL))ABSENTCOUNT
	 ,COUNT( IIF((PM.PAPER_TYPE NOT IN('R','C') AND  PAPER_STATUS='FAIL'),1,NULL))FAILCOUNT
	 ,SM.MASTER_ID,SM.RESULT_ID
	 FROM STUDENT_MARKS SM
	 INNER JOIN @TBLRESULTDATA SR
	 ON SR.RESULT_ID=SM.RESULT_ID
	 AND SR.MASTER_ID=SM.MASTER_ID
	 INNER JOIN PAPER_MASTER PM
	 ON PM.PAPER_CODE_PK=SM.PAPER_CODE
	 
  /*
	--WHERE  SM.COURSE_ID  = @COURSE_ID 
	--AND SR.EXAM_TYPE=@EXAMTYPE 
    -- AND SR.SESSION=@SESSION 
	-- AND SR.IS_PUBLISHED=0
    -- AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  SR.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
	-- AND ( (lEN(@ROLL_NO)=0 AND 1=1) OR  (lEN(@ROLL_NO)>1  AND  SR.ROLL_NO=@ROLL_NO )) 
	*/



     GROUP BY SM.ROLL_NO,SM.MASTER_ID,SM.RESULT_ID 

 )AS A ON A.MASTER_ID=SR.MASTER_ID 
	    AND A.RESULT_ID=SR.RESULT_ID 
	    
	 WHERE  SR.IS_PUBLISHED = 0 
	       AND SR.IS_HISTORY=0
		   AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)


/*
	   WHERE SR.COURSE_ID =@COURSE_ID  
	    AND SR.IS_PUBLISHED =0
        AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  SR.COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  )
        AND ( (lEN(@ROLL_NO)=0 AND 1=1) OR  (lEN(@ROLL_NO)>1  AND  SR.ROLL_NO=@ROLL_NO )) 

*/


/*------------------------------------------UPDATE CONSOLIDATE-----------------------------*/

		 UPDATE B SET B.QUALIFYING_PAPER=  IIF ( SR.CO_CURRICULAR_RESULT ='Q' ,  B.QUALIFYING_PAPER| POWER(2,SR.YEAR_SEM -1),  B.QUALIFYING_PAPER & (B.QUALIFYING_PAPER ^  PowER(2, SR.YEAR_SEM - 1)) ) ,
         B.UPDATEON=GETDATE()
            FROM  STUDENT_RESULT SR
	        INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
		    ON SR.ROLL_NO=B.ROLL_NO
	         WHERE  SR.IS_PUBLISHED = 0 
			  AND   SR.IS_HISTORY = 0 
			  AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)
		
	 
 
; WITH TEMP AS
 (
  SELECT A.MASTER_ID,A.ROLL_NO, SUM( TOTAL_GRADE_POINT) TOTALGP ,SUM(TOTAL_CREDIT)TOTALCR,SUM(EARNED_CREDIT)TOTALEARNCR 
 ,CONVERT(DECIMAL(16,3),SUM( TOTAL_GRADE_POINT)/SUM(TOTAL_CREDIT)) CGPA
  FROM STUDENT_RESULT A
 INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER B
 ON A.COURSE_ID=B.COURSE_ID
 INNER JOIN @TBLRESULTDATA T
 ON A.ROLL_NO=T.ROLL_NO
  WHERE   A.IS_HISTORY = 0 
  AND YEAR_SEM<=(SELECT SEM_NO FROM AGRA_MASTER.DBO.COURSE_MASTER  WHERE  COURSE_ID=T.COURSE_ID) 
  GROUP BY A.MASTER_ID,A.ROLL_NO
) 	
  
UPDATE SR SET
   CUM_TOTAL_POINT=TOTALGP
  ,CUM_TOTAL_CREDIT=TOTALCR
  ,CUM_TOTAL_EARNED_CREDIT=TOTALEARNCR
  ,SR.CGPA=B.CGPA
  FROM STUDENT_RESULT SR 
  INNER JOIN TEMP B
  ON SR.MASTER_ID=B.MASTER_ID
  AND SR.ROLL_NO=B.ROLL_NO
  WHERE SR.IS_PUBLISHED = 0 
  AND   SR.IS_HISTORY = 0 
  AND   SR.COURSE_ID=@COURSE_ID
  AND EXISTS(SELECT 1 FROM @TBLRESULTDATA T WHERE SR.RESULT_ID=T.RESULT_ID)

 

 


 /*---------------------------UPDATE CUMALETIVE IN ALL SEMESTER--------------------*/

  ;WITH RESULTID_WITH_COURSEID AS
   (    
   select A.*,C.COURSE_ID_MAIN 
   from  @TBLRESULTDATA A
   INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C
   ON A.COURSE_ID=C.COURSE_ID
   AND LEFT(ROLL_NO,2)>22
 
   )
   ,TEMP2 AS 
    (
    SELECT  A.COURSE_ID,  A.ROLL_NO, A.RESULT_ID,YEAR_SEM,TOTAL_CREDIT,TOTAL_GRADE_POINT,
    SUM(TOTAL_CREDIT)OVER(PARTITION BY A.MASTER_ID ORDER BY YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS CUMCREDIT 
   ,SUM(EARNED_CREDIT)OVER(PARTITION BY A.MASTER_ID ORDER BY YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS CUMEARNCREDIT
   ,SUM(TOTAL_GRADE_POINT)OVER(PARTITION BY A.MASTER_ID ORDER BY YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS CUMGRADEPOINT
   ,CONVERT(DECIMAL(7,2),
   SUM(ISNULL(A.SGPA,0) * ISNULL(A.TOTAL_CREDIT,0))OVER(PARTITION BY A.MASTER_ID ORDER BY A.YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)
    / CAST(SUM(ISNULL(A.TOTAL_CREDIT,0))OVER(PARTITION BY A.MASTER_ID ORDER BY A.YEAR_SEM ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS DECIMAL(7,2)
    )
) AS CUM_SGPA
    FROM STUDENT_RESULT A
    INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C
    ON A.COURSE_ID=C.COURSE_ID
    INNER JOIN RESULTID_WITH_COURSEID B
    ON A.MASTER_ID=B.MASTER_ID
    AND B.COURSE_ID_MAIN=C.COURSE_ID_MAIN
    AND IS_HISTORY=0
   )
  --SELECT A.*,B.CUM_TOTAL_CREDIT,B.CUM_TOTAL_EARNED_CREDIT,B.CUM_TOTAL_GRADE_POINT ,B.CGPA
  UPDATE B SET B.CUM_TOTAL_CREDIT=CUMCREDIT
  ,B.CUM_TOTAL_EARNED_CREDIT=CUMEARNCREDIT
  ,B.CUM_TOTAL_GRADE_POINT=CUMGRADEPOINT
  ,B.CGPA=CUM_SGPA
  ,B.IS_PUBLISHED=1
  ,B.PUBLISH_DATE=GETDATE()
  ,B.IS_LIVE=0
  FROM TEMP2 A
  INNER JOIN STUDENT_RESULT B
  ON A.COURSE_ID=B.COURSE_ID
  AND A.RESULT_ID=B.RESULT_ID
  

   /*------------------------UPDATE CONSOLIDATE --------------------*/

   EXEC UPDATE_STUDENT_CONSOLIDATE @TBLRESULTDATA ,@COURSE_ID,@RESULT_TYPE_ID
  

 /*-----------------------------------END-------------------------------*/
 

/*-------------------------------------------------------------------------------*/

 UPDATE  SR  set    FINAL_RESULT= CASE   WHEN  YEAR_SEM=6 AND SEMESTER_RESULT='PASS'   AND(B.QUALIFYING_PAPER<>63 ) THEN 'RD( QPNC )'
                                         WHEN  YEAR_SEM=6 AND SEMESTER_RESULT='PASS'   AND(B.QUALIFYING_RESEARCH<>32 ) THEN 'RD( QPNC )'
 
 
                                         WHEN  SEMESTER_RESULT='ABSENT'   THEN 'ABSENT'
				                         WHEN  SEMESTER_RESULT='RD( MW )'    THEN  'RD( MW )'
										 WHEN  SEMESTER_RESULT='RD( UFM )'   THEN  'RD( UFM )'
										 WHEN  SEMESTER_RESULT='FAIL'   THEN   'PROMOTED WITH BACK'

										 WHEN  YEAR_SEM=1 AND SEMESTER_RESULT='PASS' THEN'PASS'
										 /*-----------------------PROMOTED BACK-------------------*/

										 WHEN YEAR_SEM=2 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-2)=0) 
										       OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'
										 
                                        
										 WHEN YEAR_SEM=3 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-3)=0) 
										       OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'


										   WHEN YEAR_SEM=4 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-4)=0) 
										       OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'


										  
										   WHEN YEAR_SEM=5 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-4)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-5)=0) 
										         OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										  THEN  'PROMOTED WITH BACK'


										     WHEN YEAR_SEM=6 AND  SEMESTER_RESULT='PASS' 
										     AND ((b.RESULTSTATUS & POWER(2,SEM_NO-1)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-2)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-3)=0 OR b.RESULTSTATUS & POWER(2,SEM_NO-4)=0 OR  b.RESULTSTATUS & POWER(2,SEM_NO-5)=0 or b.RESULTSTATUS & POWER(2,SEM_NO-6)=0) 
										         OR CUM_TOTAL_CREDIT<>CUM_TOTAL_EARNED_CREDIT  ) 
										       --OR ( b.QUALIFYING_PAPER & POWER(2,-1)=0 or b.QUALIFYING_PAPER & POWER(2,1-1)=0 ) 
										      THEN  'PROMOTED WITH BACK'



										  /*--------------------------------------------------------------------*/

						                 WHEN  YEAR_SEM=2 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-2)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=1)  AND   MINOR_I_YEAR='PASS' AND (B.EARN_CREDIT_1+ B.EARN_CREDIT_2 ) IN(46,48)  )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
		                         
								 
								         WHEN  YEAR_SEM=3 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=4   and b.RESULTSTATUS & POWER(2,SEM_NO-2)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=4 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-3)=1) AND (B.EARN_CREDIT_3 ) IN(21,25,27)  )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
								 
							         	 WHEN YEAR_SEM=4 AND SEMESTER_RESULT ='PASS'   AND((b.RESULTSTATUS & POWER(2,SEM_NO-1)=8 and  b.RESULTSTATUS & POWER(2,SEM_NO-2)=4  and  b.RESULTSTATUS & POWER(2,SEM_NO-3)=2 and  b.RESULTSTATUS & POWER(2,SEM_NO-4)=1 ) AND  ( B.MINOR_II_YEAR IS NULL  or    ( B.MINOR_II_YEAR IS NOT NULL AND   MINOR_II_YEAR<>'PASS') ))  
										 THEN 'RD( MNNC )'

								 
								         WHEN  YEAR_SEM=4 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=8  and b.RESULTSTATUS & POWER(2,SEM_NO-2)=4 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-4)=1 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=4 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-3)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-4)=1)  AND   MINOR_II_YEAR='PASS' AND (B.EARN_CREDIT_3+ B.EARN_CREDIT_4 ) IN(46,48) )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'

                                     	 WHEN  YEAR_SEM=5 AND   (b.RESULTSTATUS & POWER(2,SEM_NO-1)=16  and b.RESULTSTATUS & POWER(2,SEM_NO-2)=8 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=4 and b.RESULTSTATUS & POWER(2,SEM_NO-4)=2 and b.RESULTSTATUS & POWER(2,SEM_NO-5)=1 and b.RESULTSTATUS & POWER(2,SEM_NO-3)=1 AND (b.QUALIFYING_PAPER & POWER(2,SEM_NO-1)=16 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-2)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-3)=8 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-4)=2 and b.QUALIFYING_PAPER & POWER(2,SEM_NO-5)=1)  AND  (B.EARN_CREDIT_5 ) IN(20)  )
							             AND     CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
						                 THEN  'PASS'
                                       
									    WHEN YEAR_SEM=6 AND   (B.RESULTSTATUS=63 AND B.QUALIFYING_PAPER=63 AND QUALIFYING_RESEARCH=32 AND (( B.MINOR_I_YEAR is not null  and   B.MINOR_I_YEAR='PASS') AND (  B.MINOR_II_YEAR is not null AND  MINOR_II_YEAR='PASS')) AND (B.EARN_CREDIT_1+ B.EARN_CREDIT_2+B.EARN_CREDIT_3+ B.EARN_CREDIT_4 +B.EARN_CREDIT_5+ B.EARN_CREDIT_6)>=132  )
										 AND CUM_TOTAL_CREDIT=CUM_TOTAL_EARNED_CREDIT 
										 THEN  'PASS' 
								 
								 END 
    
							 FROM STUDENT_RESULT SR   
							  INNER JOIN @TBLRESULTDATA T
							  ON SR.RESULT_ID=T.RESULT_ID
							  INNER JOIN 
						      CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B
						      ON  SR.ROLL_NO=B.ROLL_NO
	                          WHERE IS_PUBLISHED=0 
						      AND IS_HISTORY=0
								




 /*----------------SET FINAL RESULT IMW PMW------------------------*/
  EXEC SET_IMW_PMW @TBLRESULTDATA,@COURSE_ID

/*------------------------------------------------------------------*/







/*-----------------------------------------DIVISION -----------------------------------*/



/*------------------------------------------------------------------------------------*/






/*----------UPDATE PUBLISHED STATUS 0-FOR WAITING FOR EXECUTE, 1-EXECUTED ,2-LIVE------*/
	   
		UPDATE  SR SET SR.IS_PUBLISHED=1,PUBLISH_DATE=GETDATE(),LAST_ORDINANCE_RUN_AT=GETDATE(),IS_LIVE=0
		    FROM STUDENT_RESULT SR
		    INNER JOIN @TBLRESULTDATA T
			ON SR.RESULT_ID=T.RESULT_ID
			AND SR.COURSE_ID=T.COURSE_ID
			WHERE SR.IS_PUBLISHED=0
			AND SR.IS_HISTORY=0
GO
/****** Object:  StoredProcedure [dbo].[PREPARED_RESULT]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC  [dbo].[PREPARED_RESULT]
 (
  --@PREPARERESULTDATA   RESULT_USERS_TBLTYPE  READONLY ,
 @COURSE_ID INT =111
 ,@RESULT_TYPE_ID INT 
  
 )

 AS 


-- SELECT * FROM @PREPARERESULTDATA

  --declare @PROCNAME varchar(2000)='PREPARED_RESULT'
  --DECLARE @SQL_QUERY VARCHAR(MAX) 

  --DECLARE @TBLRESULTDATA AS RESULT_USERS_TBLTYPE; 
  --INSERT INTO @TBLRESULTDATA (MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,SEM_NO,ORDINANCE_ID,RESULT_TYPE)
  --SELECT MASTER_ID,RESULT_ID,ROLL_NO,COURSE_ID,YEAR_SEM,ORDINANCE_ID,RESULT_TYPE FROM STUDENT_RESULT 
  -- WHERE COURSE_ID=@COURSE_ID
  -- AND SESSION=@SESSION
  -- AND ( (LEN(@CCODE)=0 AND 1=1) OR(LEN(@CCODE)>0  AND  COLLEGE_CODE IN (SELECT VALUE FROM  STRING_SPLIT( @CCODE,',')))  ) 
  -- AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR  (LEN(@ROLL_NO)>1  AND  ROLL_NO=@ROLL_NO ))   
  -- AND IS_PUBLISHED=0
  -- AND IS_HISTORY=0

  --select @PROCNAME=PROC_NAME from AGRA_MASTER.DBO.RESULTTYPE_WISE_ORDINANCE WHERE COURSE_ID=@COURSE_ID AND RESULT_TYPE_ID=@RESULT_TYPE_ID


 --IF(@PROCNAME IS NOT NULL)
 -- BEGIN
 --SET @SQL_QUERY =  N'EXEC '+@PROCNAME +  ' '''+@CCODE+''','+CONVERT(VARCHAR(10), @COURSE_ID)+','''+@EXAMTYPE+''','''+@SESSION+''','''+@ROLL_NO+''''
 --execute (@SQL_QUERY)
 --END  
GO
/****** Object:  StoredProcedure [dbo].[SaveOrdinanceStudentMapping_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[SaveOrdinanceStudentMapping_AM]  
	 @Flag VARCHAR(100),
	 @COURSE_ID INT  ,
	 @SESSIONNAME VARCHAR(100)  ,
	@EXAMTPYENAME VARCHAR(100)  ,
	 @ORDINANCE_ID INT =0 ,
	 @ROLL_NOS VARCHAR(MAX),  
	 @HELD_IN VARCHAR(100)
AS  
 
  
--------//  [SaveOrdinanceStudentMapping_AM] '',112,'2024-25','REGULAR',0,'','APRIL-2025'
   
BEGIN  
	 

     UPDATE dbo.STUDENT_RESULT SET ORDINANCE_ID=@ORDINANCE_ID
	  WHERE 
	  EXAM_TYPE= @EXAMTPYENAME AND
	  COURSE_ID= @COURSE_ID AND
	  SESSION= @SESSIONNAME AND
	  HELD_IN =@HELD_IN
	  AND ( (LEN(ISNULL(@ROLL_NOS,''))=0 AND 1=1) OR (LEN(ISNULL(@ROLL_NOS,''))>0  AND  ROLL_NO IN ( SELECT VALUE FROM  string_split( @ROLL_NOS,',')))  )

     
	   SELECT ''+CAST(@@ROWCOUNT AS VARCHAR(50)) +' Students Updated!!' AS RESPONSEMESSAGE, 1 AS RESPONSECODE, 0 AS RESPONSEMESSAGECODE;
	
END  
GO
/****** Object:  StoredProcedure [dbo].[SavePaper_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[SavePaper_AM] (
@Flag			VARCHAR(100),
@PAPER_CODE_PK VARCHAR(25), 
@SUBJECT_NAME nVARCHAR(200), 
@PAPER_NAME nVARCHAR(500), 
@PAPER_TYPE VARCHAR(5),
@PAPER_TYPE_SRNO VARCHAR(5),
@CREDIT int,
@IS_QUALIFIYING int,
@THEORY_MAX int,
@THEORY_MIN int, 
@INTERNAL_MAX int,
@INTERNAL_MIN int,
@SESSIONAL_MAX int,
@SESSIONAL_MIN int,
@TOTAL_MAX int,
@TOTAL_MIN int,
@SUBJECT_PAPER_CODE VARCHAR(50),
@ISRW int, 
@SESSIONID int,
@PAPER_SERIAL_NO int
)



AS
BEGIN
			

			
			SELECT 'Data saved successfully.!!' AS ResponseMessage, 1 as ResponseCode, 0 AS ResponseMessageCode;
END
GO
/****** Object:  StoredProcedure [dbo].[SearchOrdinanceStudent_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[SearchOrdinanceStudent_AM]  
	 @Flag VARCHAR(100),
	 @COURSE_ID INT  ,
	 @SESSIONNAME VARCHAR(100)  ,
	@EXAMTPYENAME VARCHAR(100)  ,
	 @ORDINANCE_ID INT =0 ,
	 @ROLL_NOS VARCHAR(2000),  
	 @HELD_IN VARCHAR(100)
AS  
 
  
--------//  [SearchOrdinanceStudent_AM] '',0,'2024-25','',0,''
   
BEGIN  
DECLARE @COUNTNO AS INT=0;

      SELECT @COUNTNO=COUNT(ROLL_NO) FROM dbo.STUDENT_RESULT(NOLOCK)
	  WHERE 
	  EXAM_TYPE= @EXAMTPYENAME AND
	  COURSE_ID= @COURSE_ID AND
	  SESSION= @SESSIONNAME AND
	  HELD_IN =@HELD_IN
	  --EXAM_TYPE= @EXAMTPYENAME
     
	   SELECT ''+CAST(@COUNTNO AS VARCHAR(50)) +' Students!!' AS RESPONSEMESSAGE, 1 AS RESPONSECODE, 0 AS RESPONSEMESSAGECODE;
	
END  
GO
/****** Object:  StoredProcedure [dbo].[SET_IMW_PMW]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC  [dbo].[SET_IMW_PMW]     
 (    
   @TBLRESULTDATA   RESULT_USERS_TBLTYPE  READONLY     
   ,@COURSE_ID INT     
 )    
    
 AS    
    
 
    
 ;WITH TEMPRESULT As     
(    
     select SM.MASTER_ID,SM.RESULT_ID,SM.COURSE_ID,SM.YEAR_SEM,SM.EXAM_TYPE,    
  COUNT( CASE WHEN SM.THEORY_OBT IS NULL AND SM.PAPER_STATUS='MW'  AND PM.PAPER_TYPE='T'  THEN 1 ELSE NULL END)MW,    
  COUNT( CASE WHEN (SM.INTERNAL_OBT IS NULL AND SM.PAPER_STATUS='MW' AND SM.INTERNAL_MAX IS NOT NULL)    
   OR (SM.THEORY_OBT IS NULL AND SM.PAPER_STATUS='MW' AND PM.PAPER_TYPE_CAT IN('V','R'))    
     THEN 1 ELSE NULL END) IMW,    
  COUNT( CASE WHEN SM.THEORY_OBT IS NULL AND SM.PAPER_STATUS='MW' AND PM.PAPER_TYPE IN('P') THEN 1 ELSE NULL END) PMW    
  FROM STUDENT_MARKS SM    
     INNER JOIN @TBLRESULTDATA SR    
       ON SR.RESULT_ID=SM.RESULT_ID    
      AND SR.MASTER_ID=SM.MASTER_ID    
  INNER JOIN dbo.PAPER_MASTER  PM    
     ON  PM.PAPER_CODE_PK=SM.PAPER_CODE     
     AND SM.COURSE_ID= @COURSE_ID    
     GROUP BY SM.MASTER_ID,SM.RESULT_ID,SM.COURSE_ID,SM.YEAR_SEM,SM.EXAM_TYPE    
  )    
    
       
  UPDATE SR SET SR.SEMESTER_RESULT =    
   IIF( SM.PMW>0,'RD( PMW )', IIF( SM.IMW >0, 'RD( IMW )', IIF( SM.MW >0, 'RD( MW )',NULL   )))    
     
 ,SR.FINAL_RESULT =    
   IIF( SM.PMW>0,'RD( PMW )', IIF( SM.IMW >0, 'RD( IMW )', IIF( SM.MW >0, 'RD( MW )',NULL   )))    
    
   FROM  TEMPRESULT SM      
  INNER JOIN STUDENT_RESULT SR    
       ON SR.RESULT_ID=SM.RESULT_ID    
      AND SR.MASTER_ID=SM.MASTER_ID    
     INNER JOIN    
   @TBLRESULTDATA T     
      ON T.RESULT_ID=SR.RESULT_ID      
      AND T.COURSE_ID=SR.COURSE_ID    
      WHERE SR.COURSE_ID=@COURSE_ID        
      AND( SR.SEMESTER_RESULT='RD( MW )' OR SR.FINAL_RESULT='RD( MW )' )   
      AND SR.IS_PUBLISHED=0    
      AND SR.IS_HISTORY=0     
GO
/****** Object:  StoredProcedure [dbo].[StudentList_Admin_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[StudentList_Admin_AM](
@Flag VARCHAR(250),
@SessionName VARCHAR(100),
@CourseType		VARCHAR(50)='',
@CourseId	int,
@ExamTypeName  NVARCHAR(50),
@RollNumber		VARCHAR(MAX),
@IsLiveStatus		int,
@IsAdmin  VARCHAR(5)=NULL,
 @PageNumber INT 
)
AS
---  EXEC StudentList_Admin_AM 'List', '2024-25','Affiliated College',8,NULL,'2500040010466,2500040010467',2,1,200
	BEGIN
		SET NOCOUNT ON;     
      DECLARE @PageSize INT  =20;
      DECLARE @RecordCount INT =0;
      DECLARE @Totalpage int  =0

	 DECLARE @COURSE_NAME VARCHAR(150)  
  DECLARE @Curid VARCHAR(5) 
  DECLARE @SEM_NO VARCHAR(5)
  DECLARE @ImageURL  VARCHAR(150)  

	--SELECT @SEM_NO=Semester ,@COURSE_NAME=CourseNameReal,@ImageURL =ImageURL, @Curid=CourseID  FROM  COURSEMASTER_AM WHERE CourseName=@COURSENAME

	SELECT TOP 1 @SEM_NO=Semester ,@COURSE_NAME=CourseNameReal,@ImageURL =ImageURL, @Curid=CM.CourseID  FROM  AGRA_RESULT_ERP.dbo.COURSEMASTER_AM(NOLOCK) CM
	JOIN AGRA_RESULT_ERP.dbo.COURSEANDTYPEMAP_AM(NOLOCK)  CMP ON CMP.CourseID = CM.CourseID
	JOIN AGRA_RESULT_ERP.dbo.COURSETYPEMASTER_AM(NOLOCK) CT ON CMP.CTYPEID = CT.CtypeID
	WHERE CM.EntryID=@CourseId AND CT.CourseTypeName=@COURSETYPE

		IF(@RollNumber IS NULL OR @RollNumber = '')
				BEGIN
					SET @RollNumber = NULL;
				END 

	PRINT @RollNumber
		DECLARE @strquery		AS VARCHAR(MAX);

		SET @strquery = 'with cte as (SELECT distinct r.RESULT_ID ENTRYID,
		-- s.[CCODE], 
		r.[COURSE_ID] COURSE_ID , 
		r.MASTER_ID,
		cur.[COURSE_NAME] AS CourseName, r.[YEAR_SEM], r.EXAM_TYPE CourseType, r.RESULT_TYPE [RESULT_TYPE], r.ROLL_NO [ROLL_NO],		
		s.ENROLLMENT_NO,
		s.STUDENT_NAME [NAME], s.FATHER_NAME [FNAME], s.MOTHER_NAME [MNAME],
		r.[HELD_IN], r.[SESSION], s.[GENDER], s.[DOB], s.MOBILE,  r.[EXAM_NAME],
		--s.[REMARKS], s.[EMAIL], s.[ADDRESS], s.[STATE], s.[DISTRICT],
		r.IS_LIVE IsLive,
		r.RESULT_DATE ResultDate,
		--s.COURSE_NAME,	
		col.Name AS CNAME
		,r.SEMESTER_RESULT  RESULT,r.FINAL_RESULT
		
		FROM STUDENT_RESULT  r WITH (NOLOCK)		
		  JOIN  dbo.STUDENT_MASTER s  WITH (NOLOCK)  ON s.MASTER_ID=r.MASTER_ID 
		JOIN AgraUniversityExams2023.dbo.Colleges col WITH (NOLOCK) ON r.COLLEGE_CODE = col.Code 
		JOIN AGRA_MASTER.dbo.COURSE_MASTER cur WITH (NOLOCK) ON r.COURSE_ID = cur.COURSE_ID 
		
		WHERE 
		 r.SESSION='''+@SessionName+''' '
		  IF(@ExamTypeName <> '')
		BEGIN
		SET @strquery = @strquery+' AND r.EXAM_TYPE='''+@ExamTypeName+''' '
		end
		
		IF(@Curid >0)
		BEGIN
		SET @strquery = @strquery+' AND r.YEAR_SEM='''+@SEM_NO+''' '
		END

		IF(@RollNumber IS NULL)
		BEGIN
		SET @strquery = @strquery+' AND  r.COURSE_ID='''+ CAST(@Curid AS VARCHAR)+''' '
		END
        
		SET @strquery = @strquery+' AND r.IS_LIVE=
		CASE 
		WHEN '''+ CAST(@IsLiveStatus AS VARCHAR)+''' =''1'' THEN 1 
		WHEN '''+ CAST(@IsLiveStatus AS VARCHAR)+'''=''0'' THEN 0
		ELSE r.IS_LIVE		
		end '
	
	
		IF(@RollNumber IS NOT NULL)
		BEGIN
		SET @strquery = @strquery+' and  r.ROLL_NO IN ( SELECT VALUE from STRING_SPLIT('''+@RollNumber+''','','')' +') '
		END
        
		SET @strquery = @strquery+'  ) select * into pagetemp1  from cte'
		
		PRINT @strquery;
		EXEC (@strquery);

		SELECT @RecordCount = COUNT(*) FROM pagetemp1 WITH(NOLOCK) 
       

       set @Totalpage=@RecordCount/@PageSize+(IIF( @RecordCount%@PageSize>0,1,0 ))



        SET @PageNumber =IIF(@Totalpage>=@PageNumber,@PageNumber,IIF(@Totalpage>=@PageNumber,@PageNumber,1))
         
         SELECT @RecordCount RecordCount,@PageSize PageSize,@PageNumber PageCurrent

		 SELECT * FROM (
		SELECT ROW_NUMBER()OVER(ORDER BY  ENTRYID  ) SrNo,* FROM pagetemp1 
		)AS a 
		WHERE SrNo between (@PageNumber - 1) * @PageSize + 1 and @PageNumber*@PageSize
		
		DROP table pagetemp1

	END
GO
/****** Object:  StoredProcedure [dbo].[StudentStatusUpdate_AM]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[StudentStatusUpdate_AM] (
@EntryIDs	VARCHAR(max),
@IsActive	varchar(2),
@Resultdate	DATETIME NULL,
@AdminID bigint=0
)
/* 
   EXEC [StudentStatusUpdate_AM]  '1501121110000', '1','',6

*/
AS
BEGIN

 --SELECT  CONVERT(DATETIME ,'Oct 15 2024 12:00AM',111)
DECLARE @SQL NVARCHAR(MAX) 
 --SET @SQL = 'SELECT TOP 1 * FROM STUDENT_MASTER_AM '
 SET @SQL = 'update STUDENT_RESULT set IS_LIVE=' +@IsActive+' ,LAST_UPDATED_AT=GETDATE(),LAST_UPDATED_BY='+CAST( @AdminID AS VARCHAR(50))+' '
	
		IF(@Resultdate IS NOT NULL)
		BEGIN	
		SET @SQL = @SQL +' ,RESULT_DATE = CONVERT(DATETIME ,'''+CAST(@Resultdate AS VARCHAR(50)) +''',111) '

		END
		
		SET @SQL = @SQL +' where CAST(RESULT_ID AS VARCHAR(50)) in ('+@EntryIDs+') '

 
		IF(@IsActive='1')
		BEGIN	
			SET @SQL = @SQL +' AND RESULT_DATE IS NOT NULL AND HELD_IN IS NOT NULL'
		END


		--------------------------------

		SET @SQL = @SQL +'         update AGRA_RESULT_ERP.dbo.STUDENT_RESULT set IS_LIVE=' +@IsActive+' ,LAST_UPDATED_AT=GETDATE(),LAST_UPDATED_BY='+CAST( @AdminID AS VARCHAR(50))+' '
	
		IF(@Resultdate IS NOT NULL)
		BEGIN	
		SET @SQL = @SQL +' ,RESULT_DATE = CONVERT(DATETIME ,'''+CAST(@Resultdate AS VARCHAR(50)) +''',111) '

		END
		
		SET @SQL = @SQL +' where CAST(RESULT_ID AS VARCHAR(50)) in ('+@EntryIDs+') '

 
		IF(@IsActive='1')
		BEGIN	
			SET @SQL = @SQL +' AND RESULT_DATE IS NOT NULL AND HELD_IN IS NOT NULL'
		END


print @SQL
EXEC (@SQL)
	
	SELECT 'Yes' AS ResponseMessage, 1 AS ResponseCode;

 	
END

GO
/****** Object:  StoredProcedure [dbo].[SYNC_DATA_FROM_OLD_TO_RESULT_DEMO]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 
CREATE PROC [dbo].[SYNC_DATA_FROM_OLD_TO_RESULT_DEMO]
(
 @ISMERGE BIT =0
)
AS
DECLARE @ROWCOUNT  INT =0

BEGIN TRAN  
 
 BEGIN  TRY  
 
 IF EXISTS (SELECT 1 FROM STUDENT_MARKS_LOCAL_LOG)
 BEGIN
	  DELETE  FROM STUDENT_MARKS 
	  WHERE RESULT_ID IN
	  (
	   SELECT  DISTINCT RESULT_ID
	   FROM [dbo].STUDENT_MARKS_LOCAL_LOG
	  )

 
INSERT INTO STUDENT_MARKS 
            (
            [RESULT_ID]
           ,[MARKS_ID]
           ,[SUBJECT_SERIAL]
           ,[PAPER_SERIAL]
           ,[MASTER_ID]
           ,[EXTERNAL_ID]
           ,[COURSE_ID]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[ROLL_NO]
           ,[PAPER_CODE]
           ,[CATCH_CODE]
           ,[SUBJECT_NAME]
           ,[PAPER_NAME]
           ,[THEORY_OBT]
           ,[INTERNAL_OBT]
           ,[SESSIONAL_OBT]
           ,[TOTAL_OBT]
           ,[PAPER_STATUS]
           ,[SUBJECT_CODE]
           ,[SUBJECT_TYPE]
           ,[SUBJECT_TYPE_SERIAL]
           ,[CREDIT]
           ,[EARNED_CREDIT]
           ,[POINT]
           ,[GRADE_POINT]
           ,[GRADE]
           ,[THEORY_MAX]
           ,[THEORY_MIN]
           ,[THEORY_GRACE]
           ,[THEORY_PRACT_ABSENT]
           ,[PRACTICAL_MAX]
           ,[PRACTICAL_MIN]
           ,[PRACTICAL_OBT]
           ,[PRACTICAL_ABSENT]
           ,[INTERNAL_MAX]
           ,[INTERNAL_MIN]
           ,[INTERNAL_ABSENT]
           ,[SESSIONAL_MAX]
           ,[SESSIONAL_MIN]
           ,[SESSIONAL_ABSENT]
           ,[TOTAL_MAX]
           ,[TOTAL_MIN]
           ,[SUBJECT_GRACE]
           ,[SUBJECT_STATUS]
           ,[RE_EX]
           ,[OLD_MARKS]
           ,[BACK_POST_ID]
           ,[BARCODE]
           ,[OMR_FEE_PAID]
           ,[SCAN_IMAGE_PATH]
           ,[OMR_SERIES]
           ,[ANSWER_KEY_PATH]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_PRACT_MW]
           ,[INTERNAL_MW]
           ,[SESSIONAL_MW]
           ,[UFM]
           ,[SOURCE_TYPE]
           ,[CREDIT_POINT]
           ,[REMARKS]
           ,[BACK_POSTED]
           ,[IS_INTERNAL_RECEIVED]
         
         )


SELECT      [RESULT_ID]
           ,[MARKS_ID]
           ,[SUBJECT_SERIAL]
           ,[PAPER_SERIAL]
           ,[MASTER_ID]
           ,[EXTERNAL_ID]
           ,[COURSE_ID]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[ROLL_NO]
           ,[PAPER_CODE]
           ,[CATCH_CODE]
           ,[SUBJECT_NAME]
           ,[PAPER_NAME]
           ,[THEORY_OBT]
           ,[INTERNAL_OBT]
           ,[SESSIONAL_OBT]
           ,[TOTAL_OBT]
           ,[PAPER_STATUS]
           ,[SUBJECT_CODE]
           ,[SUBJECT_TYPE]
           ,[SUBJECT_TYPE_SERIAL]
           ,[CREDIT]
           ,[EARNED_CREDIT]
           ,[POINT]
           ,[GRADE_POINT]
           ,[GRADE]
           ,[THEORY_MAX]
           ,[THEORY_MIN]
           ,[THEORY_GRACE]
           ,[THEORY_PRACT_ABSENT]
           ,[PRACTICAL_MAX]
           ,[PRACTICAL_MIN]
           ,[PRACTICAL_OBT]
           ,[PRACTICAL_ABSENT]
           ,[INTERNAL_MAX]
           ,[INTERNAL_MIN]
           ,[INTERNAL_ABSENT]
           ,[SESSIONAL_MAX]
           ,[SESSIONAL_MIN]
           ,[SESSIONAL_ABSENT]
           ,[TOTAL_MAX]
           ,[TOTAL_MIN]
           ,[SUBJECT_GRACE]
           ,[SUBJECT_STATUS]
           ,[RE_EX]
           ,[OLD_MARKS]
           ,[BACK_POST_ID]
           ,[BARCODE]
           ,[OMR_FEE_PAID]
           ,[SCAN_IMAGE_PATH]
           ,[OMR_SERIES]
           ,[ANSWER_KEY_PATH]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,GETDATE()
           ,'1000'
           ,[IS_ACTIVE]
           ,[THEORY_PRACT_MW]
           ,[INTERNAL_MW]
           ,[SESSIONAL_MW]
           ,[UFM]
           ,[SOURCE_TYPE]
           ,[CREDIT_POINT]
           ,[REMARKS]
           ,[BACK_POSTED]
           ,[IS_INTERNAL_RECEIVED]
           FROM  STUDENT_MARKS_LOCAL_LOG

           SELECT @ROWCOUNT=@@ROWCOUNT

  END

 /*----------------------------------------------END STUDENT_MARKS MERGE--------------------------------*/




 IF EXISTS( SELECT 1 FROM STUDENT_RESULT_LOCAL_LOG)
 BEGIN
 MERGE INTO dbo.STUDENT_RESULT AS M
    USING dbo.STUDENT_RESULT_LOCAL_LOG AS R
    ON M.ROLL_NO = R.ROLL_NO
    AND	M.RESULT_ID=R.RESULT_ID
    AND M.COURSE_ID = R.COURSE_ID
    AND M.SESSION = R.SESSION
    AND M.HELD_IN = R.HELD_IN

WHEN MATCHED THEN
	
    UPDATE SET
	   M.[RESULT_ID] = R.RESULT_ID
      ,M.[MASTER_ID] = R.MASTER_ID
      ,M.[SOURCE_TYPE] = R.SOURCE_TYPE
      ,M.[ROLL_NO] = R.ROLL_NO
      ,M.[COURSE_ID] = R.COURSE_ID
      ,M.[RESULT_TYPE] = R.RESULT_TYPE
      ,M.[EXAM_TYPE] = R.EXAM_TYPE
      ,M.[SESSION] = R.SESSION
      ,M.[YEAR_SEM] = R.YEAR_SEM
      ,M.[COLLEGE_CODE] = R.COLLEGE_CODE
      ,M.[IS_HISTORY] = R.IS_HISTORY
      ,M.[SEMESTER_RESULT] = R.SEMESTER_RESULT
      ,M.[FINAL_RESULT] = R.FINAL_RESULT
      ,M.[WING_TYPE_CODE] = R.WING_TYPE_CODE
      ,M.[THEORY_MAX_MARKS] = R.THEORY_MAX_MARKS
      ,M.[THEORY_MIN_MARKS] = R.THEORY_MIN_MARKS
      ,M.[THEORY_OBT_MARKS] = R.THEORY_OBT_MARKS
      ,M.[TOTAL_MAJOR_CREDIT] = R.TOTAL_MAJOR_CREDIT
      ,M.[TOTAL_MAJOR_EARN_CREDIT] = R.TOTAL_MAJOR_EARN_CREDIT
      ,M.[TOTAL_CREDIT] = R.TOTAL_CREDIT
      ,M.[EARNED_CREDIT] = R.EARNED_CREDIT
      ,M.[TOTAL_POINT] = R.TOTAL_POINT
      ,M.[TOTAL_GRADE_POINT] = R.TOTAL_GRADE_POINT
      ,M.[SGPA] = R.SGPA
      ,M.[PRACTICAL_MAX_MARKS] = R.PRACTICAL_MAX_MARKS
      ,M.[PRACTICAL_MIN_MARKS] = R.PRACTICAL_MIN_MARKS
      ,M.[PRACTICAL_OBT_MARKS] = R.PRACTICAL_OBT_MARKS
      ,M.[INTERNAL_MAX_MARKS] = R.INTERNAL_MAX_MARKS
      ,M.[INTERNAL_MIN_MARKS] = R.INTERNAL_MIN_MARKS
      ,M.[INTERNAL_OBT_MARKS] = R.INTERNAL_OBT_MARKS
      ,M.[SESSIONAL_MAX_MARKS] = R.SESSIONAL_MAX_MARKS
      ,M.[SESSIONAL_MIN_MARKS] = R.SESSIONAL_MIN_MARKS
      ,M.[SESSIONAL_OBT_MARKS] = R.SESSIONAL_OBT_MARKS
      ,M.[TOTAL_MAX_MARKS] = R.TOTAL_MAX_MARKS
      ,M.[TOTAL_MIN_MARKS] = R.TOTAL_MIN_MARKS
      ,M.[TOTAL_OBT_MARKS] = R.TOTAL_OBT_MARKS
      ,M.[GRAND_MAX_MARKS] = R.GRAND_MAX_MARKS
      ,M.[GRAND_MIN_MARKS] = R.GRAND_MIN_MARKS
      ,M.[GRAND_OBT_MARKS] = R.GRAND_OBT_MARKS
      ,M.[RG_CODE] = R.RG_CODE
      ,M.[RG_MAX_MARKS] = R.RG_MAX_MARKS
      ,M.[RG_MIN_MARKS] = R.RG_MIN_MARKS
      ,M.[RG_OBT_MARKS] = R.RG_OBT_MARKS
      ,M.[RG_RESULT] = R.RG_RESULT
      ,M.[ES_CODE] = R.ES_CODE
      ,M.[ES_MAX_MARKS] = R.ES_MAX_MARKS
      ,M.[ES_MIN_MARKS] = R.ES_MIN_MARKS
      ,M.[ES_OBT_MARKS] = R.ES_OBT_MARKS
      ,M.[ES_RESULT] = R.ES_RESULT
      ,M.[CO_CURRICULAR_RESULT] = R.CO_CURRICULAR_RESULT
      ,M.[FINAL_DIVISION] = R.FINAL_DIVISION
      ,M.[PRACTICAL_RESULT] = R.PRACTICAL_RESULT
      ,M.[PRACTICAL_DIVISION] = R.PRACTICAL_DIVISION
      ,M.[PROMOTED] = R.PROMOTED
      ,M.[CUM_TOTAL_MIN] = R.CUM_TOTAL_MIN
      ,M.[CUM_TOTAL_OBT] = R.CUM_TOTAL_OBT
      ,M.[CUM_TOTAL_CREDIT] = R.CUM_TOTAL_CREDIT
      ,M.[CUM_TOTAL_EARNED_CREDIT] = R.CUM_TOTAL_EARNED_CREDIT
      ,M.[CUM_TOTAL_POINT] = R.CUM_TOTAL_POINT
      ,M.[CUM_TOTAL_GRADE_POINT] = R.CUM_TOTAL_GRADE_POINT
      ,M.[CGPA] = R.CGPA
      ,M.[EXAM_NAME] = R.EXAM_NAME
      ,M.[HELD_IN] = R.HELD_IN
      ,M.[PRINT_LOT_NO] = R.PRINT_LOT_NO
      ,M.[RESULT_DATE] = R.RESULT_DATE
      ,M.[IS_PUBLISHED] = 2
      ,M.[PUBLISH_DATE] = R.PUBLISH_DATE
      ,M.[LAST_ORDINANCE_RUN_AT] = R.LAST_ORDINANCE_RUN_AT
      ,M.[CREATED_AT] = R.CREATED_AT
      ,M.[CREATED_BY] = R.CREATED_BY
      ,M.[LAST_UPDATED_AT] = GETDATE()
      ,M.[LAST_UPDATED_BY] = 1000
      ,M.[IS_ACTIVE] = R.IS_ACTIVE
      ,M.[THEORY_DIVISION] = R.THEORY_DIVISION
      ,M.[MARKSHEET_NO] = R.MARKSHEET_NO
      ,M.[IS_PENDING_SYNC] = R.IS_PENDING_SYNC
      ,M.[SYNC_DATE] =GETDATE()
      ,M.[IS_LIVE] = 1
      ,M.[IS_UFM] = R.IS_UFM
      ,M.[ORDINANCE_ID] = R.ORDINANCE_ID
      ,M.[ERROR_DETAILS] = R.ERROR_DETAILS


WHEN NOT MATCHED THEN
    INSERT 
    (
      [RESULT_ID],
      [MASTER_ID],
      [SOURCE_TYPE],
      [ROLL_NO],
      [COURSE_ID],
      [RESULT_TYPE],
      [EXAM_TYPE],
      [SESSION],
      [YEAR_SEM],
      [COLLEGE_CODE],
      [IS_HISTORY],
      [SEMESTER_RESULT],
      [FINAL_RESULT],
      [WING_TYPE_CODE],
      [THEORY_MAX_MARKS],
      [THEORY_MIN_MARKS],
      [THEORY_OBT_MARKS],
      [TOTAL_MAJOR_CREDIT],
      [TOTAL_MAJOR_EARN_CREDIT],
      [TOTAL_CREDIT],
      [EARNED_CREDIT],
      [TOTAL_POINT],
      [TOTAL_GRADE_POINT],
      [SGPA],
      [PRACTICAL_MAX_MARKS],
      [PRACTICAL_MIN_MARKS],
      [PRACTICAL_OBT_MARKS],
      [PRACTICAL_RESULT],
      [PRACTICAL_DIVISION],
      [INTERNAL_MAX_MARKS],
      [INTERNAL_MIN_MARKS],
      [INTERNAL_OBT_MARKS],
      [SESSIONAL_MAX_MARKS],
      [SESSIONAL_MIN_MARKS],
      [SESSIONAL_OBT_MARKS],
      [TOTAL_MAX_MARKS],
      [TOTAL_MIN_MARKS],
      [TOTAL_OBT_MARKS],
      [GRAND_MAX_MARKS],
      [GRAND_MIN_MARKS],
      [GRAND_OBT_MARKS],
      [RG_CODE],
      [RG_MAX_MARKS],
      [RG_MIN_MARKS],
      [RG_OBT_MARKS],
      [RG_RESULT],
      [ES_CODE],
      [ES_MAX_MARKS],
      [ES_MIN_MARKS],
      [ES_OBT_MARKS],
      [ES_RESULT],
      [CO_CURRICULAR_RESULT],
      [FINAL_DIVISION],
      [PROMOTED],
      [CUM_TOTAL_MAX],
      [CUM_TOTAL_MIN],
      [CUM_TOTAL_OBT],
      [CUM_TOTAL_CREDIT],
      [CUM_TOTAL_EARNED_CREDIT],
      [CUM_TOTAL_POINT],
      [CUM_TOTAL_GRADE_POINT],
      [CGPA],
      [EXAM_NAME],
      [HELD_IN],
      [PRINT_LOT_NO],
      [RESULT_DATE],
      [IS_PUBLISHED],
      [PUBLISH_DATE],
      [LAST_ORDINANCE_RUN_AT],
      [CREATED_AT],
      [CREATED_BY],
      [LAST_UPDATED_AT],
      [LAST_UPDATED_BY],
      [IS_ACTIVE],
      [THEORY_DIVISION],
      [MARKSHEET_NO],
      [IS_PENDING_SYNC],
      [SYNC_DATE],
      [ERROR_DETAILS],
      [IS_LIVE],
      [IS_UFM],
      [ORDINANCE_ID],GROUPID
    )
    VALUES
    (
      R.[RESULT_ID],
      R.[MASTER_ID],
      R.[SOURCE_TYPE],
      R.[ROLL_NO],
      R.[COURSE_ID],
      R.[RESULT_TYPE],
      R.[EXAM_TYPE],
      R.[SESSION],
      R.[YEAR_SEM],
      R.[COLLEGE_CODE],
      R.[IS_HISTORY],
      R.[SEMESTER_RESULT],
      R.[FINAL_RESULT],
      R.[WING_TYPE_CODE],
      R.[THEORY_MAX_MARKS],
      R.[THEORY_MIN_MARKS],
      R.[THEORY_OBT_MARKS],
      R.[TOTAL_MAJOR_CREDIT],
      R.[TOTAL_MAJOR_EARN_CREDIT],
      R.[TOTAL_CREDIT],
      R.[EARNED_CREDIT],
      R.[TOTAL_POINT],
      R.[TOTAL_GRADE_POINT],
      R.[SGPA],
      R.[PRACTICAL_MAX_MARKS],
      R.[PRACTICAL_MIN_MARKS],
      R.[PRACTICAL_OBT_MARKS],
      R.[PRACTICAL_RESULT],
      R.[PRACTICAL_DIVISION],
      R.[INTERNAL_MAX_MARKS],
      R.[INTERNAL_MIN_MARKS],
      R.[INTERNAL_OBT_MARKS],
      R.[SESSIONAL_MAX_MARKS],
      R.[SESSIONAL_MIN_MARKS],
      R.[SESSIONAL_OBT_MARKS],
      R.[TOTAL_MAX_MARKS],
      R.[TOTAL_MIN_MARKS],
      R.[TOTAL_OBT_MARKS],
      R.[GRAND_MAX_MARKS],
      R.[GRAND_MIN_MARKS],
      R.[GRAND_OBT_MARKS],
      R.[RG_CODE],
      R.[RG_MAX_MARKS],
      R.[RG_MIN_MARKS],
      R.[RG_OBT_MARKS],
      R.[RG_RESULT],
      R.[ES_CODE],
      R.[ES_MAX_MARKS],
      R.[ES_MIN_MARKS],
      R.[ES_OBT_MARKS],
      R.[ES_RESULT],
      R.[CO_CURRICULAR_RESULT],
      R.[FINAL_DIVISION],
      R.[PROMOTED],
      R.[CUM_TOTAL_MAX],
      R.[CUM_TOTAL_MIN],
      R.[CUM_TOTAL_OBT],
      R.[CUM_TOTAL_CREDIT],
      R.[CUM_TOTAL_EARNED_CREDIT],
      R.[CUM_TOTAL_POINT],
      R.[CUM_TOTAL_GRADE_POINT],
      R.[CGPA],
      R.[EXAM_NAME],
      R.[HELD_IN],
      R.[PRINT_LOT_NO],
      R.[RESULT_DATE],
                    2,
      R.[PUBLISH_DATE],
      R.[LAST_ORDINANCE_RUN_AT],
      R.[CREATED_AT],
      R.[CREATED_BY],
           GETDATE(),      -- LAST_UPDATED_AT
             1000,           -- LAST_UPDATED_BY
      R.[IS_ACTIVE],
      R.[THEORY_DIVISION],
      R.[MARKSHEET_NO],
      R.[IS_PENDING_SYNC],
        GETDATE(),
      R.[ERROR_DETAILS],
          1   ,
      R.[IS_UFM],
      R.[ORDINANCE_ID],GROUPID
    );


 SELECT @ROWCOUNT=@@ROWCOUNT


 END 



 COMMIT TRAN 
 END TRY 
 BEGIN CATCH
 ROLLBACK TRAN 
 SET @ROWCOUNT=-1
 END CATCH

  SELECT @ROWCOUNT

   TRUNCATE TABLE [STUDENT_MARKS_LOG]
   TRUNCATE TABLE  STUDENT_RESULT_LOG

GO
/****** Object:  StoredProcedure [dbo].[UPDATE_STUDENT_CONSOLIDATE]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROC  [dbo].[UPDATE_STUDENT_CONSOLIDATE]       
  (      
      @TBLRESULTDATA    RESULT_USERS_TBLTYPE  READONLY      
     ,@COURSE_ID INT       
     ,@RESULT_TYPE_ID INT       
        
  )      
       
 AS       
      
 --DECLARE @YEAR_SEM INT       
 --SELECT @YEAR_SEM=SEM_NO FROM AGRA_MASTER.DBO.COURSE_MASTER WHERE COURSE_ID=@COURSE_ID      
 --select * from @TBLRESULTDATA  
   
  
   UPDATE B SET        
     B.OBT_MARKS_1=IIF(SR.COURSE_ID=141,SR.THEORY_OBT_MARKS,SR.TOTAL_OBT_MARKS) ,    
     B.MAX_MARKS_1=IIF(SR.COURSE_ID=141,SR.THEORY_MAX_MARKS,ISNULL( SR.TOTAL_MAX_MARKS,0)),      
     B.MIN_MARKS_1=IIF(SR.COURSE_ID=141,SR.THEORY_MIN_MARKS,ISNULL( SR.TOTAL_MIN_MARKS,0)),     
     B.TOTAL_GP_1= IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_GRADE_POINT ),       
     B.SGPA_1= IIF(@RESULT_TYPE_ID =1,0,SR.SGPA ),      
     B.TOTAL_CREDIT_1=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_CREDIT  ),     
     B.EARN_CREDIT_1=IIF(@RESULT_TYPE_ID =1,0,SR.EARNED_CREDIT ),      
     B.MAJOR_CR_1=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_CREDIT),      
     B.MAJOR_ER_1=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_EARN_CREDIT),      
     B.PRACTICAL_MAX_1  =SR.PRACTICAL_MAX_MARKS,      
     B.PRACTICAL_MIN_1  =SR.PRACTICAL_MIN_MARKS,     
     B.PRACTICAL_OBT_1  =SR.PRACTICAL_OBT_MARKS,     
     B.UPDATEON=GETDATE(),      
     B.RESULTSTATUS=  IIF((SR.SEMESTER_RESULT IS NOT NULL AND  SR.SEMESTER_RESULT='PASS'), B.RESULTSTATUS| POWER(2,YEAR_SEM-1),  B.RESULTSTATUS & (B.RESULTSTATUS ^  PowER(2, YEAR_SEM - 1)))  
   
      FROM  STUDENT_RESULT SR       
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.ROLL_NO=B.ROLL_NO    
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
     ON C.COURSE_ID=T.COURSE_ID   
     AND SR.MASTER_ID=T.MASTER_ID     
     AND B.MASTER_ID=T.MASTER_ID  
     WHERE   IS_HISTORY=0      
     AND SR.YEAR_SEM=1   
    
      
    UPDATE B SET  B.MINOR_I_YEAR= IIF(S.PAPER_STATUS='PASS','PASS',NULL),      
     B.UPDATEON=GETDATE()    
     FROM  STUDENT_MARKS S       
     INNER JOIN STUDENT_RESULT SR      
     ON  S.MASTER_ID=SR.MASTER_ID      
     AND S.RESULT_ID=SR.RESULT_ID      
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.MASTER_ID=S.MASTER_ID      
     AND SR.ROLL_NO=B.ROLL_NO      
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
     ON C.COURSE_ID=T.COURSE_ID   
     AND SR.MASTER_ID=T.MASTER_ID     
     AND B.MASTER_ID=T.MASTER_ID  
  
     WHERE  SR.COURSE_ID= @COURSE_ID       
     AND  IS_HISTORY=0      
     AND  SUBJECT_TYPE='MINOR' AND  PAPER_STATUS='PASS' AND( CATCH_CODE IS NOT NULL   AND LEN(CATCH_CODE)>1)      
     AND SR.YEAR_SEM=1         
           
       
    
          
 /*-------------------------UPDATE CONSOLIDATE -------------------------------------------------------*/      
      
     UPDATE   B SET  B.OBT_MARKS_2=IIF(@COURSE_ID=142,SR.THEORY_OBT_MARKS ,  SR.TOTAL_OBT_MARKS),       
     B.MAX_MARKS_2=IIF(@COURSE_ID=142,SR.THEORY_MAX_MARKS ,ISNULL(SR.TOTAL_MAX_MARKS,0)),      
     B.MIN_MARKS_2=IIF(@COURSE_ID=142,SR.THEORY_MIN_MARKS , ISNULL( SR.TOTAL_MIN_MARKS,0)),     
     B.TOTAL_GP_2= IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_GRADE_POINT ),       
     B.SGPA_2= IIF(@RESULT_TYPE_ID =1,0,SR.SGPA ),      
     B.TOTAL_CREDIT_2=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_CREDIT  ),     
     B.EARN_CREDIT_2=IIF(@RESULT_TYPE_ID =1,0,SR.EARNED_CREDIT ),      
     B.MAJOR_CR_2=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_CREDIT),      
     B.MAJOR_ER_2=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_EARN_CREDIT),
     
     B.PRACTICAL_MAX_2  =SR.PRACTICAL_MAX_MARKS,      
     B.PRACTICAL_MIN_2  =SR.PRACTICAL_MIN_MARKS,     
     B.PRACTICAL_OBT_2  =SR.PRACTICAL_OBT_MARKS,     
     B.UPDATEON=GETDATE(),      
     B.RESULTSTATUS=  IIF((SR.SEMESTER_RESULT IS NOT NULL AND  SR.SEMESTER_RESULT='PASS'), B.RESULTSTATUS| POWER(2,YEAR_SEM-1),  B.RESULTSTATUS & (B.RESULTSTATUS ^  PowER(2, YEAR_SEM - 1)))      
      
     FROM STUDENT_RESULT SR       
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.ROLL_NO=B.ROLL_NO      
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
     ON C.COURSE_ID=T.COURSE_ID   
     AND SR.MASTER_ID=T.MASTER_ID     
     AND B.MASTER_ID=T.MASTER_ID  
     WHERE  IS_HISTORY=0      
     AND SR.YEAR_SEM=2     
         
      
       UPDATE B SET  B.MINOR_I_YEAR= IIF(S.PAPER_STATUS='PASS','PASS',NULL),      
       B.UPDATEON=GETDATE()      
       FROM  STUDENT_MARKS S       
       INNER JOIN STUDENT_RESULT SR      
       ON S.MASTER_ID=SR.MASTER_ID      
       AND S.RESULT_ID=SR.RESULT_ID      
       INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
       ON SR.MASTER_ID=S.MASTER_ID      
       AND SR.ROLL_NO=B.ROLL_NO    
       INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
       ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
       INNER JOIN       
       @TBLRESULTDATA T       
       ON C.COURSE_ID=T.COURSE_ID   
       AND SR.MASTER_ID=T.MASTER_ID     
       AND B.MASTER_ID=T.MASTER_ID  
       WHERE    
       IS_HISTORY=0      
       AND  SUBJECT_TYPE='MINOR' AND  PAPER_STATUS='PASS' AND( CATCH_CODE IS NOT NULL   AND LEN(CATCH_CODE)>1)      
       AND SR.YEAR_SEM=2     
      
         
   
      
  UPDATE   B SET  B.OBT_MARKS_3=SR.TOTAL_OBT_MARKS,       
      B.TOTAL_GP_3= IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_GRADE_POINT ),       
     B.SGPA_3= IIF(@RESULT_TYPE_ID =1,0,SR.SGPA ),      
     B.TOTAL_CREDIT_3=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_CREDIT  ),     
     B.EARN_CREDIT_3=IIF(@RESULT_TYPE_ID =1,0,SR.EARNED_CREDIT ),      
     B.MAJOR_CR_3=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_CREDIT),      
     B.MAJOR_ER_3=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_EARN_CREDIT),      
     B.MAX_MARKS_3=ISNULL(SR.TOTAL_MAX_MARKS,0),      
     B.MIN_MARKS_3=ISNULL(SR.TOTAL_MIN_MARKS,0),      
     B.PRACTICAL_MAX_3  =SR.PRACTICAL_MAX_MARKS,      
     B.PRACTICAL_MIN_3  =SR.PRACTICAL_MIN_MARKS,     
     B.PRACTICAL_OBT_3  =SR.PRACTICAL_OBT_MARKS,     
     B.UPDATEON=GETDATE(),      
     B.RESULTSTATUS= IIF((SR.SEMESTER_RESULT IS NOT NULL AND  SR.SEMESTER_RESULT='PASS'), B.RESULTSTATUS| POWER(2,YEAR_SEM-1),  B.RESULTSTATUS & (B.RESULTSTATUS ^  PowER(2, YEAR_SEM - 1)))      
    ,B.ISRE_LIVE=1       
     FROM STUDENT_RESULT SR       
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.ROLL_NO=B.ROLL_NO      
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
  
      INNER JOIN       
      @TBLRESULTDATA T       
      ON C.COURSE_ID=T.COURSE_ID   
      AND SR.MASTER_ID=T.MASTER_ID     
      AND B.MASTER_ID=T.MASTER_ID  
      WHERE   IS_HISTORY=0    
      AND SR.YEAR_SEM=3      
       
     UPDATE B SET  B.MINOR_II_YEAR= IIF(S.PAPER_STATUS='PASS','PASS',NULL)      
     FROM  STUDENT_MARKS S       
     INNER JOIN STUDENT_RESULT SR      
     ON   S.MASTER_ID=SR.MASTER_ID      
     AND S.RESULT_ID=SR.RESULT_ID   
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.MASTER_ID=S.MASTER_ID      
     AND SR.ROLL_NO=B.ROLL_NO      
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
     ON C.COURSE_ID=T.COURSE_ID   
     AND SR.MASTER_ID=T.MASTER_ID     
     AND B.MASTER_ID=T.MASTER_ID    
     WHERE IS_HISTORY=0      
      
      AND  SUBJECT_TYPE='MINOR' AND  PAPER_STATUS='PASS' AND( CATCH_CODE IS NOT NULL   AND LEN(CATCH_CODE)>1)      
      AND SR.YEAR_SEM=3    
       
      
   UPDATE   B SET   
     B.OBT_MARKS_4=SR.TOTAL_OBT_MARKS,       
      B.TOTAL_GP_4= IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_GRADE_POINT ),       
     B.SGPA_4= IIF(@RESULT_TYPE_ID =1,0,SR.SGPA ),      
     B.TOTAL_CREDIT_4=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_CREDIT  ),     
     B.EARN_CREDIT_4=IIF(@RESULT_TYPE_ID =1,0,SR.EARNED_CREDIT ),      
     B.MAJOR_CR_4=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_CREDIT),      
     B.MAJOR_ER_4=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_EARN_CREDIT),     
     B.MAX_MARKS_4=ISNULL(SR.TOTAL_MAX_MARKS,0),      
     B.MIN_MARKS_4=ISNULL(SR.TOTAL_MIN_MARKS,0),      
     B.PRACTICAL_MAX_4  =SR.PRACTICAL_MAX_MARKS,      
     B.PRACTICAL_MIN_4  =SR.PRACTICAL_MIN_MARKS,     
     B.PRACTICAL_OBT_4  =SR.PRACTICAL_OBT_MARKS,     
     B.UPDATEON=GETDATE(),      
     B.RESULTSTATUS= IIF((SR.SEMESTER_RESULT IS NOT NULL AND  SR.SEMESTER_RESULT='PASS'), B.RESULTSTATUS| POWER(2,YEAR_SEM-1),  B.RESULTSTATUS & (B.RESULTSTATUS ^  PowER(2, YEAR_SEM - 1)))      
    ,B.ISRE_LIVE=1      
          
     FROM STUDENT_RESULT SR       
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.ROLL_NO=B.ROLL_NO      
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
     ON C.COURSE_ID=T.COURSE_ID   
     AND SR.MASTER_ID=T.MASTER_ID     
     AND B.MASTER_ID=T.MASTER_ID      
     WHERE  IS_HISTORY=0      
     AND SR.YEAR_SEM=4    
       
      
       UPDATE B SET  B.MINOR_II_YEAR= IIF(S.PAPER_STATUS='PASS','PASS',NULL)      
        FROM  STUDENT_MARKS S       
        INNER JOIN STUDENT_RESULT SR      
        ON S.MASTER_ID=SR.MASTER_ID      
        AND S.RESULT_ID=SR.RESULT_ID      
        INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
        ON SR.MASTER_ID=S.MASTER_ID      
        AND SR.ROLL_NO=B.ROLL_NO      
        INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
        ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
        INNER JOIN       
        @TBLRESULTDATA T       
        ON C.COURSE_ID=T.COURSE_ID   
        AND SR.MASTER_ID=T.MASTER_ID     
        AND B.MASTER_ID=T.MASTER_ID      
        WHERE  SR.COURSE_ID= @COURSE_ID       
        AND  IS_HISTORY=0      
        AND  SUBJECT_TYPE='MINOR' AND  PAPER_STATUS='PASS' AND( CATCH_CODE IS NOT NULL   AND LEN(CATCH_CODE)>1)      
        AND SR.YEAR_SEM=4    
             
         
        
 
  UPDATE   B SET  B.OBT_MARKS_5=SR.TOTAL_OBT_MARKS,       
      B.TOTAL_GP_5= IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_GRADE_POINT ),       
     B.SGPA_5= IIF(@RESULT_TYPE_ID =1,0,SR.SGPA ),      
     B.TOTAL_CREDIT_5=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_CREDIT  ),     
     B.EARN_CREDIT_5=IIF(@RESULT_TYPE_ID =1,0,SR.EARNED_CREDIT ),      
     B.MAJOR_CR_5=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_CREDIT),      
     B.MAJOR_ER_5=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_EARN_CREDIT),    
     B.MAX_MARKS_5=ISNULL(SR.TOTAL_MAX_MARKS,0),      
     B.MIN_MARKS_5=ISNULL(SR.TOTAL_MIN_MARKS,0),      
     B.UPDATEON=GETDATE(),      
     B.RESULTSTATUS= IIF((SR.SEMESTER_RESULT IS NOT NULL AND  SR.SEMESTER_RESULT='PASS'), B.RESULTSTATUS| POWER(2,YEAR_SEM-1),  B.RESULTSTATUS & (B.RESULTSTATUS ^  PowER(2, YEAR_SEM - 1)))      
    ,B.ISRE_LIVE=1      
           
      FROM STUDENT_RESULT SR       
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.ROLL_NO=B.ROLL_NO      
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
      ON C.COURSE_ID=T.COURSE_ID   
        AND SR.MASTER_ID=T.MASTER_ID     
        AND B.MASTER_ID=T.MASTER_ID       
     WHERE  IS_HISTORY=0      
     AND SR.YEAR_SEM=5   
     
  UPDATE   B SET   
     B.OBT_MARKS_6=SR.TOTAL_OBT_MARKS,       
     B.TOTAL_GP_6= IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_GRADE_POINT ),       
     B.SGPA_6= IIF(@RESULT_TYPE_ID =1,0,SR.SGPA ),      
     B.TOTAL_CREDIT_6=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_CREDIT  ),     
     B.EARN_CREDIT_6=IIF(@RESULT_TYPE_ID =1,0,SR.EARNED_CREDIT ),      
     B.MAJOR_CR_6=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_CREDIT),      
     B.MAJOR_ER_6=IIF(@RESULT_TYPE_ID =1,0,SR.TOTAL_MAJOR_EARN_CREDIT),
     B.MAX_MARKS_6=ISNULL(SR.TOTAL_MAX_MARKS,0),      
     B.MIN_MARKS_6=ISNULL(SR.TOTAL_MIN_MARKS,0),      
     B.UPDATEON=GETDATE(),      
     B.RESULTSTATUS= IIF((SR.SEMESTER_RESULT IS NOT NULL AND  SR.SEMESTER_RESULT='PASS'), B.RESULTSTATUS| POWER(2,YEAR_SEM-1),  B.RESULTSTATUS & (B.RESULTSTATUS ^  PowER(2, YEAR_SEM - 1)))      
     FROM STUDENT_RESULT SR       
     INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
     ON SR.ROLL_NO=B.ROLL_NO      
     INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
      ON C.COURSE_ID=T.COURSE_ID   
        AND SR.MASTER_ID=T.MASTER_ID     
        AND B.MASTER_ID=T.MASTER_ID         
     WHERE       
        IS_HISTORY=0      
     AND SR.YEAR_SEM=6   
        
        
 UPDATE B SET B.QUALIFYING_RESEARCH=  IIF ( Grade NOT IN( 'AB','F') ,  B.QUALIFYING_RESEARCH| POWER(2,SR.YEAR_SEM-1), B.QUALIFYING_RESEARCH & (B.QUALIFYING_RESEARCH ^  PowER(2, SR.YEAR_SEM - 1))  )        
  FROM  STUDENT_MARKS S       
  INNER JOIN STUDENT_RESULT SR      
  ON   S.MASTER_ID=SR.MASTER_ID      
  AND  S.RESULT_ID=SR.RESULT_ID       
  INNER JOIN PAPER_MASTER P       
  ON S.PAPER_CODE=P.PAPER_CODE_PK      
  INNER JOIN CONSOLIDATE_RESULT_DATA.dbo.STUDENT_CONSOLIDATE_RESULT B      
  ON SR.MASTER_ID=S.MASTER_ID      
  AND SR.ROLL_NO=B.ROLL_NO      
  INNER JOIN AGRA_MASTER.DBO.COURSE_MASTER C  
     ON B.COURSE_ID_MAIN=C.COURSE_ID_MAIN  
     INNER JOIN       
     @TBLRESULTDATA T       
      ON C.COURSE_ID=T.COURSE_ID   
        AND SR.MASTER_ID=T.MASTER_ID     
        AND B.MASTER_ID=T.MASTER_ID         
  WHERE        
     IS_HISTORY=0      
  AND  PAPER_TYPE = 'R'          
  AND SR.YEAR_SEM=6     
         
      
      
 ;      
       
       
GO
/****** Object:  StoredProcedure [dbo].[USP_SYNC_MARKS_RESULT_DEMO_ERP]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[USP_SYNC_MARKS_RESULT_DEMO_ERP]  
	 @COURSE_ID INT=0,
	 @HELD_IN VARCHAR(50),
	 @ROLL_NO VARCHAR(max),
	 @EXAMTPYENAME VARCHAR(50),
	 @SESSIONNAME VARCHAR(50)
AS  

  
--------//  
   
BEGIN  
	  PRINT ''

END  
GO
/****** Object:  StoredProcedure [dbo].[USP_SYNC_MARKS_RESULT_DEMO_LIVE]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE PROC [dbo].[USP_SYNC_MARKS_RESULT_DEMO_LIVE]
(
  @COURSE_ID INT =282
 ,@HELD_IN VARCHAR(20) ='DEC-2022'
 ,@SESSION VARCHAR(20) ='2022-23'
 ,@ROLL_NO VARCHAR(8000)=''
 ,@MERGE_MARKS BIT=1
 ,@MERGE_RESULT BIT=1
)
AS

BEGIN TRAN

 BEGIN TRY


IF(@MERGE_MARKS =1)
 BEGIN 
   INSERT INTO [103.115.194.115,9162].AGRA_RESULT_DEMO.[dbo].STUDENT_MARKS_MERGE
           (
            [RESULT_ID]
           ,[MARKS_ID]
           ,[SUBJECT_SERIAL]
           ,[PAPER_SERIAL]
           ,[MASTER_ID]
           ,[EXTERNAL_ID]
           ,[COURSE_ID]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[ROLL_NO]
           ,[PAPER_CODE]
           ,[CATCH_CODE]
           ,[SUBJECT_NAME]
           ,[PAPER_NAME]
           ,[THEORY_OBT]
           ,[INTERNAL_OBT]
           ,[SESSIONAL_OBT]
           ,[TOTAL_OBT]
           ,[PAPER_STATUS]
           ,[SUBJECT_CODE]
           ,[SUBJECT_TYPE]
           ,[SUBJECT_TYPE_SERIAL]
           ,[CREDIT]
           ,[EARNED_CREDIT]
           ,[POINT]
           ,[GRADE_POINT]
           ,[GRADE]
           ,[THEORY_MAX]
           ,[THEORY_MIN]
           ,[THEORY_GRACE]
           ,[THEORY_PRACT_ABSENT]
           ,[PRACTICAL_MAX]
           ,[PRACTICAL_MIN]
           ,[PRACTICAL_OBT]
           ,[PRACTICAL_ABSENT]
           ,[INTERNAL_MAX]
           ,[INTERNAL_MIN]
           ,[INTERNAL_ABSENT]
           ,[SESSIONAL_MAX]
           ,[SESSIONAL_MIN]
           ,[SESSIONAL_ABSENT]
           ,[TOTAL_MAX]
           ,[TOTAL_MIN]
           ,[SUBJECT_GRACE]
           ,[SUBJECT_STATUS]
           ,[RE_EX]
           ,[OLD_MARKS]
           ,[BACK_POST_ID]
           ,[BARCODE]
           ,[OMR_FEE_PAID]
           ,[SCAN_IMAGE_PATH]
           ,[OMR_SERIES]
           ,[ANSWER_KEY_PATH]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_PRACT_MW]
           ,[INTERNAL_MW]
           ,[SESSIONAL_MW]
           ,[UFM]
           ,[SOURCE_TYPE]
           ,[CREDIT_POINT]
           ,[REMARKS]
           ,[BACK_POSTED]
           ,[IS_INTERNAL_RECEIVED]
           
           )
            

SELECT      [RESULT_ID]
           ,[MARKS_ID]
           ,[SUBJECT_SERIAL]
           ,[PAPER_SERIAL]
           ,[MASTER_ID]
           ,[EXTERNAL_ID]
           ,[COURSE_ID]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[ROLL_NO]
           ,[PAPER_CODE]
           ,[CATCH_CODE]
           ,[SUBJECT_NAME]
           ,[PAPER_NAME]
           ,[THEORY_OBT]
           ,[INTERNAL_OBT]
           ,[SESSIONAL_OBT]
           ,[TOTAL_OBT]
           ,[PAPER_STATUS]
           ,[SUBJECT_CODE]
           ,[SUBJECT_TYPE]
           ,[SUBJECT_TYPE_SERIAL]
           ,[CREDIT]
           ,[EARNED_CREDIT]
           ,[POINT]
           ,[GRADE_POINT]
           ,[GRADE]
           ,[THEORY_MAX]
           ,[THEORY_MIN]
           ,[THEORY_GRACE]
           ,[THEORY_PRACT_ABSENT]
           ,[PRACTICAL_MAX]
           ,[PRACTICAL_MIN]
           ,[PRACTICAL_OBT]
           ,[PRACTICAL_ABSENT]
           ,[INTERNAL_MAX]
           ,[INTERNAL_MIN]
           ,[INTERNAL_ABSENT]
           ,[SESSIONAL_MAX]
           ,[SESSIONAL_MIN]
           ,[SESSIONAL_ABSENT]
           ,[TOTAL_MAX]
           ,[TOTAL_MIN]
           ,[SUBJECT_GRACE]
           ,[SUBJECT_STATUS]
           ,[RE_EX]
           ,[OLD_MARKS]
           ,[BACK_POST_ID]
           ,[BARCODE]
           ,[OMR_FEE_PAID]
           ,[SCAN_IMAGE_PATH]
           ,[OMR_SERIES]
           ,[ANSWER_KEY_PATH]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_PRACT_MW]
           ,[INTERNAL_MW]
           ,[SESSIONAL_MW]
           ,[UFM]
           ,[SOURCE_TYPE]
           ,[CREDIT_POINT]
           ,[REMARKS]
           ,[BACK_POSTED]
           ,[IS_INTERNAL_RECEIVED]
           FROM STUDENT_MARKS 
           WHERE COURSE_ID=@COURSE_ID
           AND SESSION=@SESSION
           AND RESULT_ID IN
            (
            SELECT RESULT_ID FROM STUDENT_RESULT
            WHERE COURSE_ID=@COURSE_ID
            AND SESSION=@SESSION
            AND HELD_IN=@HELD_IN
            AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR(LEN(@ROLL_NO)>0  AND  ROLL_NO IN ( SELECT VALUE FROM  string_split( @ROLL_NO,',')))  )
            )
   END 

 IF(@MERGE_RESULT =1)
 BEGIN 

 INSERT INTO [103.115.194.115,9162].AGRA_RESULT_DEMO.[dbo].[STUDENT_RESULT_MERGE]
           ([RESULT_ID]
           ,[MASTER_ID]
           ,[SOURCE_TYPE]
           ,[ROLL_NO]
           ,[COURSE_ID]
           ,[RESULT_TYPE]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[IS_HISTORY]
           ,[SEMESTER_RESULT]
           ,[FINAL_RESULT]
           ,[WING_TYPE_CODE]
           ,[THEORY_MAX_MARKS]
           ,[THEORY_MIN_MARKS]
           ,[THEORY_OBT_MARKS]
           ,[TOTAL_MAJOR_CREDIT]
           ,[TOTAL_MAJOR_EARN_CREDIT]
           ,[TOTAL_CREDIT]
           ,[EARNED_CREDIT]
           ,[TOTAL_POINT]
           ,[TOTAL_GRADE_POINT]
           ,[SGPA]
           ,[PRACTICAL_MAX_MARKS]
           ,[PRACTICAL_MIN_MARKS]
           ,[PRACTICAL_OBT_MARKS]
           ,[PRACTICAL_RESULT]
           ,[PRACTICAL_DIVISION]
           ,[INTERNAL_MAX_MARKS]
           ,[INTERNAL_MIN_MARKS]
           ,[INTERNAL_OBT_MARKS]
           ,[SESSIONAL_MAX_MARKS]
           ,[SESSIONAL_MIN_MARKS]
           ,[SESSIONAL_OBT_MARKS]
           ,[TOTAL_MAX_MARKS]
           ,[TOTAL_MIN_MARKS]
           ,[TOTAL_OBT_MARKS]
           ,[GRAND_MAX_MARKS]
           ,[GRAND_MIN_MARKS]
           ,[GRAND_OBT_MARKS]
           ,[RG_CODE]
           ,[RG_MAX_MARKS]
           ,[RG_MIN_MARKS]
           ,[RG_OBT_MARKS]
           ,[RG_RESULT]
           ,[ES_CODE]
           ,[ES_MAX_MARKS]
           ,[ES_MIN_MARKS]
           ,[ES_OBT_MARKS]
           ,[ES_RESULT]
           ,[CO_CURRICULAR_RESULT]
           ,[FINAL_DIVISION]
           ,[PROMOTED]
           ,[CUM_TOTAL_MAX]
           ,[CUM_TOTAL_MIN]
           ,[CUM_TOTAL_OBT]
           ,[CUM_TOTAL_CREDIT]
           ,[CUM_TOTAL_EARNED_CREDIT]
           ,[CUM_TOTAL_POINT]
           ,[CUM_TOTAL_GRADE_POINT]
           ,[CGPA]
           ,[EXAM_NAME]
           ,[HELD_IN]
           ,[PRINT_LOT_NO]
           ,[RESULT_DATE]
           ,[IS_PUBLISHED]
           ,[PUBLISH_DATE]
           ,[LAST_ORDINANCE_RUN_AT]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_DIVISION]
           ,[MARKSHEET_NO]
           ,[IS_PENDING_SYNC]
           ,[SYNC_DATE]
           ,[ERROR_DETAILS]
           ,[IS_LIVE]
           ,[IS_UFM]
           ,[ORDINANCE_ID],GROUPID)



   SELECT [RESULT_ID]
           ,[MASTER_ID]
           ,[SOURCE_TYPE]
           ,[ROLL_NO]
           ,[COURSE_ID]
           ,[RESULT_TYPE]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[IS_HISTORY]
           ,[SEMESTER_RESULT]
           ,[FINAL_RESULT]
           ,[WING_TYPE_CODE]
           ,[THEORY_MAX_MARKS]
           ,[THEORY_MIN_MARKS]
           ,[THEORY_OBT_MARKS]
           ,[TOTAL_MAJOR_CREDIT]
           ,[TOTAL_MAJOR_EARN_CREDIT]
           ,[TOTAL_CREDIT]
           ,[EARNED_CREDIT]
           ,[TOTAL_POINT]
           ,[TOTAL_GRADE_POINT]
           ,[SGPA]
           ,[PRACTICAL_MAX_MARKS]
           ,[PRACTICAL_MIN_MARKS]
           ,[PRACTICAL_OBT_MARKS]
           ,[PRACTICAL_RESULT]
           ,[PRACTICAL_DIVISION]
           ,[INTERNAL_MAX_MARKS]
           ,[INTERNAL_MIN_MARKS]
           ,[INTERNAL_OBT_MARKS]
           ,[SESSIONAL_MAX_MARKS]
           ,[SESSIONAL_MIN_MARKS]
           ,[SESSIONAL_OBT_MARKS]
           ,[TOTAL_MAX_MARKS]
           ,[TOTAL_MIN_MARKS]
           ,[TOTAL_OBT_MARKS]
           ,[GRAND_MAX_MARKS]
           ,[GRAND_MIN_MARKS]
           ,[GRAND_OBT_MARKS]
           ,[RG_CODE]
           ,[RG_MAX_MARKS]
           ,[RG_MIN_MARKS]
           ,[RG_OBT_MARKS]
           ,[RG_RESULT]
           ,[ES_CODE]
           ,[ES_MAX_MARKS]
           ,[ES_MIN_MARKS]
           ,[ES_OBT_MARKS]
           ,[ES_RESULT]
           ,[CO_CURRICULAR_RESULT]
           ,[FINAL_DIVISION]
           ,[PROMOTED]
           ,[CUM_TOTAL_MAX]
           ,[CUM_TOTAL_MIN]
           ,[CUM_TOTAL_OBT]
           ,[CUM_TOTAL_CREDIT]
           ,[CUM_TOTAL_EARNED_CREDIT]
           ,[CUM_TOTAL_POINT]
           ,[CUM_TOTAL_GRADE_POINT]
           ,[CGPA]
           ,[EXAM_NAME]
           ,[HELD_IN]
           ,[PRINT_LOT_NO]
           ,[RESULT_DATE]
           ,[IS_PUBLISHED]
           ,[PUBLISH_DATE]
           ,[LAST_ORDINANCE_RUN_AT]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_DIVISION]
           ,[MARKSHEET_NO]
           ,[IS_PENDING_SYNC]
           ,[SYNC_DATE]
           ,[ERROR_DETAILS]
           ,[IS_LIVE]
           ,[IS_UFM]
           ,[ORDINANCE_ID] 
           ,GROUPID
            FROM STUDENT_RESULT
            WHERE COURSE_ID=@COURSE_ID
            AND SESSION=@SESSION
            AND HELD_IN=@HELD_IN
             AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR(LEN(@ROLL_NO)>0  AND  ROLL_NO IN ( SELECT VALUE FROM  string_split( @ROLL_NO,',')))  )
            

        UPDATE STUDENT_RESULT
            SET IS_PUBLISHED=2
            ,IS_LIVE=1
            ,SYNC_DATE=GETDATE()
            WHERE COURSE_ID=@COURSE_ID
            AND SESSION=@SESSION
            AND HELD_IN=@HELD_IN
            AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR(LEN(@ROLL_NO)>0  AND  ROLL_NO IN ( SELECT VALUE FROM  string_split( @ROLL_NO,',')))  )



 -- CALL SP FOR SYNC DATA

 EXEC  [103.115.194.115,9162].AGRA_RESULT_DEMO.dbo.SYNC_DATA_FROM_DEMO_TO_LIVEDEMO 0

 END  

  COMMIT TRAN
END TRY    

 BEGIN CATCH
 ROLLBACK TRAN 
END CATCH

GO
/****** Object:  StoredProcedure [dbo].[USP_SYNC_MARKS_RESULT_DEMO_LIVEdEMO]    Script Date: 12/25/2025 4:39:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE PROC [dbo].[USP_SYNC_MARKS_RESULT_DEMO_LIVEdEMO]
(
  @COURSE_ID INT =142
 ,@HELD_IN VARCHAR(20) ='OCT-2025'
 ,@SESSION VARCHAR(20) ='2024-25'
 ,@ROLL_NO VARCHAR(8000)='2306390140074'
 ,@MERGE_MARKS BIT=1
 ,@MERGE_RESULT BIT=1
)
AS

 --BEGIN TRAN

 BEGIN TRY


IF(@MERGE_MARKS =1)
 BEGIN 
 INSERT INTO [103.115.194.115,9162]. AGRA_RESULT_DEMO.[dbo].STUDENT_MARKS_MERGE
           (
            [RESULT_ID]
           ,[MARKS_ID]
           ,[SUBJECT_SERIAL]
           ,[PAPER_SERIAL]
           ,[MASTER_ID]
           ,[EXTERNAL_ID]
           ,[COURSE_ID]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[ROLL_NO]
           ,[PAPER_CODE]
           ,[CATCH_CODE]
           ,[SUBJECT_NAME]
           ,[PAPER_NAME]
           ,[THEORY_OBT]
           ,[INTERNAL_OBT]
           ,[SESSIONAL_OBT]
           ,[TOTAL_OBT]
           ,[PAPER_STATUS]
           ,[SUBJECT_CODE]
           ,[SUBJECT_TYPE]
           ,[SUBJECT_TYPE_SERIAL]
           ,[CREDIT]
           ,[EARNED_CREDIT]
           ,[POINT]
           ,[GRADE_POINT]
           ,[GRADE]
           ,[THEORY_MAX]
           ,[THEORY_MIN]
           ,[THEORY_GRACE]
           ,[THEORY_PRACT_ABSENT]
           ,[PRACTICAL_MAX]
           ,[PRACTICAL_MIN]
           ,[PRACTICAL_OBT]
           ,[PRACTICAL_ABSENT]
           ,[INTERNAL_MAX]
           ,[INTERNAL_MIN]
           ,[INTERNAL_ABSENT]
           ,[SESSIONAL_MAX]
           ,[SESSIONAL_MIN]
           ,[SESSIONAL_ABSENT]
           ,[TOTAL_MAX]
           ,[TOTAL_MIN]
           ,[SUBJECT_GRACE]
           ,[SUBJECT_STATUS]
           ,[RE_EX]
           ,[OLD_MARKS]
           ,[BACK_POST_ID]
           ,[BARCODE]
           ,[OMR_FEE_PAID]
           ,[SCAN_IMAGE_PATH]
           ,[OMR_SERIES]
           ,[ANSWER_KEY_PATH]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_PRACT_MW]
           ,[INTERNAL_MW]
           ,[SESSIONAL_MW]
           ,[UFM]
           ,[SOURCE_TYPE]
           ,[CREDIT_POINT]
           ,[REMARKS]
           ,[BACK_POSTED]
           ,[IS_INTERNAL_RECEIVED]
           
           ) 


SELECT      [RESULT_ID]
           ,[MARKS_ID]
           ,[SUBJECT_SERIAL]
           ,[PAPER_SERIAL]
           ,[MASTER_ID]
           ,[EXTERNAL_ID]
           ,[COURSE_ID]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[ROLL_NO]
           ,[PAPER_CODE]
           ,[CATCH_CODE]
           ,[SUBJECT_NAME]
           ,[PAPER_NAME]
           ,[THEORY_OBT]
           ,[INTERNAL_OBT]
           ,[SESSIONAL_OBT]
           ,[TOTAL_OBT]
           ,[PAPER_STATUS]
           ,[SUBJECT_CODE]
           ,[SUBJECT_TYPE]
           ,[SUBJECT_TYPE_SERIAL]
           ,[CREDIT]
           ,[EARNED_CREDIT]
           ,[POINT]
           ,[GRADE_POINT]
           ,[GRADE]
           ,[THEORY_MAX]
           ,[THEORY_MIN]
           ,[THEORY_GRACE]
           ,[THEORY_PRACT_ABSENT]
           ,[PRACTICAL_MAX]
           ,[PRACTICAL_MIN]
           ,[PRACTICAL_OBT]
           ,[PRACTICAL_ABSENT]
           ,[INTERNAL_MAX]
           ,[INTERNAL_MIN]
           ,[INTERNAL_ABSENT]
           ,[SESSIONAL_MAX]
           ,[SESSIONAL_MIN]
           ,[SESSIONAL_ABSENT]
           ,[TOTAL_MAX]
           ,[TOTAL_MIN]
           ,[SUBJECT_GRACE]
           ,[SUBJECT_STATUS]
           ,[RE_EX]
           ,[OLD_MARKS]
           ,[BACK_POST_ID]
           ,[BARCODE]
           ,[OMR_FEE_PAID]
           ,[SCAN_IMAGE_PATH]
           ,[OMR_SERIES]
           ,[ANSWER_KEY_PATH]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_PRACT_MW]
           ,[INTERNAL_MW]
           ,[SESSIONAL_MW]
           ,[UFM]
           ,[SOURCE_TYPE]
           ,[CREDIT_POINT]
           ,[REMARKS]
           ,[BACK_POSTED]
           ,[IS_INTERNAL_RECEIVED]
           FROM STUDENT_MARKS 
           WHERE COURSE_ID=@COURSE_ID
           AND SESSION=@SESSION
           AND RESULT_ID IN
            (
            SELECT RESULT_ID FROM STUDENT_RESULT
            WHERE COURSE_ID=@COURSE_ID
            AND SESSION=@SESSION
            AND HELD_IN=@HELD_IN
            AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR(LEN(@ROLL_NO)>0  AND  ROLL_NO IN ( SELECT VALUE FROM  string_split( @ROLL_NO,',')))  )
            )
   END 

IF(@MERGE_RESULT =1)
 BEGIN 

  INSERT INTO [103.115.194.115,9162]. AGRA_RESULT_DEMO.[dbo].[STUDENT_RESULT_MERGE]
           ([RESULT_ID]
           ,[MASTER_ID]
           ,[SOURCE_TYPE]
           ,[ROLL_NO]
           ,[COURSE_ID]
           ,[RESULT_TYPE]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[IS_HISTORY]
           ,[SEMESTER_RESULT]
           ,[FINAL_RESULT]
           ,[WING_TYPE_CODE]
           ,[THEORY_MAX_MARKS]
           ,[THEORY_MIN_MARKS]
           ,[THEORY_OBT_MARKS]
           ,[TOTAL_MAJOR_CREDIT]
           ,[TOTAL_MAJOR_EARN_CREDIT]
           ,[TOTAL_CREDIT]
           ,[EARNED_CREDIT]
           ,[TOTAL_POINT]
           ,[TOTAL_GRADE_POINT]
           ,[SGPA]
           ,[PRACTICAL_MAX_MARKS]
           ,[PRACTICAL_MIN_MARKS]
           ,[PRACTICAL_OBT_MARKS]
           ,[PRACTICAL_RESULT]
           ,[PRACTICAL_DIVISION]
           ,[INTERNAL_MAX_MARKS]
           ,[INTERNAL_MIN_MARKS]
           ,[INTERNAL_OBT_MARKS]
           ,[SESSIONAL_MAX_MARKS]
           ,[SESSIONAL_MIN_MARKS]
           ,[SESSIONAL_OBT_MARKS]
           ,[TOTAL_MAX_MARKS]
           ,[TOTAL_MIN_MARKS]
           ,[TOTAL_OBT_MARKS]
           ,[GRAND_MAX_MARKS]
           ,[GRAND_MIN_MARKS]
           ,[GRAND_OBT_MARKS]
           ,[RG_CODE]
           ,[RG_MAX_MARKS]
           ,[RG_MIN_MARKS]
           ,[RG_OBT_MARKS]
           ,[RG_RESULT]
           ,[ES_CODE]
           ,[ES_MAX_MARKS]
           ,[ES_MIN_MARKS]
           ,[ES_OBT_MARKS]
           ,[ES_RESULT]
           ,[CO_CURRICULAR_RESULT]
           ,[FINAL_DIVISION]
           ,[PROMOTED]
           ,[CUM_TOTAL_MAX]
           ,[CUM_TOTAL_MIN]
           ,[CUM_TOTAL_OBT]
           ,[CUM_TOTAL_CREDIT]
           ,[CUM_TOTAL_EARNED_CREDIT]
           ,[CUM_TOTAL_POINT]
           ,[CUM_TOTAL_GRADE_POINT]
           ,[CGPA]
           ,[EXAM_NAME]
           ,[HELD_IN]
           ,[PRINT_LOT_NO]
           ,[RESULT_DATE]
           ,[IS_PUBLISHED]
           ,[PUBLISH_DATE]
           ,[LAST_ORDINANCE_RUN_AT]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_DIVISION]
           ,[MARKSHEET_NO]
           ,[IS_PENDING_SYNC]
           ,[SYNC_DATE]
           ,[ERROR_DETAILS]
           ,[IS_LIVE]
           ,[IS_UFM]
           ,[ORDINANCE_ID],GROUPID)
            


   SELECT [RESULT_ID]
           ,[MASTER_ID]
           ,[SOURCE_TYPE]
           ,[ROLL_NO]
           ,[COURSE_ID]
           ,[RESULT_TYPE]
           ,[EXAM_TYPE]
           ,[SESSION]
           ,[YEAR_SEM]
           ,[COLLEGE_CODE]
           ,[IS_HISTORY]
           ,[SEMESTER_RESULT]
           ,[FINAL_RESULT]
           ,[WING_TYPE_CODE]
           ,[THEORY_MAX_MARKS]
           ,[THEORY_MIN_MARKS]
           ,[THEORY_OBT_MARKS]
           ,[TOTAL_MAJOR_CREDIT]
           ,[TOTAL_MAJOR_EARN_CREDIT]
           ,[TOTAL_CREDIT]
           ,[EARNED_CREDIT]
           ,[TOTAL_POINT]
           ,[TOTAL_GRADE_POINT]
           ,[SGPA]
           ,[PRACTICAL_MAX_MARKS]
           ,[PRACTICAL_MIN_MARKS]
           ,[PRACTICAL_OBT_MARKS]
           ,[PRACTICAL_RESULT]
           ,[PRACTICAL_DIVISION]
           ,[INTERNAL_MAX_MARKS]
           ,[INTERNAL_MIN_MARKS]
           ,[INTERNAL_OBT_MARKS]
           ,[SESSIONAL_MAX_MARKS]
           ,[SESSIONAL_MIN_MARKS]
           ,[SESSIONAL_OBT_MARKS]
           ,[TOTAL_MAX_MARKS]
           ,[TOTAL_MIN_MARKS]
           ,[TOTAL_OBT_MARKS]
           ,[GRAND_MAX_MARKS]
           ,[GRAND_MIN_MARKS]
           ,[GRAND_OBT_MARKS]
           ,[RG_CODE]
           ,[RG_MAX_MARKS]
           ,[RG_MIN_MARKS]
           ,[RG_OBT_MARKS]
           ,[RG_RESULT]
           ,[ES_CODE]
           ,[ES_MAX_MARKS]
           ,[ES_MIN_MARKS]
           ,[ES_OBT_MARKS]
           ,[ES_RESULT]
           ,[CO_CURRICULAR_RESULT]
           ,[FINAL_DIVISION]
           ,[PROMOTED]
           ,[CUM_TOTAL_MAX]
           ,[CUM_TOTAL_MIN]
           ,[CUM_TOTAL_OBT]
           ,[CUM_TOTAL_CREDIT]
           ,[CUM_TOTAL_EARNED_CREDIT]
           ,[CUM_TOTAL_POINT]
           ,[CUM_TOTAL_GRADE_POINT]
           ,[CGPA]
           ,[EXAM_NAME]
           ,[HELD_IN]
           ,[PRINT_LOT_NO]
           ,[RESULT_DATE]
           ,[IS_PUBLISHED]
           ,[PUBLISH_DATE]
           ,[LAST_ORDINANCE_RUN_AT]
           ,[CREATED_AT]
           ,[CREATED_BY]
           ,[LAST_UPDATED_AT]
           ,[LAST_UPDATED_BY]
           ,[IS_ACTIVE]
           ,[THEORY_DIVISION]
           ,[MARKSHEET_NO]
           ,[IS_PENDING_SYNC]
           ,[SYNC_DATE]
           ,[ERROR_DETAILS]
           ,[IS_LIVE]
           ,[IS_UFM]
           ,[ORDINANCE_ID] ,GROUPID
           
            FROM STUDENT_RESULT
            WHERE COURSE_ID=@COURSE_ID
            AND SESSION=@SESSION
            AND HELD_IN=@HELD_IN
             AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR(LEN(@ROLL_NO)>0  AND  ROLL_NO IN ( SELECT VALUE FROM  string_split( @ROLL_NO,',')))  )
            

        UPDATE STUDENT_RESULT
            SET IS_PUBLISHED=2
            ,IS_LIVE=1
            ,SYNC_DATE=GETDATE()
            WHERE COURSE_ID=@COURSE_ID
            AND SESSION=@SESSION
            AND HELD_IN=@HELD_IN
            AND ( (LEN(@ROLL_NO)=0 AND 1=1) OR(LEN(@ROLL_NO)>0  AND  ROLL_NO IN ( SELECT VALUE FROM  string_split( @ROLL_NO,',')))  )



 -- CALL SP FOR SYNC DATA

EXEC  [103.115.194.115,9162]. AGRA_RESULT_DEMO.dbo.SYNC_DATA_FROM_DEMO_TO_MARKS_RESULT 0
SELECT 1 
 END 

 -- COMMIT TRAN
END TRY    

 BEGIN CATCH
 SELECT -1, ERROR_MESSAGE() 

  ---ROLLBACK TRAN 
END CATCH

GO
USE [master]
GO
ALTER DATABASE [AGRA_RESULT_DEMO] SET  READ_WRITE 
GO
