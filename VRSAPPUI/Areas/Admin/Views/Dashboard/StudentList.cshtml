@using VRSMODEL
@model VRSMODEL.DTO.StudentList_Admin
@{
    var stud = Model.StudentList;
}

<style>
    .checkboxsize {
        width: 20px;
        height: 20px;
    }


    .ldrpge {
        position: absolute;
        display: none;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.9);
        z-index: 3;
    }

        .ldrpge img {
            height: 120px;
            position: absolute;
            left: 50%;
            top: 350px;
            transform: translate(-50%, -50%);
        }
</style>

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">

            <div class="row">

                <div class="col-xl-12">

                    <form style="margin:0px" id="formIndex" method="post">

                    <div class="card">
                        
                            <div class="card-header">
                                <input id="CommandNameSrh" name="CommandNameSrh" value="" hidden />
                                <div class="container">
                                    <div class="row">
                                        <div class="col-2 mb-2">
                                            <select class="form-select form-control" style="" id="SessionName" name="SessionName" onchange="filter2()">

                                                @foreach (var c in Model.SessionList)
                                                {
                                                    if (Model.SessionName == c.SESSIONS)
                                                    {
                                                        <option value="@c.SESSIONS" selected>@c.SESSIONS</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@c.SESSIONS">@c.SESSIONS</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                        <div class="col-3 mb-2">

                                            <select class="form-select form-control" style="" id="CourseType" name="CourseType" onchange="filter2()">
                                                <option value="">-- Select Course Type --</option>
                                                @foreach (var c in Model.CourseTypeList)
                                                {
                                                    if (Model.CourseType == c.CourseType)
                                                    {
                                                        <option value="@c.CourseType" selected>@c.CourseType</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@c.CourseType">@c.CourseType</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                        <div class="col-1 mb-2">

                                            <select class="form-select form-control" style="" id="IsPG" name="IsPG" onchange="filter2()">
                                                @if (Model.IsPG == true)
                                                {
                                                    <option value="True" selected>IsPG</option>
                                                    <option value="False">IsUG</option>
                                                }
                                                else
                                                {
                                                    <option value="True">IsPG</option>
                                                    <option value="False" selected>IsUG</option>
                                                }

                                            </select>
                                        </div>
                                        <div class="col-4  mb-2">

                                            <select class="form-control select2 m-2" style="width: 100%" id="CourseID" name="CourseID" onchange="filter2()">
                                                <option value="0">--- Select Course ---</option>
                                                @foreach (var item in Model.CourseList)
                                                {
                                                    if (Model.CourseID == item.EntryID)
                                                    {
                                                        <option value="@item.EntryID" selected>@item.CourseName</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.EntryID">@item.CourseName</option>

                                                    }
                                                }

                                            </select>
                                        </div>
                                        <div class="col-3 mb-2">

                                            <select class="form-control select2 m-2" style="width: 100%" id="ExamTypeName" name="ExamTypeName">
                                                <option value="">--- Select Exam Type ---</option>
                                                @foreach (var item in Model.ExamTypeList)
                                                {
                                                    if (Model.ExamTypeName == item.EXAM_TYPE)
                                                    {
                                                        <option value="@item.EXAM_TYPE" selected>@item.EXAM_TYPE</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.EXAM_TYPE">@item.EXAM_TYPE</option>

                                                    }
                                                }

                                            </select>
                                        </div>
                                        <div class="col-3 mb-2">

                                            <input type="text" id="RollN" name="RollN" placeholder="Roll No" value="@Model.RollN" class="form-control text-left" />
                                        </div>
                                        <div class="col-2 mb-2">

                                            <select class="form-select form-control" style="" id="IsLiveStatus" name="IsLiveStatus">
                                                @if (Model.IsLiveStatus == 2)
                                                {
                                                    <option value="2" selected>--All--</option>
                                                    <option value="1">Live</option>
                                                    <option value="0">Not Live</option>
                                                }

                                                else if (Model.IsLiveStatus == 1)
                                                {
                                                    <option value="2">--All--</option>
                                                    <option value="1" selected>Live</option>
                                                    <option value="0">Not Live</option>
                                                }
                                                else
                                                {
                                                    <option value="2">--All--</option>
                                                    <option value="1">Live</option>
                                                    <option value="0" selected>Not Live</option>
                                                }

                                            </select>
                                        </div>
                                        <div class="col-1 mb-2">

                                            <button type="button" value="Search" onclick="filterSearch()" id="btnSearch" name="CommandNameSrh" class="btn btn-sm btn-success  ">Search</button>
                                        </div>

                                        <div class="col mb-2">
                                            <a id="StatusAll" onclick="GetAllDatatoActive()" class="btn btn-danger btn-sm" style="float:right !important ; margin:0 12px !important">Click to Change</a>
                                        </div>
                                    </div>

                                </div>



                            </div>
                            @Html.Hidden("Page")
                        <!-- /.card-header -->
                        <div class="card-body table-responsive p-0">
                            <table class="table table-head-fixed text-nowrap" id="studenttable">
                                <thead>
                                    <tr>
                                        <th class="text-center" width="70px">
                                            <input type="checkbox" class="checkboxsize" id="selectAll" />
                                            ALL / SrNo.
                                        </th>
                                       
                                        <th>
                                            ROLLNO
                                        /
                                            EN_NO
                                        </th>
                                        <th>EXAM_TYPE</th>
                                        <th>NAME</th>
                                        <th>Father/Mother</th>
                                        <th>CourseName</th>
                                        <th>SEM_NO</th>
                                        <th>HeldIn / ResultDate</th>
                                        <th>Result / Final_Result</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    @if (stud != null)
                                    {
                                        if (stud.Count() > 0)
                                        {
                                           
                                            foreach (var item in stud)
                                            {
                                                var colors = item.IsActive == false ? "background-color:#ffdde3" : "";
                                                <tr style="font-size:13px;@colors">

                                                    <td>
                                                        @* @item.ENTRYID *@
                                                        <input type="checkbox" data-entry="@item.ENTRYID" class="checkboxsize" />

                                                        @*   <a href="#" onclick="EditCourseCheck(@item.ENTRYID)">
                                            <i class="fas fa-edit text-danger" style="font-size:20px;"></i>

                                            </a> *@
                                                            @item.SrNo
                                                    </td>
                                                   @*  <td>
                                                        @i
                                                    </td> *@
                                                    <td>@item.ROLL_NO / @item.ENROLLMENT_NO</td>
                                                    <td>@item.EXAM_TYPE</td>

                                                    <td>@item.NAME</td>
                                                    <td>@item.FNAME <br />@item.MNAME</td>
                                                    <td>@item.CourseName</td>
                                                    <td>@item.YEAR_SEM</td>
                                                    <td>
                                                        @item.HELD_IN
                                                        <br />
                                                        @if (!string.IsNullOrEmpty(item.ResultDate.ToString()))
                                                        {
                                                            @item.ResultDate.Value.ToString("dd MMM yyyy")
                                                        }
                                                        else
                                                        {
                                                            <h6 class="text-danger">Date Not filled </h6>
                                                        }
                                                    </td>
                                                    <td>
                                                        @item.RESULT /
                                                        @if (!string.IsNullOrEmpty(item.FINAL_RESULT))
                                                        {
                                                            <span>
                                                                @item.FINAL_RESULT
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            <span>
                                                                --
                                                            </span>
                                                        }
                                                    </td>
                                                    <td>
                                                        @if (item.IsLive == true)
                                                        {
                                                            <span>Live</span>
                                                        }
                                                        else
                                                        {
                                                            <span>Not Live</span>
                                                        }

                                                    </td>
                                                </tr>
                                                
                                            }
                                        }

                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="9">
                                                <p>
                                                    Data Not Found!
                                                </p>
                                            </td>
                                        </tr>
                                    }


                                </tbody>
                            </table>
                        </div>
                        <!-- /.card-body -->
                        <div class="card-footer clearfix">

                            @{
                                var totalPages = (int)Math.Ceiling(Decimal.Divide(Model.PagingList.RecordCount, Model.PagingList.PageSize));
                                var firstPage = 1;
                                var lastPage = totalPages;
                                var currentpage = Model.PagingList.PageCurrent;

                                int maxPagesToShow = 5;
                                int halfRange = maxPagesToShow / 2;

                                if (totalPages <= maxPagesToShow)
                                {
                                    firstPage = 1;
                                    lastPage = totalPages;
                                }
                                else
                                {
                                    if (currentpage <= halfRange)
                                    {
                                        firstPage = 1;
                                        lastPage = maxPagesToShow;
                                    }
                                    else if (currentpage + halfRange >= totalPages)
                                    {
                                        firstPage = totalPages - (maxPagesToShow - 1);
                                        lastPage = totalPages;
                                    }
                                    else
                                    {
                                        firstPage = currentpage - halfRange;
                                        lastPage = currentpage + halfRange;
                                    }
                                }

                            }
                            <ul class="pagination pagination-sm m-0 float-right">
                                @if (Model.PagingList.PageCurrent > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" onclick="pagechange(1)">First</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" onclick="pagechange(@currentpage - 1)">« Prev</a>
                                    </li>
                                }

                                <!-- Page Number Buttons (only 5 visible) -->
                                @for (int i = firstPage; i <= lastPage; i++)
                                {
                                    <li class="page-item @(i == Model.PagingList.PageCurrent ? "active" : "")">
                                        <a class="page-link" onclick="pagechange(@i)">@i</a>
                                    </li>
                                }

                                <!-- Next Button -->
                                @if (Model.PagingList.PageCurrent < totalPages)
                                {
                                    <li class="page-item">
                                        <a class="page-link" onclick="pagechange(@currentpage + 1)">Next »</a>
                                    </li>
                                }
                                @if (Model.PagingList.PageCurrent < totalPages)
                                {
                                    <li class="page-item">
                                        <a class="page-link" onclick="pagechange(@totalPages)">Last</a>
                                    </li>
                                }
                            </ul>

                        </div>
                    </div>
                    </form>
                </div>

            </div>

        </div>
    </div>
</div>
<div class="ldrpge">
    <img src="~/loader.svg" alt="" />
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModalstatus" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-auto-open>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">
                    Status Update
                </h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">x</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <input id="selectedd" name="selectedd" hidden />
                    <div class="col-md-6 form-group">
                        <span class="" style="width:120px">HeldIn</span>
                        <input type="text" value="" id="HeldIn" name="HeldIn" class="form-control" placeholder="MAY-2024">
                        <span id="A_HeldInSpan" class="text-danger w-100 float-end"></span>
                    </div>
                    <div class="col-md-6 form-group">
                        <span class="" style="width:120px">Result Date</span>
                        <input type="text" name="ResultDate" id="ResultDate"
                               class="form-control date-picker"
                               placeholder="Select Date" value="" />
                        <span id="ResultDateSpan" class="text-danger w-100 float-end"></span>
                    </div>
                    <div class="col-md-6 form-group">
                        <span class="" style="width:120px">Status</span>
                        <select class="form-select form-control" style="" id="IsLiveStatusPop" name="IsLiveStatusPop">
                            <option value="0" selected>Not Live</option>
                            <option value="1">Live</option>

                        </select>
                        <span id="IsLiveStatusSpan" class="text-danger w-100 float-end"></span>
                    </div>

                </div>

                <div class="text-center">
                    <button type="button" id="btnpwait" style="display:none" class="btn btn-primary">Wait... </button>
                    <button type="button" id="btnp" onclick="SaveStatus()" class="btn btn-primary">Submit </button>
                </div>
            </div>

        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
@section scripts {
    <script>
        function pagechange(p) {
            
            $("#Page").val(p);  $("#CommandNameSrh").val("Search");
            $("#formIndex").submit();  OpenProgressBar();
        }

          

    </script>
}

<script>
    function OpenProgressBar() {
        $(".ldrpge").show();
    }

    function filter2() {

        $("#formIndex").submit();
    }
    function filterSearch() {

        $("#CommandNameSrh").val("Search");
        $("#formIndex").submit();
        OpenProgressBar();
    }
    
    

    // $(".date-picker").datepicker({
    //     language: "en",
    //     autoClose: true,
    //     dateFormat: "dd MM yyyy",
    // });

    $('#selectAll').click(function (e) {
        var table = $(e.target).closest('table');
        $('td input:checkbox', table).prop('checked', this.checked);
    });

    function GetAllDatatoActive() {
        var receiptNos2 = $("input:checkbox:checked").map(function () {
            return $(this).data('entry')
        }).get();
        //alert(receiptNos2)
        if (receiptNos2 != "") {
            $('#selectedd').val(receiptNos2);
            $('#exampleModalstatus').modal('show');

        } else {
            Swal.fire({
                position: 'top-right',
                icon: 'error',
                title: 'Data Not Selected!',
                showConfirmButton: false,
                timer: 3000
            })

        }

    }

    function SaveStatus() {
        //lert($('#selectedd').val())
        var formData = new FormData();
        formData.append("EntryIDs", $('#selectedd').val());
        formData.append("IsLiveStatus", $('#IsLiveStatusPop').val());
        formData.append("HeldIn", $('#HeldIn').val());
        formData.append("ResultDate", $('#ResultDate').val());

        $.ajax({
            type: "POST",
            url: '@Url.Action("StudentStatusUpdate", "Dashboard", new { Area = "Admin" })',
            data: formData,
            dataType: 'json',
            contentType: false,
            processData: false,
            beforeSend: function () {
                // setting a timeout
                $('#btnpwait').show();
                $('#btnp').hide();
                
            },
            success: function (response) {
                // alert(response.res)
                if (response.res == "ok") {

                    location.reload(true);

                }
                $('#btnpwait').hide();
                $('#btnp').show();
            },
            error: function (error) {

            }
        });
    }
</script>