@using VRSMODEL
@model List<VRSMODEL.DTO.CourseMasterDTO_AM>
@{
    ViewData["Title"] = "COURSE";
    ViewData["ActiveMenu"] = "CourseMenu"; ViewData["ActiveGroup"] = "CourseMenu";

}
<style>
    .checkboxsize {
        width: 20px;
        height: 20px;
    }
</style>
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">

            <div class="row">

                <div class="col-xl-12">

                    @{
                        var checkedtotal = ViewBag.IsCount == true ? "checked" : "";
                    }

                    <div class="card">
                        <form style="margin:0px" id="formIndex" method="post">
                            <div class="card-header">
                               
                                <button type="button" class="btn btn-sm btn-success float-end" data-toggle="modal" data-target="#CourseAddModal">
                                    &nbsp;Add New Course
                                </button>
                                <div class="form-check form-check-inline" style="float:right !important ; margin:0 12px !important">
                                    <input class="form-check-input checkboxsize" type="checkbox" id="WithCount" name="WithCount" @checkedtotal onchange="Submitform()">
                                    <label class="form-check-label p-1" for="WithCount">
                                        With Count
                                    </label>
                                    <input name="WithCountH" id="WithCountH" hidden />
                                </div>

                                <a id="StatusAll" onclick="GetAllDatatoActive()" class="btn btn-success btn-sm" style="float:right !important ; margin:0 12px !important">Click to Active/Inactive</a>
                                <a id="ResetAll" onclick="GetAllDatatoReset()" class="btn btn-danger btn-sm" style="float:right !important ; margin:0 12px !important">Click to Mark New/Reset</a>

                            </div>
                           
                      
                        <!-- /.card-header -->
                        <div class="card-body">
                            <div class="row">
                                <div class="col-2 mb-2">
                            <select class="form-select form-control" style="" id="SessionName" name="SessionName" onchange="Submitform()">

                                @foreach (var c in ViewBag.SessionList)
                                {
                                    if (ViewBag.SessionName == c.SessionName)
                                    {
                                        <option value="@c.SessionName" selected>@c.SessionName</option>
                                    }
                                    else
                                    {
                                        <option value="@c.SessionName">@c.SessionName</option>
                                    }
                                }
                                    </select>
                                </div>
                            </div>
                                <table class="table table-head-fixed text-nowrap" id="papertable">
                                    <thead>
                                    <tr>
                                        <th class="text-center" width="70px">
                                            <input type="checkbox" class="checkboxsize" id="selectAll" />
                                            ALL
                                        </th>
                                     @*    <th>SrNo.</th> *@
                                        <th>[ID]Course Name</th>
                                        <th>CourseNameReal</th>
                                        <th>Sem</th>
                                        <th>Session</th>

                                        <th>TemplateName</th>
                                        <th>IsPG</th>
                                        <th>IsActive/Seq/IsNew/isTest</th>
                                        @if (ViewBag.IsCount == true)
                                        {
                                            <th>Total/NotLived</th>
                                        }
                                    </tr>
                                </thead>

                                <tbody>
                                    @if (Model != null)
                                    {
                                        if (Model.Count() > 0)
                                        {
                                            int i = 1;
                                            foreach (var item in Model)
                                            {
                                                var colors = item.IsActive == false ? "background-color:#ffdde3" : "";
                                                <tr style="font-size:13px;@colors">
                                                    <td>
                                                        <input type="checkbox" data-entry="@item.EntryID" class="checkboxsize" />
                                                        &nbsp;
                                                        <a href="#" onclick="EditCourseCheck(@item.EntryID)">
                                                            <i class="fas fa-edit text-danger" style="font-size:20px;"></i>

                                                        </a>

                                                    </td>
                                                   @*  <td>
                                                        @i
                                                    </td> *@
                                                    <td>
                                                        [@item.CourseID]  @item.CourseName
                                                    </td>
                                                    <td>
                                                        @item.CourseNameReal
                                                    </td>
                                                    <td>
                                                        @item.Semester
                                                    </td>
                                                    <td>
                                                        @item.Session
                                                    </td>


                                                    <td>
                                                        @item.TemplateName
                                                    </td>
                                                    <td>

                                                        @if (item.IsPG == true)
                                                        {
                                                            <span>PG</span>
                                                        }
                                                        else
                                                        {
                                                            <span>UG</span>
                                                        }

                                                    </td>
                                                    <td>
                                                        @item.IsActive
                                                        /
                                                        @item.Sequence
                                                        /
                                                        @if (item.IsNew == true)
                                                        {
                                                            <span>New</span>
                                                        }
                                                        else
                                                        {
                                                            <span>Old</span>
                                                        }
                                                        /
                                                            @if (item.IsTestingActive == true)
                                                            {
                                                                <span>Testing</span>
                                                            }
                                                    </td>
                                                    @if (ViewBag.IsCount == true)
                                                    {
                                                        <td>
                                                            @item.TotalCount / <b> @item.NotLivedCount</b>
                                                        </td>
                                                    }
                                                </tr>
                                                i++;
                                            }
                                        }

                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="9">
                                                <p>
                                                    Data Not Found!
                                                </p>
                                            </td>
                                        </tr>
                                    }


                                </tbody>
                            </table>
                        </div>
                        </form>
                        <!-- /.card-body -->
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>
@await Component.InvokeAsync("CourseManage")
<div id="Coursedetails">
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

<script>
    function Submitform() {
       // alert($('#WithCountH').val())

        if (document.getElementById('WithCount').checked) {
          
            $('#WithCountH').val(true);
        } else { $('#WithCountH').val(false); 
        
        }
       
        $("#formIndex").submit();
    }

    $('#selectAll').click(function (e) {
        var table = $(e.target).closest('table');
        $('td input:checkbox', table).prop('checked', this.checked);
    });

    function GetAllDatatoActive() {
        var receiptNos2 = $("input:checkbox:checked").map(function () {
            return $(this).data('entry')
        }).get();
        //alert(receiptNos2)
        if (receiptNos2 != "") {
            Swal.fire({
                title: 'Select Active Status',
                input: 'select',
                inputOptions: {
                    '1': 'Active',
                    '0': 'InActive'
                },
                inputPlaceholder: '-Select-',
                showCancelButton: true,
                inputValidator: function (value) {
                    return new Promise(function (resolve, reject) {
                        if (value !== '') {
                            resolve();
                        } else {
                            resolve('You need to select a status');
                        }
                    });
                }
            }).then(function (result) {
                if (result.isConfirmed) {
                    var formData = new FormData();
                    formData.append("EntryIDs", receiptNos2);
                    formData.append("IsActive", result.value);

                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("CourseStatusUpdate", "Dashboard", new { Area = "Admin" })',
                        data: formData,
                        dataType: 'json',
                        contentType: false,
                        processData: false,
                        beforeSend: function () {
                            // setting a timeout
                            $('#btnbatSavewait').show();
                            $('#btnbatSave').hide();
                        },
                        success: function (response) {
                            // alert(response.res)
                            if (response.res == "ok") {

                                location.reload(true);

                            }
                            $('#btnbatSavewait').hide();
                            $('#btnbatSave').show();
                        },
                        error: function (error) {

                        }
                    });
                }
            });

        }

    }
    function GetAllDatatoReset() {
        var receiptNos2 = $("input:checkbox:checked").map(function () {
            return $(this).data('entry')
        }).get();
        //alert(receiptNos2)
        if (receiptNos2 != "") {
            Swal.fire({
                title: 'Select Status',
                input: 'select',
                inputOptions: {
                    '0': 'Reset',
                    '1': 'Mark New'
                },
                // inputPlaceholder: '-Select-',
                showCancelButton: true,
                inputValidator: function (value) {
                    return new Promise(function (resolve, reject) {
                        if (value !== '') {
                            resolve();
                        } else {
                            resolve('You need to select a status');
                        }
                    });
                }
            }).then(function (result) {
                if (result.isConfirmed) {
                    var formData = new FormData();
                    formData.append("EntryIDs", receiptNos2);
                    formData.append("IsActive", result.value);

                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("CourseStatusReset", "Dashboard", new { Area = "Admin" })',
                        data: formData,
                        dataType: 'json',
                        contentType: false,
                        processData: false,
                        beforeSend: function () {
                            // setting a timeout
                            $('#btnbatSavewait').show();
                            $('#btnbatSave').hide();
                        },
                        success: function (response) {
                            // alert(response.res)
                            if (response.res == "ok") {

                                location.reload(true);

                            }
                            $('#btnbatSavewait').hide();
                            $('#btnbatSave').show();
                        },
                        error: function (error) {

                        }
                    });
                }
            });

        }

    }

    function EditCourseCheck(i) {
        flag = true;

        // if ($.trim($("#Ticket").val()) == "") {
        //     $("#Ticket").addClass("input-validation-error");
        //     flag = false;
        // }
        // else {
        //     $("#Ticket").removeClass("input-validation-error");
        // }
        if (flag) {


            var divpdis = "/Admin/Dashboard/EditCourse?EntryID=";
            $("#Coursedetails").load(divpdis + i, function () {

                // const myModal = new bootstrap.Modal('#CourseEditModal');
                // myModal.show();
                $('#CourseEditModal').modal('show');
                $('.select2').each(function () {
                    $(this).select2({
                        // theme: 'bootstrap-5',
                        dropdownParent: $(this).parent(),
                    });
                });

            });

        };
    }
</script>