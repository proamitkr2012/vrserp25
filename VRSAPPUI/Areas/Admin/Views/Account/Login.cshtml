@model VRSMODEL.DTO.LoginDTO
@{
    ViewData["Title"] = "Login";
}


<div class="login-box">

    <div class="card card-outline card-primary">

        <div class="card-body">
            <div class="text-center text-capitalize fa-2x">
                <b>Admin Panel</b>
                <hr />
            </div>
            <p class="login-box-msg">Sign in to start your session</p>
            <form action="" method="post">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Username/Email" name="LogName" id="LogName" required="" value="">
                    <div class="input-group-append">
                        <div class="input-group-text">
                            <span class="fas fa-user"></span>
                        </div>
                    </div>
                </div>
                <div class="input-group mb-3">
                    <input type="password" class="form-control" placeholder="Password" name="LogPassword" id="LogPassword" required="" value="" />  
                    <div class="input-group-append">
                        <div class="input-group-text">
                            <span class="fas fa-lock"></span>
                        </div>
                    </div>
                    <span id="PAS_error" style="color: #ff0000; display: block;text-align: left;"></span>
                </div>
                <div class="row">
                    <div class="col-7">
                        <div class="icheck-primary">
                            <input type="checkbox" id="remember">
                            <label for="remember">
                                Remember Me
                            </label>
                        </div>
                    </div>

                    <div class="col-5">
                      @*   <button type="submit" class="btn btn-primary btn-block">Sign In</button> *@
                        <a class="btn btn-success submit btn-block text-white" id="btnswaitr" style="display:none"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> Sending...</a>

                        <a class="btn btn-success submit btn-block text-white" id="btnsdownr" onclick="SubmitFormN()">Submit</a>
                    </div>

                </div>
            </form>


            <p class="mb-1">
                <a href="#">I forgot my password</a>
            </p>

        </div>

    </div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">

    document.getElementById("LogPassword").addEventListener("keydown", function (e) {
        if (!e) { var e = window.event; }
        // e.preventDefault(); // sometimes useful

        // Enter is pressed
        if (e.keyCode == 13) { SubmitFormN(); }
    }, false);
    // document.getElementById("OTP").addEventListener("keydown", function (e) {
    //     if (!e) { var e = window.event; }
    //    // e.preventDefault(); // sometimes useful

    //     // Enter is pressed
    //     if (e.keyCode == 13) { SubmitForm(); }
    // }, false);

    function validEmail(email) {
        const re = /^(([^<>()[\]\\.,;:\s@@"]+(\.[^<>()[\]\\.,;:\s@@"]+)*)|(".+"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }
    function validPass(pass) {
        var re = /^(?=.*\d)(?=.*[!@@#$%^&*])(?=.*[a-z])(?=.*[A-Z]).{6,}$/;
        return re.test(pass);
    }





</script>

<script>
    $('#btnswaitr').hide();
     $('#btnsdownr').show();
    function SubmitFormN() {
        flag = true;
        // if ($.trim($("#OTP").val()) == "") {
        //     $("#OTP").addClass("input-validation-error");
        //     flag = false;
        // }
        // else {
        //     $("#OTP").removeClass("input-validation-error");
        // }
        if ($.trim($("#LogName").val()) == "") {
            $("#LogName").addClass("input-validation-error");
            flag = false;
        }
        else {
            $("#LogName").removeClass("input-validation-error");
        } if ($.trim($("#LogPassword").val()) == "") {
            $("#LogPassword").addClass("input-validation-error");
            flag = false;
        }
        else {
            $("#LogPassword").removeClass("input-validation-error");
        }


        if (flag) {
            var obj = {
                Email: $("#LogName").val(),
                Password: $("#LogPassword").val(),
                // OTP: $("#OTP").val(),

            };

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("Login", "Account", new { area = "Admin" })',
                data: JSON.stringify(obj),
                dataType: "json",
                beforeSend: function () {
                    // setting a timeout
                    $('#btnswaitr').show();
                    $('#btnsdownr').hide();

                },
                success: function (data) {
                    $('#Enrollmenterror').html("");
                    $('#Nameerror').html("");


                    if (data == "success") {
                        window.location.href = "@Url.Action("Index", "Dashboard", new { Area = "Admin" })";
                        //$("#alertModel").modal('show');
                        //$('.modal-body > p > span').html('');
                        //$('.modal-body > p > span').html('Thanks for sharing your details with us. We will get back to you soon!');
                        $("#LogName").val("");
                        $("#LogPassword").val("");

                        // $("#otpbtndiv").show();
                        // $("#btndiv").hide();



                    }
                     else if (data == "Staff") {
                        window.location.href = "@Url.Action("LIndex", "Dashboard", new { Area = "Admin" })";
                        //$("#alertModel").modal('show');
                        //$('.modal-body > p > span').html('');
                        //$('.modal-body > p > span').html('Thanks for sharing your details with us. We will get back to you soon!');
                        $("#LogName").val("");
                        $("#LogPassword").val("");

                        // $("#otpbtndiv").show();
                        // $("#btndiv").hide();



                    }

                    else {
                        Swal.fire(data)

                       $("#LogName").val("");
                        $("#LogPassword").val("");

                       
                    }
                },
                error: function (result) {
                    alert('Service call failed: ' + result.status + ' Type :' + result.statusText);
                },
                complete: function () {
                    setTimeout(function () {
                        $('#btnswaitr').hide();
                        $('#btnsdownr').show();

                    }, 0);
                },
            });

        };
    }
</script>

